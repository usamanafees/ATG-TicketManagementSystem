    {% extends 'itrak/base.html' %}

    {% block body_block %}
        {% load static %}
        {% load tz %} {# it will Load the Django TimeZone Library#}
        {% load templates_extras %}
        {% load check_permissions %}
{#        {% get_current_timezone as TIME_ZONE %} {# it will Load the Current Time Zone List#}

				<section role="main" class="content-body">
					<header class="page-header">
                       <h2><i class="fa fa-ticket" aria-hidden="true"></i> Ticket</h2>

						<div class="right-wrapper pull-right">
							<ol class="breadcrumbs">
								<li>
									<a href="{% url 'home' %}">
										<i class="fa fa-home"></i>
									</a>
								</li>
								<li><span>Tickets</span></li>
								<li><span>Edit Ticket</span></li>
							</ol>

							<a class="sidebar-right-toggle" data-open="sidebar-right"><i class="fa fa-chevron-left"></i></a>
						</div>
					</header>

					<!-- start: page -->
                         <div class="row">
                            <div class="col-md-12">
                                {% for message in messages %}
                                    <div class="alert {% if 'success' in message.tags %} alert-success {% else %} alert-danger{% endif %} alert-dismissible" role="alert">
                                          <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                        {{ message }}
                                    </div>
                                {% endfor %}
                                <form id="summary-form" class="ticketForm form-horizontal" action="{% url 'updateTicket' %}" method="post">
                                    {% csrf_token %}
                                    <section class="panel">
                                        <header class="panel-heading">
                                            <h2 class="panel-title">Edit Ticket #{{ data.ticket_id }} 
                                                <a class="mb-xs mt-xs mr-xs modal-sizes" href="#modalAttachment"><span class="attach-badge">{% if ticket_attachments %}{{ ticket_attachments.count }}{% else %}0{% endif %}</span><i class="fa fa-paperclip" aria-hidden="true"></i></a>
                                            </h2>
                                        </header>
                                        <footer class="panel-footer">
                                            <div class="row">
                                                <div class="col-sm-9">
                                                    <button class="btn btn-primary saveButton">Update</button>
                                                    <button type="reset" onclick="resetForm()" class="btn btn-default btn-reset">Reset</button>
                                                </div>
                                            </div>
                                        </footer>
                                        <div id="modalAttachment" class="modal-block modal-block-lg mfp-hide dropzone-modal">
                                            <div class="modal-body">
                                                <a href="javascript:void(0);" class="close-popup modal-dismiss">&times;</a>
                                                <div class="attachment-title">
                                                    <h2>Attachments:</h2>
                                                </div>
                                                <div id="modalDrop" class="">
                                                    <div class="dropzone dropzone-previews {% if ticket_attachments %}dz-started{% endif %}" id="my-awesome-dropzone">
                                                        {% for attachment in ticket_attachments %}
                                                            <div class="dz-preview dz-file-preview dz-processing dz-success dz-complete">
                                                            <div class="dz-image">
                                                                <!-- Display Default file icon -->
                                                                {% getFileTypeIconByFileName attachment.file_name as extIcon %}
                                                                <img data-dz-thumbnail="" src="{% static extIcon %}">
                                                            </div>
                                                            <div class="dz-details">
                                                                <div class="dz-size">
                                                                    <span data-dz-size=""><strong>{{ attachment.file_size }}</strong></span>
                                                                </div>
                                                                <div class="dz-filename">
                                                                    <span data-dz-name="">
                                                                        {{ attachment.file_name }}
                                                                    </span>
                                                                </div>
                                                            </div>
                                                            <div class="dz-download">
                                                                <a class="fa fa-cloud-download" href='{{ MEDIA_URL }}{{ attachment.file_path }}' download></a>
                                                            </div>
                                                            <div class="dz-success-mark"> </div>
                                                            <div class="dz-error-mark"> </div>
                                                            <!-- Action Permission check -->
                                                            {% if "tm_Can_delete_Tickets_and_Ticket_related_attachments"|check_action_permission:user.id %}
                                                            <a class="dz-remove" href="javascript:void(0);" onclick="deleteTicketAttachment(this, {{ attachment.attach_id }})" data-dz-remove="" id="{{ attachment.attach_id }}">delete</a>
                                                            {%endif%}
                                                        </div>
                                                        {% endfor %}
                                                    </div>
                                                    <br>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="panel-body">
                                            <div class="validation-message">
                                                <ul></ul>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-md-3 control-label">Ticket#:</label>
                                                <div class="col-md-8">
                                                   <label>{{ data.ticket_id }}</label>
                                                   <input type="hidden" name="ticket_id" id="ticket_id" value="{{ data.ticket_id }}">
                                                </div>
                                            </div>
                                            {% if user.user_type == '0' or user.user_type == '1' %}
                                            <div class="form-group">
                                                <label class="col-md-3 col-sm-3 control-label"><span class="required">*</span> Organization: </label>
                                                <div class="col-md-4 col-sm-4">
                                                    <select name="org_id" id="org_id" required="required" title="Select Organization" data-plugin-selectTwo class="form-control populate placeholder" data-plugin-options='{ "placeholder": "Select an Client", "allowClear": true }'>
                                                        <option value="" readonly="readonly" >Select Organization </option>
                                                        {% if organizations %}
                                                            {% for org in organizations %}
                                                                <option value="{{ org.org_id }}" {% if org.org_id == data.ticket_org_id %}selected{% endif %}>{{ org.org_name }}</option>
                                                            {% endfor %}
                                                        {% endif %}
                                                    </select>

                                                </div>
                                            </div>
                                            {% else %}
                                                <input type="hidden" name="org_id" value="{{ data.ticket_org_id }}">
                                            {% endif %}
                                            <input type="hidden" id="mode" name="mode" value="{{ mode }}">
                                            {% if  user.user_type == '0' %}
                                            <div class="form-group">
                                                <label class="col-md-3 col-sm-3 control-label">Submitted By: </label>
                                                <div class="col-md-4 col-sm-4">
                                                    <select name="caller_id" id="caller_id" data-plugin-selectTwo class="form-control populate placeholder" data-plugin-options='{ "placeholder": "Select User", "allowClear": true }'>
                                                        <option value="" readonly="readonly" >Select User</option>
                                                        {% if users %}
                                                            {% for user in users %}
                                                                <option value="{{ user.id }}" {% if user.id == data.ticket_caller_id %}selected{% endif %}>{{ user.display_name }}</option>
                                                            {% endfor %}
                                                        {% endif %}
                                                    </select>
                                                </div>
                                                <div class="col-md-4 col-sm-4 align-text">
                                                {% if data.submitted_at %}
                                                    {% get_tickets_dateTime_by_timezone1 data.submitted_at request.user.id as dateTime %}
                                                    <p class="text-info space_bottom_0">on {{ dateTime }}</p>
                                                {% endif %}
                                                </div>

                                            </div>
                                                {% else %}
                                                    <div class="form-group">
                                                <label class="col-md-3 col-sm-3 control-label">Submitted By: </label>
                                                <div class="col-md-4 col-sm-4">
                                                   {% if data.submitted_at %}
                                                {% get_tickets_dateTime_by_timezone1 data.submitted_at request.user.id as dateTime %}
                                                <label>{{ data.ticket_caller.display_name}}</label>
                                            {% endif %}
                                                </div>


                                            </div>
                                            {% endif %}
                                            <div class="form-group">
                                                <label class="col-md-3 col-sm-3 control-label"><span class="required">*</span> Account: </label>
                                                <div class="col-md-4 col-sm-4">
                                                    <select name="account_id" id="account_id" required="required" title="Select Account" data-plugin-selectTwo class="form-control populate placeholder" data-plugin-options='{ "placeholder": "Select an Account", "allowClear": true }'>
                                                        <option value="" readonly="readonly" >Select Account </option>
                                                        {% if accounts %}
                                                            {% for account in accounts %}
                                                                <option value="{{ account.id }}" {% if account.id == data.account_id %}selected{% endif %}>{{ account.acc_name }} - {{ account.client }}</option>
                                                            {% endfor %}
                                                        {% endif %}
                                                    </select>
                                                </div>
                                            </div>
                                            <div id="results"></div>
                                            <!-- <div class="form-group">
                                                <label class="col-md-3 col-sm-3 control-label">Client Information:</label>
                                                <div class="col-md-4 col-sm-4">
                                                    <select name="clientinfo_id" id="clientinfo_id" data-plugin-selectTwo class="form-control populate placeholder" data-plugin-options='{ "placeholder": "Select an Client Information", "allowClear": true }'>
                                                        <option value="" > </option>
                                                        {% if clientinformations %}
                                                            {% for clientinfo in clientinformations %}
                                                                <option value="{{ clientinfo.clientinfo_id }}" {% if clientinfo.clientinfo_id == data.ticket_clientinformation_id %}selected{% endif %}>{{ clientinfo.record_locator }}</option>
                                                            {% endfor %}
                                                        {% endif %}
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-md-3 col-sm-3 control-label"></label>
                                                <div class="col-md-8 col-sm-8">
                                                	<div class="bg-info" style="padding: 15px 15px">
	                                                    <div class="form-group">
	                                                        <label class="col-md-2 col-sm-5 space_right_0">Record Locator: </label>
	                                                        <div class="col-md-4 col-sm-7">
	                                                            <input type="text" name="record_locator" id="record_locator" value="{{ data.ticket_record_locator }}" class="form-control" placeholder="eg.: ABC" />
	                                                        </div>
	                                                        <label class="col-md-2 col-sm-5 space_right_0">Caller Name: </label>
	                                                        <div class="col-md-4 col-sm-7">
	                                                            <input type="text" name="caller_name" id="caller_name" value="{{ data.ticket_caller_name }}" class="form-control" placeholder="eg.: XYZ" />
	                                                        </div>
	                                                    </div>
	                                                    <div class="form-group">
	                                                        <label class="col-md-2 col-sm-5 space_right_0">Caller Phone: </label>
	                                                        <div class="col-md-4 col-sm-7">
	                                                            <input name="caller_phone" id="caller_phone" value="{{ data.ticket_caller_phone }}" data-plugin-masked-input data-input-mask="(999) 999-9999" placeholder="(123) 123-1234" class="form-control">
	                                                        </div>
	                                                        <label class="col-md-2 col-sm-5 space_right_0">Caller Email: </label>
	                                                        <div class="col-md-4 col-sm-7">
	                                                            <input type="email" name="caller_email" id="caller_email" value="{{ data.ticket_caller_email }}" class="form-control" placeholder="eg.: example@xyz.com" />
	                                                        </div>
	                                                    </div>
	                                                    <div class="form-group">
	                                                        <label class="col-md-2 col-sm-5 space_right_0">Passenger Name: </label>
	                                                        <div class="col-md-4 col-sm-7">
	                                                            <input type="text" name="passenger_name" id="passenger_name" value="{{ data.ticket_passenger_name }}" class="form-control" placeholder="eg.: ABC" />
	                                                        </div>
	                                                    </div>
	                                                </div>
                                                </div>
                                            </div> -->
                                            <div class="form-group">
                                                <label class="col-md-3 col-sm-3  control-label"><span class="required">*</span> Subject: </label>
                                                <div class="col-md-5 col-sm-6">
                                                    <input type="text" name="subject" id="subject" class="form-control" value="{{ data.subject }}" placeholder="eg.: ABC" title="Enter Subject" required/>
                                                </div>
                                            </div>
                                            
                                            <div class="form-group">
                                                <label class="col-md-3 col-sm-3  control-label"><span class="required">*</span> Description: </label>
                                                <input type="hidden" name="description_code" id="description_code" value="{{ data.description }}">
                                                <div class="col-md-8 col-sm-8">
                                                	<div class="well well-sm" id="description">
                                                        <div class="column-edit"><a href="{% url 'editDescTicket' %}?ticketNbr={% get_encrypted_id data.ticket_id %}">edit</a></div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-md-3 col-sm-3 control-label"><span class="required">*</span> Ticket Type:</label>
                                                <div class="col-md-5 col-sm-6">
                                                    <select name="ticket_type" id="ticket_type_parent" required="required" title="Select Ticket Type" data-plugin-selectTwo class="form-control populate ticket_type placeholder" data-plugin-options='{ "placeholder": "Select an Ticket Type", "allowClear": true }'>
                                                        <option value="" readonly="readonly" >Select Ticket Type </option>
                                                        {% if ticketTypes %}
                                                            {% for ttype in ticketTypes %}
                                                                <option value="{{ ttype.ttype_id }}" {% if ttype.ttype_id == data.ticket_type_id %}selected{% endif %}>{{ ttype.ttype_name }}</option>
                                                            {% endfor %}
                                                        {% endif %}
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-md-3 col-sm-3 control-label"><span class="required">*</span>Subtype 1:</label>
                                                <div class="col-md-5 col-sm-6">
                                                    <select name="subtype1" id="subtype1" title="Select Ticket Sub Type 1" required='required' data-plugin-selectTwo class="form-control populate ticket_type ticket_type_parent placeholder" data-plugin-options='{ "placeholder": "Select an SubType1", "allowClear": true }'>
                                                        <option value=""> </option>
                                                        {% if TicketSubTypes1 %}
                                                            {% for ttype in TicketSubTypes1 %}
                                                                <option value="{{ ttype.ttype_id }}" {% if ttype.ttype_id == data.ticket_subtype1_id %}selected{% endif %}>{{ ttype.ttype_name }}</option>
                                                            {% endfor %}
                                                        {% endif %}
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-md-3 col-sm-3 control-label">Subtype 2:</label>
                                                <div class="col-md-5 col-sm-6">
                                                    <select name="subtype2" id="subtype2" data-plugin-selectTwo class="form-control populate ticket_type subtype1 placeholder" data-plugin-options='{ "placeholder": "Select an Client", "allowClear": true }'>
                                                        <option value=""> </option>
                                                        {% if TicketSubTypes2 %}
                                                            {% for ttype in TicketSubTypes2 %}
                                                                <option value="{{ ttype.ttype_id }}" {% if ttype.ttype_id == data.ticket_subtype2_id %}selected{% endif %}>{{ ttype.ttype_name }}</option>
                                                            {% endfor %}
                                                        {% endif %}
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-md-3 col-sm-3 control-label">Subtype 3:</label>
                                                <div class="col-md-5 col-sm-6">
                                                    <select name="subtype3" id="subtype3" data-plugin-selectTwo class="form-control populate ticket_type subtype2 placeholder" data-plugin-options='{ "placeholder": "Select an Client", "allowClear": true }'>
                                                        <option value=""> </option>
                                                        {% if TicketSubTypes3 %}
                                                            {% for ttype in TicketSubTypes3 %}
                                                                <option value="{{ ttype.ttype_id }}" {% if ttype.ttype_id == data.ticket_subtype3_id %}selected{% endif %}>{{ ttype.ttype_name }}</option>
                                                            {% endfor %}
                                                        {% endif %}
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-md-3 col-sm-3 control-label">Subtype 4:</label>
                                                <div class="col-md-5 col-sm-6">
                                                    <select name="subtype4" id="subtype4" data-plugin-selectTwo class="form-control populate ticket_type subtype3 placeholder" data-plugin-options='{ "placeholder": "Select an Client", "allowClear": true }'>
                                                        <option value=""> </option>
                                                        {% if TicketSubTypes4 %}
                                                            {% for ttype in TicketSubTypes4 %}
                                                                <option value="{{ ttype.ttype_id }}" {% if ttype.ttype_id == data.ticket_subtype4_id %}selected{% endif %}>{{ ttype.ttype_name }}</option>
                                                            {% endfor %}
                                                        {% endif %}
                                                    </select>
                                                </div>
                                            </div>
                                            <!-- Action Permission check -->
                                            {% if "tm_Can_select_Priority_when_submitting_and_maintaining_Tickets"|check_action_permission:user.id %}
                                            <div class="form-group">
                                                <label class="col-md-3 col-sm-3 control-label">Priority: </label>
                                                <div class="col-md-5 col-sm-6">
                                                    <select name="priority" id="priority"  title="Select Priority" data-plugin-selectTwo class="form-control populate placeholder" data-plugin-options='{ "placeholder": "Select an Client", "allowClear": true }'>
                                                        <option value="" readonly="readonly" >Select Priority</option>
                                                        {% if priorities %}
                                                            {% for priority in priorities %}
                                                                <option value="{{ priority.priority_id }}" {% if priority.priority_id == data.priority_id %}selected{% endif %}>{{ priority.priority_name }}</option>
                                                            {% endfor %}
                                                        {% endif %}
                                                    </select>
                                                </div>
                                            </div>
                                            {%endif%}
                                            <div class="form-group">
                                                <label class="col-md-3 col-sm-3 control-label">Ticket Status:</label>
                                                <div class="col-md-2 col-sm-2">
                                                    <select name="ticket_status" id="ticket_status" class="form-control populate placeholder" {% if data.ticket_status == 0 %}disabled{% endif %}>
                                                        <option value="0" {% if data.ticket_status == 0 %}selected{% endif %}>Open</option>
                                                        <option value="1" {% if data.ticket_status == 1 %}selected{% endif %} >Closed</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-3 col-sm-4">
                                                    <!-- Action Permission check -->
                                                    {% if "tm_Can_select_Substatus_when_submitting_and_maintaining_Tickets"|check_action_permission:user.id %}
                                                    <select name="ticket_substatus" id="ticket_substatus" data-plugin-selectTwo class="form-control populate placeholder" data-plugin-options='{ "placeholder": "Select an Client", "allowClear": true }'>
                                                        <option value="" > </option>
                                                        {% if substatus %}
                                                            {% for sstatus in substatus %}
                                                                <option value="{{ sstatus.sub_status_id }}" {% if sstatus.sub_status_id == data.ticket_sub_status_id %}selected{% endif %}>{{ sstatus.sub_status_text }}</option>
                                                            {% endfor %}
                                                        {% endif %}
                                                    </select>
                                                    {% endif %}
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-md-3 col-sm-3 control-label">Is Traveler a VIP?: </label>
                                                <div class="col-md-5 col-sm-6">
                                                    <select class="form-control" name="traveler_vip" id="traveler_vip">
                                                        <option value=""></option>
                                                        <option value="0" {% if data.is_traveler_vip == '0' %}selected{% endif %}>Yes</option>
                                                        <option value="1" {% if data.is_traveler_vip == '1' %}selected{% endif %}>No</option>
                                                    </select>
                                                </div>
                                            </div>
                                             {% if user.user_type == '0' %}
                                            <div class="form-group">
                                                <label class="col-md-3 col-sm-3 control-label">Payout Required?: </label>
                                                <div class="col-md-5 col-sm-6">
                                                    <select class="form-control" name="payout_required" id="payout_required">
                                                        <option value=""></option>
                                                        <option value="0" {% if data.is_payout_required == '0' %}selected{% endif %}>Yes</option>
                                                        <option value="1" {% if data.is_payout_required == '1' %}selected{% endif %}>No</option>
                                                    </select>
                                                </div>
                                            </div>
                                            {% endif %}
                                            {% if user.user_type == '0' %}
                                            <div class="form-group">
                                                <label class="col-md-3 col-sm-3 control-label">Agent Error or Goodwill: </label>
                                                <div class="col-md-5 col-sm-6">
                                                    <select class="form-control" name="error_goodwill" id="error_goodwill">
                                                        <option value=""></option>
                                                        <option value="0" {% if data.agent_error_goodwill == '0' %}selected{% endif %}>Agent Error</option>
                                                        <option value="1" {% if data.agent_error_goodwill == '1' %}selected{% endif %}>Goodwill</option>
                                                    </select>
                                                </div>
                                            </div>
                                            {% endif %}
                                            <div class="form-group">
                                                <label class="col-sm-3 control-label">Amount Saved: </label>
                                                <div class="col-md-3 col-sm-3">
                                                    <input type="text" name="amount_saved" id="amount_saved" value="{{ data.amount_saved }}" class="form-control" placeholder="eg.: 123" />
                                                </div>
                                                <div class="col-md-2 col-sm-2">
                                                    <select id="currency" name="currency" title="Select Currency" data-plugin-selectTwo class="form-control populate placeholder" data-plugin-options='{ "placeholder": "Select an Currency", "allowClear": true }'>
                                                        <option value="" readonly="readonly" >Select Currency </option>
                                                            {% for curr in currency %}
                                                            <option value="{{ curr.currency_code }}" {% if curr.currency_code == data.ticket_currency %}selected{% endif %}>{{ curr.currency_code }}</option>
                                                            {% endfor %}
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-sm-3 control-label">Airline Ticket #: </label>
                                                <div class="col-md-5 col-sm-6">
                                                    <input type="text" name="airline_ticket" id="airline_ticket" value="{{ data.airline_ticket_no }}" class="form-control" placeholder="eg.: A111" />
                                                </div>
                                            </div>
                                            {% if user.user_type == '0' %}
                                            <div class="form-group">
                                                <label class="col-sm-3 control-label">Agent Responsible (if applic): </label>
                                                <div class="col-md-5 col-sm-6">
                                                    <!-- <input type="text" name="agent_responsible" id="agent_responsible" value="{% if data.agent_responsible %}{{ data.agent_responsible }}{% endif %}" class="form-control" placeholder="eg.: ABC" /> -->
                                                    <select id="agent_responsible" name="agent_responsible" data-plugin-selectTwo class="form-control populate placeholder" data-plugin-options='{ "placeholder": "Agent Responsible", "allowClear": true }'>
                                                        <option value="" readonly="readonly" >Select Agent Responsible</option>
                                                        
                                                            {% for agent in agent_sines %}
                                                            <option value="{{ agent.agent_name }}" {% if  agent.agent_name == data.agent_responsible %}selected{% endif %}>{{ agent.agent_name }}</option>
                                                            {% endfor %}
                                                        
                                                    </select>
                                                </div>
                                            </div>
                                            {% endif %}
                                            {% if user.user_type == '0' %}
                                            <div class="form-group">
                                                <label class="col-sm-3 control-label">Vendor Name Resp (if applic): </label>
                                                <div class="col-md-5 col-sm-6">
                                                    <input type="text" name="vendor_responsible" id="vendor_responsible" value="{% if  data.vendor_responsible %}{{ data.vendor_responsible }}{% endif %}" class="form-control" placeholder="eg.: XYZ" />
                                                </div>
                                            </div>
                                            {% endif %}
                                            {% if user.user_type == '0' %}
                                            <div class="form-group">
                                                <label class="col-sm-3 control-label">Resp Vendor's City (if applic): </label>
                                                <div class="col-md-5 col-sm-6">
                                                    <input type="text" name="vresponsible_city" id="vresponsible_city" value="{% if data.vresponsible_city %}{{ data.vresponsible_city }}{% endif %}" class="form-control" placeholder="" />
                                                </div>
                                            </div>
                                            {% endif %}
                                            {% if user.user_type == '0' %}
                                            <div class="form-group">
                                                <label class="col-sm-3 control-label">Amount of Payout: </label>
                                                <div class="col-md-5 col-sm-6">
                                                    <input type="text" name="ticket_payout_amount" id="ticket_payout_amount" value="{% if data.ticket_payout_amount %}{{ data.ticket_payout_amount }}{% endif %}" class="form-control" placeholder="" />
                                                </div>
                                            </div>
                                            {% endif %}
                                            {% if user.user_type == '0' %}
                                            <div class="form-group">
                                                <label class="col-sm-3 control-label">Pay to the order of: </label>
                                                <div class="col-md-5 col-sm-6">
                                                    <input type="text" name="ticket_order_of_pay" id="ticket_order_of_pay" value="{% if data.ticket_order_of_pay %}{{ data.ticket_order_of_pay }}{% endif %}" class="form-control" placeholder="" />
                                                </div>
                                            </div>
                                            {% endif %}
                                            {% if user.user_type == '0' %}
                                            <div class="form-group">
                                                <label class="col-sm-3 control-label">Attention: </label>
                                                <div class="col-md-5 col-sm-6">
                                                    <input type="text" name="ticket_attention" id="ticket_attention" value="{% if data.ticket_attention %}{{ data.ticket_attention }}{% endif %}" class="form-control" placeholder="" />
                                                </div>
                                            </div>
                                            {% endif %}
                                            {% if user.user_type == '0' %}
                                            <div class="form-group">
                                                <label class="col-sm-3 control-label">Company: </label>
                                                <div class="col-md-5 col-sm-6">
                                                    <input type="text" name="ticket_company" id="ticket_company" value="{% if data.ticket_company %}{{ data.ticket_company }}{% endif %}" class="form-control" placeholder="" />
                                                </div>
                                            </div>
                                            {% endif %}
                                            {% if user.user_type == '0' %}
                                            <div class="form-group">
                                                <label class="col-sm-3 control-label">Address: </label>
                                                <div class="col-md-5 col-sm-6">
                                                    <input type="text" name="ticket_address" id="ticket_address" value="{% if data.ticket_address %}{{ data.ticket_address }}{% endif %}" class="form-control" placeholder="" />
                                                </div>
                                            </div>
                                            {% endif %}
                                            {% if user.user_type == '0'  %}
                                            <div class="form-group">
                                                <label class="col-sm-3 control-label">Notes to print on check: </label>
                                                <div class="col-md-5 col-sm-6">
                                                    <input type="text" name="notes_on_check" id="notes_on_check" value="{% if data.notes_on_check %}{{ data.notes_on_check }}{% endif %}" class="form-control" placeholder="" />
                                                </div>
                                            </div>
                                            {% endif %}
                                            {% if user.user_type == '0' %}
                                            <div class="form-group">
                                                <label class="col-sm-3 control-label">Check Number: </label>
                                                <div class="col-md-5 col-sm-6">
                                                    <input type="text" name="check_number" id="check_number" value="{% if data.check_number %}{{ data.check_number }}{% endif %}" class="form-control" placeholder="" />
                                                </div>
                                            </div>
                                            {% endif %}
                                            {% if user.user_type == '0' %}
                                            <div class="form-group">
                                                <label class="col-sm-3 control-label">Who Approved?: </label>
                                                <div class="col-md-5 col-sm-6">
                                                    <input type="text" name="check_approved_by" id="check_approved_by" value="{% if data.check_approved_by %}{{ data.check_approved_by }}{% endif %}" class="form-control" placeholder="" />
                                                </div>
                                            </div>
                                            {% endif %}
                                            {% if user.user_type == '0' %}
                                            <div class="form-group">
                                                <label class="col-sm-3 control-label">Correction / Containment Actions: </label>
                                                <div class="col-md-5 col-sm-6">
                                                    <input type="text" name="corr_cont_actions" id="corr_cont_actions" value="{% if data.corr_cont_actions %}{{ data.corr_cont_actions }}{% endif %}" class="form-control" placeholder="" title="Enter Correction / Containment Actions" />
                                                </div>
                                            </div>
                                            {% endif %}
                                            {% if user.user_type == '0' %}
                                            <div class="form-group">
                                                <label class="col-sm-3 control-label">Root Cause: </label>
                                                <div class="col-md-5 col-sm-6">
                                                    <textarea class="form-control" rows="3" name="ticket_root_cause" id="ticket_root_cause"  title="Enter Root Cause" data-plugin-maxlength maxlength="7800">{% if data.ticket_root_cause %}{{ data.ticket_root_cause }}{% endif %}</textarea>
                                                    <p>
                                                        <code>max-length</code> set to 7800 characters.
                                                    </p>
                                                </div>
                                            </div>
                                            {% endif %}
                                            {% if user.user_type == '0' %}
                                            <div class="form-group">
                                                <label class="col-sm-3 control-label">Corrective Action: </label>
                                                <div class="col-md-5 col-sm-6">
                                                    <textarea class="form-control" rows="3" name="corrective_action" id="corrective_action"  title="Enter Corrective Actions" data-plugin-maxlength maxlength="7800">{% if data.corrective_action %}{{ data.corrective_action }}{% endif %}</textarea>
                                                    <p>
                                                        <code>max-length</code> set to 7800 characters.
                                                    </p>
                                                </div>
                                            </div>
                                            {% endif %}
                                            {% if user.user_type == '0' %}
                                                <!---Permisisons Check--->
                                                {% if "Ag_perm_Can_assign_tickets"|check_action_permission:user.id %}
                                                {% if user.user_type == '0'%}
                                                <div class="form-group" id="assign_to_section">
                                                    <label class="col-md-3 col-sm-3 control-label">Assigned To:</label>
                                                    <div class="col-md-5 col-sm-6">
                                                        <select name="assign_to" id="assign_to" data-plugin-selectTwo class="form-control populate placeholder" data-plugin-options='{ "placeholder": "Select User", "allowClear": true }'></select>
                                                    </div>
                                                </div>
                                                {% endif %}
                                                {% endif %}
                                            {% else %}
                                            {% if user.user_type == '0'%}
                                                <div class="form-group" id="">
                                                    <label class="col-md-3 col-sm-3 control-label">Assigned To:</label>
                                                    <div class="col-md-5 col-sm-6">
                                                        <p>{{data.ticket_assign_to.display_name }}</p>
    {#                                                    <select name="assign_to" id="assign_to" data-plugin-selectTwo class="form-control populate placeholder" data-plugin-options='{ "placeholder": "Select User", "allowClear": true }'>#}
    {#                                                    </select>#}
                                                    </div>
                                                </div>
                                            {% endif %}
                                            {% endif %}
                                            <!-- Action Permission check -->
                                            {% if "wf_Can_assign_Next_Action"|check_action_permission:user.id %}
                                            <div class="form-group" id="next_action_section">
                                                <label class="col-md-3 col-sm-3 control-label">Next Action:</label>
                                                <div class="col-md-5 col-sm-6">
                                                    <select name="next_action" id="next_action" data-plugin-selectTwo class="form-control populate placeholder" data-plugin-options='{ "placeholder": "Select an Client", "allowClear": true }'>
                                                        <option value=""> </option>
                                                        {% if users %}
                                                            {% for user in users %}
                                                                {%if user.id == user.id%}
                                                                    <!-- Action Permission check -->
                                                                    {% if "wf_Can_be_assigned_Next_Action"|check_action_permission:user.id %}
                                                                        <option value="{{ user.id }}" {% if user.id == data.ticket_next_action_id %}selected{% endif %}>{{ user.display_name }}</option>
                                                                    {%endif%}
                                                                {%else%}
                                                                    <option value="{{ user.id }}" {% if user.id == data.ticket_next_action_id %}selected{% endif %}>{{ user.display_name }}</option>
                                                                {%endif%}
                                                            {% endfor %}
                                                        {% endif %}
                                                    </select>
                                                </div>
                                            </div>
                                            {% endif %}
                                            <!-- CHECK PERMISISON FOR CLOSED TICKET -->
                                            {%if data.ticket_status == 1 %} 
                                                <!-- Action Permission check -->
                                                {% if "tm_Can_add_Notes_to_closed_Tickets"|check_action_permission:user.id %}
                                                <div class="form-group" id="add_note_section">
                                                    <label class="col-md-3 control-label">New Note:</label>
                                                    <div class="col-md-8 col-sm-9">
                                                        <textarea class="summernote" id="ticket_note" name="ticket_note" required="required" data-plugin-summernote data-plugin-options='{ "height": 180, "codemirror": { "theme": "ambiance" } }'></textarea>
                                                    </div>
                                                    <!-- Action Permission check -->
                                                    {% if "da_Can_view_and_add_Private_Notes_in_Tickets"|check_action_permission:user.id %}
                                                    <div class="col-sm-6 col-md-offset-3">
                                                        <div class="checkbox">
                                                            <label>
                                                                <input type="checkbox" name="is_private" value="1">
                                                                <strong>Private Note </strong>
                                                            </label>
                                                        </div>
                                                    </div>
                                                    {%endif%}
                                                </div>
                                                {% endif %}
                                            {%else%}
                                                <div class="form-group" id="add_note_section">
                                                    <label class="col-md-3 control-label">New Note:</label>
                                                    <div class="col-md-8 col-sm-9">
                                                        <textarea class="summernote" id="ticket_note" name="ticket_note" required="required" data-plugin-summernote data-plugin-options='{ "height": 180, "codemirror": { "theme": "ambiance" } }'></textarea>
                                                    </div>
                                                    <!-- Action Permission check -->
                                                    {% if "da_Can_view_and_add_Private_Notes_in_Tickets"|check_action_permission:user.id %}
                                                    <div class="col-sm-6 col-md-offset-3">
                                                        <div class="checkbox">
                                                            <label>
                                                                <input type="checkbox" name="is_private" value="1">
                                                                <strong>Private Note </strong>
                                                            </label>
                                                        </div>
                                                    </div>
                                                    {%endif%}
                                                </div>
                                            {% endif %}

                                            {% if "tm_Can_enter_Labor_Hours_when_entering_Notes_completing_Tasks_in_Tickets"|check_action_permission:user.id %}
                                            <div class="form-group">
                                                <label class="col-md-3 col-sm-3 control-label">Labor Hours:</label>
                                                <div class="col-md-6 col-sm-6">
                                                	<div class="row labour-timer">
	                                                    <div class="col-md-2 col-sm-3 col-xs-4 labour-div">
	                                                        <input type="text" name="labour_hours_hours" id="labour_hours_hours" value="0" class="form-control" maxlength="6" onblur="checkNumericRequired(this)" oninput="this.value = this.value.replace(/[^0-9]/g, '').replace(/(\..*)\./g, '$1');" />
	                                                    </div>
	                                                    <div class="labour-div slash">:</div>
	                                                    <div class="col-md-2 col-sm-3 col-xs-4 labour-div">
	                                                        <input type="text" name="labour_hours_minutes" id="labour_hours_minutes" value="0" class="form-control" maxlength="2" onblur="checkNumericRequired(this)" oninput="this.value = this.value.replace(/[^0-9]/g, '').replace(/(\..*)\./g, '$1');" />
	                                                    </div>
                                                    	<small class="text-info text-bold">hrs:mins</small>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            {% endif %}
                                            <!-- <div class="form-group">
                                                 <label class="col-sm-3 control-label" for="inputSuccess"></label>
                                                 <div class="col-sm-6">
                                                     <div class="checkbox">
                                                         <label>
                                                            <input type="checkbox" name="is_active" {% if data.taskgroup_is_active == True %}checked{% endif %} />
                                                               <i>Active</i>
                                                         </label>
                                                     </div>
                                                </div>
                                              </div> -->
                                                <!-- Action Permission check -->
                                                {% if "wf_Can_view_Tasks_in_Tickets"|check_action_permission:user.id %}

                                                <div class="form-group">

                                                    <label class="col-sm-3 control-label">
                                                        <a class="mb-xs mt-xs mr-xs modal-sizes btn btn-primary" href="#modalLG">Task Manager</a>
                                                    </label>

                                                    <!-- Modal Form For Task Manager Start-->
                                                    <div id="modalLG" class="modal-block modal-block-lg mfp-hide">
                                                        <section class="panel">
                                                            <header class="panel-heading">
                                                                <h2 class="panel-title">Task Manager</h2>
                                                                <a href="javascript:void(0)"  onclick="closePopUp();" class="close-popup modal-dismiss">&times;</a>
                                                            </header>
                                                            <div class="panel-body">
                                                                <div class="show-notes text-right">
                                                                    <a href="javascript:void(0);"><span class="show-link">show notes</span><span class="hide-link show-link">hide notes</span></a>
                                                                </div>
                                                                <form id="modalForm" action="{% url 'updateTaskGroup' %}" method="post" class="form-horizontal">
                                                                    <div class="table-responsive">
                                                                        <table class="table table-bordered table-task-modal">
                                                                            <thead>
                                                                                <tr>
                                                                                    <th></th>
                                                                                    <th>Task</th>
                                                                                    <th>Assigned To</th>
                                                                                    <th>Due Date</th>
                                                                                    <th>Depend Order</th>
                                                                                    <th>Type</th>
                                                                                    <th>Completed Date</th>
                                                                                </tr>
                                                                            </thead>
                                                                            <tbody>

                                                                            </tbody>
                                                                        </table>
                                                                    </div>
                                                                    <div class="modal-buton">
                                                                        <input type="button" class="btn btn-primary clear-btn" value="New Task" name="btnAdd" id="BtnNewTask">
                                                                        <input type="button" class="btn btn-primary clear-btn" value="Add Task Group" id="btnAddTaskGroup">
                                                                        <input type="button" class="btn btn-primary clear-btn modal-dismiss" value="Save" name="btnDone" id="btnDone">
                                                                        <input type="button" class="btn btn-primary clear-btn" value="Reset" name="btnReset" id="btnReset">
                                                                        <input type="button" class="btn btn-primary show-btn" value="Cancel" id="cancelbtn">
                                                                        <input type="button" class="btn btn-primary show-btn" value="Accept" id="accept-btn">
                                                                        <input type="button" class="btn btn-primary show-btn task-group" value="Add Task Group" id="accept-btn">
                                                                    </div>
                                                                    <div class="addNewTask space-top-custom">
                                                                        <div class="form-group">
                                                                            <label class="col-sm-3 control-label">Task Order:</label>
                                                                            <div class="col-sm-2">
                                                                                <input type="text" class="form-control input-sm"  name="modal_task_order" id="modal_task_order" oninput="this.value = this.value.replace(/[^0-9]/g, '').replace(/(\..*)\./g, '$1');">
                                                                            </div>
                                                                        </div>
                                                                        <div class="form-group">
                                                                            <label class="col-sm-3 control-label"><span class="required">*</span> Task:</label>
                                                                            <div class="col-md-4 col-sm-4">
                                                                                <select class="form-control" name="modal_task_id" id="modal_task_id">
                                                                                    <option selected=""></option>
                                                                                    {% for task in tasks %}
                                                                                    <option value="{{ task.task_id }}">{{ task.task_description }}</option>
                                                                                    {% endfor %}
                                                                                </select>
                                                                            </div>
                                                                        </div>
                                                                        <div class="form-group">
                                                                            <label class="col-sm-3 control-label"><span class="required">*</span> Task Type:</label>
                                                                            <div class="col-md-4 col-sm-4 align-lable">
                                                                                <div class="display-inline task-complete">
                                                                                    <input type="radio" name="modal_task_type" class="modal_task_type" id="modal_task_type1" value="0" checked>
                                                                                    <label for="complete">Complete</label>&nbsp;
                                                                                    <div class="custom-tooltip">
                                                                                        <div class="tooltip-header">
                                                                                            Task Type: Complete
                                                                                        </div>
                                                                                        <div class="tooltip-body">
                                                                                            <p>Select 'Complete' as the Task Type if this Task only requires the user to mark it 'Complete' in order to complete it.</p>
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                                <div class="display-inline task-option">
                                                                                    <input type="radio" name="modal_task_type" class="modal_task_type" id="modal_task_type2" value="1">
                                                                                    <label for="Ye/NO">Yes/No/NA</label>
                                                                                    <div class="custom-tooltip">
                                                                                        <div class="tooltip-header">
                                                                                            Task Type: Yes/No/NA
                                                                                        </div>
                                                                                        <div class="tooltip-body">
                                                                                            <p>Select 'Yes/No/NA' as the Task Type if this Task requires the user to respond with either 'Yes' or 'No' or 'NA' in order to complete it.</p>
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <div class="incomplete_ticket_type">
                                                                            <div class="form-group">
                                                                            <label class="col-sm-3 control-label">If Response:</label>
                                                                            <div class="col-lg-8 col-md-8 col-sm-8 response-top-space">
                                                                                <div class="row">
                                                                                    <small class="col-sm-4">Add Task Group=</small>
                                                                                    <small class="col-sm-2">Cancel All Open Tasks</small>
                                                                                    <small class="col-sm-2">Close Ticket</small>
                                                                                    <small class="col-sm-4">Update Substatus to =</small>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                            <div class="form-group">
                                                                                <label class="col-sm-3 control-label">=Yes</label>
                                                                                <div class="col-md-8 col-sm-8">
                                                                                    <div class="row">
                                                                                        <div class="col-sm-4">
                                                                                            <select class="form-control modal_task_type_group_id" name="modal_task_type_group_id1" id="modal_task_type_group_id1">
                                                                                                <option selected=""> </option>
                                                                                                {% if taskGroups %}
                                                                                                    {% for taskGroup in taskGroups %}
                                                                                                        <option value="{{ taskGroup.taskgroup_id }}" >{{ taskGroup.taskgroup_description }}</option>
                                                                                                    {% endfor %}
                                                                                                {% endif %}
                                                                                            </select>
                                                                                        </div>
                                                                                        <label class="col-sm-2 align-text">
                                                                                            <input type="checkbox" name="modal_cancel_open_task1" id="modal_cancel_open_task1" class="modal_cancel_open_task" value="1">
                                                                                        </label>
                                                                                        <label class="col-sm-2 align-text">
                                                                                            <input type="checkbox" name="modal_task_type_close_ticket1" id="modal_task_type_close_ticket1" class="modal_task_type_close_ticket" data-id="1" value="1">
                                                                                        </label>
                                                                                        <div class="col-sm-4">
                                                                                            <select class="form-control modal_task_type_substatus_id" name="modal_task_type_substatus_id1" id="modal_task_type_substatus_id1">
                                                                                                <option value=""> </option>
                                                                                                {% if substatus %}
                                                                                                    {% for sstatus in substatus %}
                                                                                                        <option value="{{ sstatus.sub_status_id }}">{{ sstatus.sub_status_text }}</option>
                                                                                                    {% endfor %}
                                                                                                {% endif %}
                                                                                            </select>
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                            <div class="form-group">
                                                                                <label class="col-sm-3 control-label">=No</label>
                                                                                <div class="col-md-8 col-sm-8">
                                                                                    <div class="row">
                                                                                        <div class="col-sm-4">
                                                                                            <select class="form-control modal_task_type_group_id" name="modal_task_type_group_id2" id="modal_task_type_group_id2">
                                                                                                <option selected=""> </option>
                                                                                                {% if taskGroups %}
                                                                                                    {% for taskGroup in taskGroups %}
                                                                                                        <option value="{{ taskGroup.taskgroup_id }}" >{{ taskGroup.taskgroup_description }}</option>
                                                                                                    {% endfor %}
                                                                                                {% endif %}
                                                                                            </select>
                                                                                        </div>
                                                                                        <label class="col-sm-2 align-text">
                                                                                            <input type="checkbox" name="modal_cancel_open_task2" id="modal_cancel_open_task2" class="modal_cancel_open_task" value="1">
                                                                                        </label>
                                                                                        <label class="col-sm-2 align-text">
                                                                                            <input type="checkbox" name="modal_task_type_close_ticket2" id="modal_task_type_close_ticket2" class="modal_task_type_close_ticket"  data-id="2" value="1">
                                                                                        </label>
                                                                                        <div class="col-sm-4">
                                                                                            <select class="form-control modal_task_type_substatus_id" name="modal_task_type_substatus_id2" id="modal_task_type_substatus_id2">
                                                                                                <option value=""> </option>
                                                                                                {% if substatus %}
                                                                                                    {% for sstatus in substatus %}
                                                                                                        <option value="{{ sstatus.sub_status_id }}">{{ sstatus.sub_status_text }}</option>
                                                                                                    {% endfor %}
                                                                                                {% endif %}
                                                                                            </select>
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                            <div class="form-group">
                                                                                <label class="col-sm-3 control-label">=N/A</label>
                                                                                <div class="col-md-8 col-sm-8">
                                                                                    <div class="row">
                                                                                        <div class="col-sm-4">
                                                                                            <select class="form-control modal_task_type_group_id" name="modal_task_type_group_id3" id="modal_task_type_group_id3">
                                                                                                <option selected=""> </option>
                                                                                                {% if taskGroups %}
                                                                                                    {% for taskGroup in taskGroups %}
                                                                                                        <option value="{{ taskGroup.taskgroup_id }}" >{{ taskGroup.taskgroup_description }}</option>
                                                                                                    {% endfor %}
                                                                                                {% endif %}
                                                                                            </select>
                                                                                        </div>
                                                                                        <label class="col-sm-2 align-text">
                                                                                            <input type="checkbox" name="modal_cancel_open_task3" id="modal_cancel_open_task3" class="modal_cancel_open_task" value="1">
                                                                                        </label>
                                                                                        <label class="col-sm-2 align-text">
                                                                                            <input type="checkbox" name="modal_task_type_close_ticket3" id="modal_task_type_close_ticket3" class="modal_task_type_close_ticket"  data-id="3" value="1">
                                                                                        </label>
                                                                                        <div class="col-sm-4">
                                                                                            <select class="form-control modal_task_type_substatus_id" name="modal_task_type_substatus_id3" id="modal_task_type_substatus_id3">
                                                                                                <option value=""> </option>
                                                                                                {% if substatus %}
                                                                                                    {% for sstatus in substatus %}
                                                                                                        <option value="{{ sstatus.sub_status_id }}">{{ sstatus.sub_status_text }}</option>
                                                                                                    {% endfor %}
                                                                                                {% endif %}
                                                                                            </select>
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <br>
                                                                        <div class="form-group">
                                                                            <label class="col-sm-3 control-label">Note:</label>
                                                                            <div class="col-sm-9">
                                                                                <textarea class="form-control" name="modal_task_note" id="modal_task_note" rows="9" cols="68"></textarea>
                                                                            </div>
                                                                        </div>
                                                                        <input type="hidden" id="modal_task_mgr_id">
                                                                        <div class="form-group">
                                                                            <label class="col-sm-3 control-label">Due Date:</label>
                                                                            <div class="col-md-4 col-sm-4">
                                                                                <div class="input-group">
                                                                                    <span class="input-group-addon">
                                                                                        <i class="fa fa-calendar"></i>
                                                                                    </span>
                                                                                    <input type="text" id="modal_due_date" name="modal_due_date" data-plugin-datepicker class="form-control datepicker" />
                                                                                </div>
                                                                            </div>
                                                                            <div class="col-md-2 col-sm-3">
                                                                                <span class="text-primary">mm/dd/yyyy</span>
                                                                            </div>
                                                                        </div>
                                                                        <div class="form-group">
                                                                            <label class="col-sm-3 control-label">Dependency: </label>
                                                                            <div class="col-md-4 col-sm-4 align-text">
                                                                                <div class="row">
                                                                                    <div class="radio-primary form-check col-sm-7 align-lable">
                                                                                        <div class="display-inline dependency-none">
                                                                                            <input class="form-check-input radio-inline modal_dependency" type="radio" id="modal_dependency1" name="modal_dependency" value="0" checked>
                                                                                            <label for="task_type" class="form-check-label">None &nbsp; </label>
                                                                                            <div class="custom-tooltip">
                                                                                                <div class="tooltip-header">
                                                                                                    Dependency: None
                                                                                                </div>
                                                                                                <div class="tooltip-body">
                                                                                                    <p>Select 'None' as the Dependency if this task is not dependent on other tasks.</p>
                                                                                                </div>
                                                                                            </div>
                                                                                        </div>
                                                                                        <div class="display-inline dependency-order">
                                                                                            <input class="form-check-input radio-inline modal_dependency" type="radio" id="modal_dependency2" name="modal_dependency" value="1">
                                                                                            <label for="task_type" class="form-check-label">Order</label>
                                                                                            <div class="custom-tooltip">
                                                                                                <div class="tooltip-header">
                                                                                                    Dependency: Order
                                                                                                </div>
                                                                                                <div class="tooltip-body">
                                                                                                    <p>Select 'Order' as the Dependency to enter an order number.  Tasks with a lower order must be completed before tasks with a higher order.</p>
                                                                                                </div>
                                                                                            </div>
                                                                                        </div>
                                                                                    </div>
                                                                                    <div class="col-sm-5">
                                                                                        <input type="text" name="modal_dependency_order" id="modal_dependency_order" oninput="this.value = this.value.replace(/[^0-9]/g, '').replace(/(\..*)\./g, '$1');" class="form-control input-inline" placeholder="eg.: 1" />
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <!-- Action Permission check -->
                                                                        {% if "wf_Can_assign_Tasks"|check_action_permission:user.id %}
                                                                        <div class="form-group">
                                                                            <label class="col-md-3 col-sm-3 control-label">Assigned To </label>
                                                                            <div class="col-md-4 col-sm-4">
                                                                                <select name="modal_task_assign_to" id="modal_task_assign_to" data-plugin-selectTwo required class="form-control populate placeholder" data-plugin-options='{ "placeholder": "Select an Task", "allowClear": true }'>
                                                                                    <option value="">-Unassigned-</option>
                                                                                    {% if agents %}
                                                                                        {% for agent in agents %}
                                                                                            <!-- Action Permission check -->
                                                                                            {%if agent.id == user.id %}
                                                                                                {%if "wf_Can_be_assigned_Tasks"|check_action_permission:user.id %}
                                                                                                    <option value="{{ agent.id }}" >{{ agent.display_name }}</option>
                                                                                                {%endif%}
                                                                                            {%else%}
                                                                                                <option value="{{ agent.id }}" >{{ agent.display_name }}</option>
                                                                                            {%endif%}
                                                                                        {% endfor %}
                                                                                    {% endif %}
                                                                                </select>
                                                                            </div>
                                                                        </div>
                                                                        {% endif %}
                                                                        <div class="form-group">
                                                                            <label class="col-md-3 col-sm-3 control-label">Is Cancelled? </label>
                                                                            <div class="col-md-4 col-sm-4 align-lable">
                                                                                <label>
                                                                                    <input type="checkbox" id="modal_is_cancel" name="modal_is_cancel" value="1" data-mode="task-add">
                                                                                </label>
                                                                                <label for="chkCancelled">
                                                                                    <img alt="Cancelled" src="{% static 'itrak/images/RedCircleLine.gif' %} " border="0" id="imgCancelled" style="">
                                                                                </label>
                                                                            </div>
                                                                        </div>
                                                                        <div id="taskEditDiv" hidden>
                                                                            <div class="form-group" id="taskCompleteDiv">
                                                                                <label class="col-md-3 col-sm-3 control-label">Is Completed? </label>
                                                                                <div class="col-md-4 col-sm-4 align-lable">
                                                                                    <label>
                                                                                        <input type="checkbox" id="modal_is_complete" name="modal_is_complete" value="1" data-mode="task-add">
                                                                                    </label>
                                                                                    <span id="spnCompletedDateEdit"></span>
                                                                                </div>
                                                                            </div>
                                                                            <div class="form-group" id="taskCompleteResponseDiv" hidden>
                                                                                <label class="col-md-3 col-sm-3 control-label">Response: </label>
                                                                                <div class="col-md-6 col-sm-6">
                                                                                    <div class="radio-primary form-check">
                                                                                        <label for="task_type" class="form-check-label">
                                                                                            <input class="form-check-input radio-inline modal_complete_response" type="radio" id="modal_complete_response_yes" name="modal_complete_response" value="1" checked>
                                                                                            Yes </label>
                                                                                        <label for="task_type" class="form-check-label">
                                                                                            <input class="form-check-input radio-inline modal_complete_response" type="radio" id="modal_complete_response_no" name="modal_complete_response" value="2">
                                                                                            No </label>
                                                                                        <label for="task_type" class="form-check-label">
                                                                                            <input class="form-check-input radio-inline modal_complete_response" type="radio" id="modal_complete_response_na" name="modal_complete_response" value="3">
                                                                                            N/A </label>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                            <!-- Action Permission check -->
                                                                            {% if "tm_Can_enter_Labor_Hours_when_entering_Notes_completing_Tasks_in_Tickets"|check_action_permission:user.id %}
                                                                            <div class="form-group">
                                                                                <label class="col-md-3 col-sm-3 control-label">Labor Hours:</label>
                                                                                <div class="col-md-6 col-sm-6">
                                                                                    <div class="row  labour-timer">
                                                                                        <div class="col-md-2 col-sm-3 col-xs-4 labour-div">
                                                                                            <input type="text" name="modal_labour_hours_hours" id="modal_labour_hours_hours" value="0" class="form-control" maxlength="6" onblur="checkNumericRequired(this)" oninput="this.value = this.value.replace(/[^0-9]/g, '').replace(/(\..*)\./g, '$1');" />
                                                                                        </div>
                                                                                        <div class="labour-div slash">:</div>
                                                                                        <div class="col-md-2 col-sm-3 col-xs-4 labour-div">
                                                                                            <input type="text" name="modal_labour_hours_minutes" id="modal_labour_hours_minutes" value="0" class="form-control" maxlength="2" onblur="checkNumericRequired(this)" oninput="this.value = this.value.replace(/[^0-9]/g, '').replace(/(\..*)\./g, '$1');" />
                                                                                        </div>
                                                                                        <small class="text-info text-bold">hrs:mins</small>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                            {%endif%}
                                                                            <div class="form-group">
                                                                                <label class="col-md-3 col-sm-3 control-label">Contract:</label>
                                                                                <div class="col-md-4 col-sm-4">
                                                                                    <select class="form-control modal_contract" name="modal_contract" id="modal_contract">
                                                                                        <option selected="">None</option>
                                                                                    </select>
                                                                                </div>
                                                                            </div>
                                                                            <div class="form-group">
                                                                                <label class="col-sm-3 control-label">Labor Note:</label>
                                                                                <div class="col-sm-9">
                                                                                    <textarea class="form-control" name="modal_labor_note" id="modal_labor_note" rows="5" cols="68"></textarea>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    <div class="addTaskGrpup space-top-custom">
                                                                        <div class="form-group">
                                                                            <label class="col-md-3 col-sm-3 control-label"><span class="required">*</span> Task Group:</label>
                                                                            <div class="col-md-4 col-sm-4">
                                                                                <select class="form-control modal_taskgroup_id" name="modal_taskgroup_id" id="modal_taskgroup_id">
                                                                                    <option selected=""> </option>
                                                                                    {% if taskGroups %}
                                                                                        {% for taskGroup in taskGroups %}
                                                                                            <option value="{{ taskGroup.taskgroup_id }}" >{{ taskGroup.taskgroup_description }}</option>
                                                                                        {% endfor %}
                                                                                    {% endif %}
                                                                                </select>
                                                                            </div>
                                                                        </div>
                                                                        <div class="form-group">
                                                                            <label class="col-sm-3 control-label">Insert a Task Order:</label>
                                                                            <div class="col-sm-2">
                                                                                <input type="text" class="form-control input-sm"  name="modal_task_group_order" id="modal_task_group_order" oninput="this.value = this.value.replace(/[^0-9]/g, '').replace(/(\..*)\./g, '$1');">
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </form>
                                                            </div>
                                                            <footer class="panel-footer">
                                                                <div class="row">
                                                                    <div class="col-md-12">
                                                                        <!-- <button class="btn btn-danger modal-dismiss">Cancel</button> -->

                                                                    </div>
                                                                </div>
                                                            </footer>

                                                            <!-- Delete Modal Popup on Task Manager Task Delete -->
                                                            <div class="modal fade" id="confirm-tsk-delete" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                                                                <div class="modal-dialog">
                                                                    <div class="modal-content">

                                                                        <div class="modal-header">
                                                                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                                                            <h4 class="modal-title" id="myModalLabel">Confirm Delete</h4>
                                                                        </div>

                                                                        <div class="modal-body">
                                                                            <p>You are about to delete a record, this procedure is irreversible.</p>
                                                                            <strong>Do you want to proceed?</strong>
                                                                        </div>

                                                                        <div class="modal-footer">
                                                                            <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                                                                            <a class="btn btn-danger btn-ok">Delete</a>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                    </section>
                                                </div>
                                                <!-- Modal Form For Task Manager End-->
                                                <div class="col-md-9">
                                                    <section class="panel full-width">
                                                        <div class="panel-body">
                                                            <div class="table-responsive">
                                                                <table class="table table-condensed mb-none table-tasks">
                                                                    <thead>
                                                                        <tr>
                                                                            <th>#</th>
                                                                            <th>Task</th>
                                                                            <th>Assgined To</th>
                                                                            <th>Completed</th>
                                                                            <th>Time</th>
                                                                        </tr>
                                                                    </thead>
                                                                    <tbody>

                                                                    </tbody>
                                                                </table>
                                                            </div>
                                                        </div>
                                                    </section>
                                                </div>

                                            </div>
                                            {%endif%}

                                            {% if data.ticket_status == 1 %}
                                                <div class="form-group">
                                                    <label class="col-md-3 col-sm-3 control-label">Closed By:</label>
                                                    <div class="col-md-8 col-sm-8">
                                                        <label>{{ data.ticket_closed_by.display_name }} </label>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label class="col-md-3 col-sm-3 control-label">Close Date:</label>
                                                    <div class="col-md-8 col-sm-8">
                                                {% get_tickets_dateTime_by_timezone data.ticket_closed_at request.user.id as dateTime %}
                                                <label>{{ dateTime }} </label>
                                            </div>
                                        </div>
                                        {% endif %}
                                    {% if data.ticket_is_reopen == 1 %}
                                        <div class="form-group">
                                            {% get_reopen_ticket_by_user data.ticket_is_reopen_by_id as user %}
                                            {% if user %}
                                                <label class="col-md-3 col-sm-3 control-label">Reopend By:</label>
                                                <div class="col-md-8 col-sm-8">
                                                    {% get_tickets_dateTime_by_timezone data.ticket_is_reopen_at request.user.id as dateTime %}
                                                    <label>{{ user.display_name }} at {{ dateTime }} </label>
                                                </div>
                                            {% endif %}
                                        </div>
                                    {% endif %}
                                    {% if "tm_Can_enter_Labor_Hours_when_entering_Notes_completing_Tasks_in_Tickets"|check_action_permission:user.id %}
                                    <div class="form-group">
                                        <label class="col-md-3 col-sm-3 control-label">Labor Hours:</label>
                                        <div class="col-md-8 col-sm-8">
                                            <label>{{ total_labour_hours }}</label>
                                        </div>
                                    </div>
                                    {% endif %}
                                    <div class="form-group">
                                        <label class="col-md-3 col-sm-3 control-label">Total Time Open:</label>
                                        <div class="col-md-8 col-sm-8">
                                            {% getTotalTimeOpenFormat total_time_open as totalTimeOpen %}
                                            <label>{{ totalTimeOpen }}</label>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-md-3 col-sm-3 control-label">Adj Time Open:</label>
                                        <div class="col-md-8 col-sm-8">
                                            {% getTotalTimeOpenFormat total_time_open as totalTimeOpen %}
                                            <label>{{ totalTimeOpen }}</label>
                                        </div>
                                    </div>

                                    {% if ticketNotes %}
                                        <div class="form-group">
                                             <label class="col-sm-3 control-label" for="inputSuccess"></label>
                                             <div class="col-sm-6">
                                                <a href="javascript:void(0)" name="showhide_notes" id="showhide_notes"><span class="show-link">show notes</span><span class="hide-link show-link">hide notes</span></a>
                                            </div>
                                        </div>
                                        {% for note in ticketNotes %}
                                        {% if note.is_private == 1 %}
                                          <!-- Action Permission check -->
                                          {% if "da_Can_view_and_add_Private_Notes_in_Tickets"|check_action_permission:user.id %}
                                        <div class="all-notes">
	                                        <div class="form-group">
	                                            {% get_tickets_dateTime_by_timezone note.note_created_at request.user.id as dateTime %}
	                                            <label class="col-md-3 col-sm-3 control-label">
	                                                {{ note.note_created_by.display_name }}:
	                                                <p>{{ dateTime }} <br/> 
                                                    {% if note.is_private == 1 %}
                                                        <b>Private</b>
                                                    {% endif %}
                                                </p>
	                                            </label>
	                                            <input type="hidden" id="note{{ note.note_id }}" value="{% if note.note_detail == '' %}Time value entered by system.{% else %}{{ note.note_detail }}{% endif %}">
	                                            <input type="hidden" id="note_hours{{ note.note_id }}" value='{{ note.hours|stringformat:".02d" }}:{{ note.minutes|stringformat:".02d" }}'>
	                                            <input type="hidden" id="note_update{{ note.note_id }}" value="{% if note.note_modified_by_id is None %}{% else %}<b>Note updated</b> by {% get_user_displayname_by_id note.note_modified_by_id %} on {% get_tickets_dateTime_by_timezone note.note_modified_at request.user.id %}{% endif %}">
	                                            <div class="col-md-8 col-sm-8">
	                                                <div class="well well-sm t_notes" data-hour="note_hours{{ note.note_id }}" data-update="note_update{{ note.note_id }}" name="note{{ note.note_id }}">
	                                                   <div class="column-edit">
	                                                       <a href="{% url 'editNoteTicket' %}?noteID={% get_encrypted_id note.note_id %}&ticketNbr={% get_encrypted_id data.ticket_id %}" data-hover="Edit Note">Edit</a>
                                                           <a href="#" data-href="{% url 'deleteNoteTicket' %}?noteID={% get_encrypted_id note.note_id %}&ticketNbr={% get_encrypted_id data.ticket_id %}" data-hover="Delete Ticket" data-toggle="modal" data-target="#confirm-delete">Del</a>
	                                                    </div>
	                                                </div>
	                                            </div>
	                                        </div>
	                                    </div>
                                    {% endif %}
                                    {%else%}
                                    <div class="all-notes">
                                        <div class="form-group">
                                            {% get_tickets_dateTime_by_timezone note.note_created_at request.user.id as dateTime %}
                                            <label class="col-md-3 col-sm-3 control-label">
                                                {{ note.note_created_by.display_name }}:
                                                <p>{{ dateTime }} <br/> 
                                                    {% if note.is_private == 1 %}
                                                        <b>Private</b>
                                                    {% endif %}
                                                </p>
                                            </label>
                                            <input type="hidden" id="note{{ note.note_id }}" value="{% if note.note_detail == '' %}Time value entered by system.{% else %}{{ note.note_detail }}{% endif %}">
                                            <input type="hidden" id="note_hours{{ note.note_id }}" value='{{ note.hours|stringformat:".02d" }}:{{ note.minutes|stringformat:".02d" }}'>
                                            <input type="hidden" id="note_update{{ note.note_id }}" value="{% if note.note_modified_by_id is None %}{% else %}<b>Note updated</b> by {% get_user_displayname_by_id note.note_modified_by_id %} on {% get_tickets_dateTime_by_timezone note.note_modified_at request.user.id %}{% endif %}">
                                            <div class="col-md-8 col-sm-8">
                                                <div class="well well-sm t_notes" data-hour="note_hours{{ note.note_id }}" data-update="note_update{{ note.note_id }}" name="note{{ note.note_id }}">
                                                    <div class="column-edit">
                                                    <a href="{% url 'editNoteTicket' %}?noteID={% get_encrypted_id note.note_id %}&ticketNbr={% get_encrypted_id data.ticket_id %}" data-hover="Edit Note">Edit</a>
                                                    <a href="#" data-href="{% url 'deleteNoteTicket' %}?noteID={% get_encrypted_id note.note_id %}&ticketNbr={% get_encrypted_id data.ticket_id %}" data-hover="Delete Ticket" data-toggle="modal" data-target="#confirm-delete">Del</a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    {% endif %}
                                    {% endfor %}
                                {% endif %}
                                </div>
                                <footer class="panel-footer">
                                    <div class="row">
                                        <div class="col-sm-12">
                                           <button class="btn btn-primary saveButton">Update</button>
                                            <button type="reset" onclick="resetForm()" class="btn btn-default btn-reset">Reset</button>
                                            <label class="required-lable"><span class="required">*</span> Required</label>
                                        </div>
                                    </div>
                                </footer>
                            </section>
                        </form>
                    </div>
                </div>
                <!-- end: page -->

            </section>
        </div>

        {# Delete Modal Popup on Delete#}
        <div class="modal fade" id="confirm-delete" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">

                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h4 class="modal-title" id="myModalLabel">Confirm Delete</h4>
                    </div>

                    <div class="modal-body">
                        <p>You are about to delete a record, this procedure is irreversible.</p>
                        <strong>Do you want to proceed?</strong>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                        <a class="btn btn-danger btn-ok">Delete</a>
                    </div>
                </div>
            </div>
        </div>

    {% endblock %}

    {% block script %}
        <script>
            if($('#mode').val() == "assignTo"){
                $('html, body').animate({
                    scrollTop: $("#assign_to_section").offset().top
                }, 1000);
            }else if($('#mode').val() == "nextAction"){
                $('html, body').animate({
                    scrollTop: $("#next_action_section").offset().top
                }, 1000);
            }else if($('#mode').val() == "addNote"){
                $('html, body').animate({
                    scrollTop: $("#add_note_section").offset().top
                }, 1000);
            }
            var globalArray = [];
            var date = new Date();
            var today = new Date(date.getFullYear(), date.getMonth(), date.getDate());
            var row_counter=0; var row_edit=0; var task_order_start=1;var task_order_end=1; settimer = 1000; var attach_badge = {{ ticket_attachments.count }}


            var optComponent = {
              format: 'mm-dd-yyyy',
              container: '#datePicker',
              orientation: 'auto top',
              todayHighlight: true,
              autoclose: true
            };

            $(function(){
                // COMPONENT
                $( '#datePicker' ).datepicker( optComponent );
                $( '#datePicker' ).datepicker( 'setDate', today );
                $('#description').append($('#description_code').val());

                var org_id = $('#org_id').val();
                var assigned_to = {% if data.ticket_assign_to_id == None %}''{% else %}{{ data.ticket_assign_to_id }}{% endif %};
                console.log(assigned_to)
                if (org_id != ''){
                    $.ajax({
                        type: 'POST',
                        url: "{% url 'getUsersByOrgId' %}",
                        data: {org_id: org_id},
                        dataType: 'json',
                        beforeSend: function(jqXHR, settings) {
                            //Do something before send...
                        },
                        success: function(data, textStatus, jqXHR) {
                            if(data.response) {
                                result = jQuery.parseJSON(data['response'])
                                $('#assign_to').html('<option value=""> </option>');
                                $.each(result, function (index) {
                                     $('#assign_to').append('<option value="' + result[index].pk + '">' + result[index].fields.display_name+ '</option>')

                                    });
                                $('#assign_to').select2("val", assigned_to);
                            }
                        },
                        error: function(jqXHR, textStatus, errorThrown) {
                            alert(textStatus + '. ' + errorThrown);
                        }
                    });
                }

                //Get Data Base Record If there is Any Exist
                var ticket_id = {{ data.ticket_id }};
                $.ajax({
                    type: 'POST',
                    url: "{% url 'getTaskManagerByTicketId' %}",
                    data: {ticket_id: ticket_id},
                    dataType: 'json',
                    beforeSend: function (jqXHR, settings) {
                        //Do something before send...
                    },
                    success: function (data, textStatus, jqXHR) {
                        if (data.response) {
                            result = jQuery.parseJSON(data['response'])
                            $.each(result, function (index) {
                                task_order_val = result[index].fields.tmgr_display_order
                                task_id_val = result[index].fields.tmgr_task;
                                task_id_text_val = $("#modal_task_id option[value='" + result[index].fields.tmgr_task + "']").text();
                                task_type_val = result[index].fields.task_type;
                                task_mgr_id = result[index].pk;
                                // console.log("1");
                                // debugger;
                                if (task_type_val == 0) {
                                    task_type_text_val = 'Complete';
                                    modal_ttype_group_yes_val = ''
                                    modal_ttype_group_yes_text_val = '';
                                    modal_ttype_copen_yes_val = 0;
                                    modal_ttype_cticket_yes_val = 0;
                                    modal_ttype_substatus_yes_val = '';
                                    modal_ttype_substatus_yes_text_val = '';
                                    modal_ttype_group_no_val = '';
                                    modal_ttype_group_no_text_val = '';
                                    modal_ttype_copen_no_val = 0;
                                    modal_ttype_cticket_no_val = 0;
                                    modal_ttype_substatus_no_val = '';
                                    modal_ttype_substatus_no_text_val = '';
                                    modal_ttype_group_na_val = '';
                                    modal_ttype_group_na_text_val = '';
                                    modal_ttype_copen_na_val = 0;
                                    modal_ttype_cticket_na_val = 0;
                                    modal_ttype_substatus_na_val = '';
                                    modal_ttype_substatus_na_text_val = '';
                                }
                                else {
                                    task_type_text_val = 'Yes/No/NA';

                                    /*Cases For Yes/No/NA Task Types Start*/
                                    modal_ttype_group_yes_val = result[index].fields.ttype_group_yes;
                                    modal_ttype_group_yes_text_val = $("#modal_task_type_group_id1 option[value='" + result[index].fields.ttype_group_yes + "']").text();
                                    modal_ttype_copen_yes_val = result[index].fields.ttype_copen_yes;
                                    modal_ttype_cticket_yes_val = result[index].fields.ttype_cticket_yes;
                                    modal_ttype_substatus_yes_val = result[index].fields.ttype_substatus_yes;
                                    modal_ttype_substatus_yes_text_val = $("#modal_task_type_substatus_id1 option[value='" + result[index].fields.ttype_substatus_yes + "']").text();
                                    modal_ttype_group_no_val = result[index].fields.ttype_group_no;
                                    modal_ttype_group_no_text_val = $("#modal_task_type_group_id2 option[value='" + result[index].fields.ttype_group_no + "']").text();
                                    modal_ttype_copen_no_val = result[index].fields.ttype_copen_no;
                                    modal_ttype_cticket_no_val = result[index].fields.ttype_cticket_no;
                                    modal_ttype_substatus_no_val = result[index].fields.ttype_substatus_no;
                                    modal_ttype_substatus_no_text_val = $("#modal_task_type_substatus_id2 option[value='" + result[index].fields.ttype_substatus_no + "']").text();
                                    modal_ttype_group_na_val = result[index].fields.ttype_group_na;
                                    modal_ttype_group_na_text_val = $("#modal_task_type_group_id3 option[value='" + result[index].fields.ttype_group_na + "']").text();
                                    modal_ttype_copen_na_val = result[index].fields.ttype_copen_na;
                                    modal_ttype_cticket_na_val = result[index].fields.ttype_cticket_na;
                                    modal_ttype_substatus_na_val = result[index].fields.ttype_substatus_na;
                                    modal_ttype_substatus_na_text_val = $("#modal_task_type_substatus_id3 option[value='" + result[index].fields.ttype_substatus_na + "']").text();

                                    /*Cases For Yes/No/NA Task Types End*/
                                }

                                task_note_val = result[index].fields.task_note;
                                task_due_date_val = result[index].fields.task_due_date;
                                if(task_due_date_val != null){
                                    var dateAr = task_due_date_val.split('-');
                                    task_due_date_val = dateAr[2] + '/' + dateAr[1] + '/' + dateAr[0];
                                }
                                else{
                                    task_due_date_val = '';
                                }
                                task_dependency_val = result[index].fields.task_dependency;
                                if (task_dependency_val == false) {
                                    task_dependency_text_val = 'None'
                                    task_dependency_val = 0
                                }
                                else {
                                    task_dependency_text_val = 'Order'
                                    task_dependency_val = 1
                                }
                                task_dependency_order_val = result[index].fields.task_depend_order;
                                task_assign_to_val = result[index].fields.task_assigned_to ? result[index].fields.task_assigned_to : "";
                                task_assign_to_text_val = $("#modal_task_assign_to option[value='" + result[index].fields.task_assigned_to + "']").text()
                                task_is_cancel = result[index].fields.tmgr_is_cancel;
                                task_is_complete = result[index].fields.tmgr_is_complete;
                                if(task_is_cancel == 1 || task_is_complete == 1){
                                   var date = new Date(result[index].fields.tmgr_completion_at).toUTCString();
                                   var uTimeZone = '{{ uTimeZone }}'
                                   task_completion_datetime = dateFormat(new Date(date).toLocaleString("en-US", {timeZone: uTimeZone }), "mm/dd/yyyy h:MM TT");
                                }
                                else{
                                    task_completion_datetime = ''
                                }
                                task_completion_userId = result[index].fields.tmgr_completion_userId ? result[index].fields.tmgr_completion_userId : "";
                                task_completion_userName = result[index].fields.tmgr_completion_userName ? result[index].fields.tmgr_completion_userName : "";
                                task_laborhour_hours = parseInt(result[index].fields.tmgr_laborhour_hours);
                                task_laborhour_minutes = parseInt(result[index].fields.tmgr_laborhour_minutes);
                                task_labor_note = result[index].fields.tmgr_labor_note;
                                task_labor_ticketnoteId = result[index].fields.tmgr_labor_ticketnote ? result[index].fields.tmgr_labor_ticketnote : "";
                                task_response_status = result[index].fields.tmgr_response_status;

                                //Appened Row on the Panel as well on the Table
                                globalArray.push({
                                    task_order_val: task_order_val,
                                    task_id_val: task_id_val,
                                    task_id_text_val: task_id_text_val,
                                    task_assign_to_val: task_assign_to_val,
                                    task_assign_to_text_val: task_assign_to_text_val,
                                    task_due_date_val: task_due_date_val,
                                    task_dependency_text_val: task_dependency_text_val,
                                    task_type_val: task_type_val,
                                    task_type_text_val: task_type_text_val,
                                    modal_ttype_group_yes_val           : modal_ttype_group_yes_val,
                                    modal_ttype_group_yes_text_val      : modal_ttype_group_yes_text_val,
                                    modal_ttype_copen_yes_val           : modal_ttype_copen_yes_val,
                                    modal_ttype_cticket_yes_val         : modal_ttype_cticket_yes_val,
                                    modal_ttype_substatus_yes_val       : modal_ttype_substatus_yes_val,
                                    modal_ttype_substatus_yes_text_val  : modal_ttype_substatus_yes_text_val,
                                    modal_ttype_group_no_val            : modal_ttype_group_no_val,
                                    modal_ttype_group_no_text_val       : modal_ttype_group_no_text_val,
                                    modal_ttype_copen_no_val            : modal_ttype_copen_no_val,
                                    modal_ttype_cticket_no_val          : modal_ttype_cticket_no_val,
                                    modal_ttype_substatus_no_val        : modal_ttype_substatus_no_val,
                                    modal_ttype_substatus_no_text_val   : modal_ttype_substatus_no_text_val,
                                    modal_ttype_group_na_val            : modal_ttype_group_na_val,
                                    modal_ttype_group_na_text_val       : modal_ttype_group_na_text_val,
                                    modal_ttype_copen_na_val            : modal_ttype_copen_na_val,
                                    modal_ttype_cticket_na_val          : modal_ttype_cticket_na_val,
                                    modal_ttype_substatus_na_val        : modal_ttype_substatus_na_val,
                                    modal_ttype_substatus_na_text_val   : modal_ttype_substatus_na_text_val,
                                    task_note_val                       : task_note_val,
                                    task_dependency_val                 : task_dependency_val,
                                    task_dependency_order_val           : task_dependency_order_val,
                                    task_is_cancel                      : task_is_cancel,
                                    task_is_complete                    : task_is_complete,
                                    task_completion_datetime            : task_completion_datetime,
                                    task_completion_userId              : task_completion_userId,
                                    task_completion_userName            : task_completion_userName,
                                    task_laborhour_hours                : task_laborhour_hours,
                                    task_laborhour_minutes              : task_laborhour_minutes,
                                    task_labor_note                     : task_labor_note,
                                    task_labor_ticketnoteId             : task_labor_ticketnoteId,
                                    task_response_status                : task_response_status,
                                    task_mgr_id                        : task_mgr_id
                                    
                                });
                                {#intializeTaskManager(globalArray)#}
                                row_counter++;
                                task_order_end++;
                            });

                            //Appened Entry on the Task Manager Table
                            $.ajax({
                                url:"{% url 'getModalTaskManagerById' %}",
                                type:'POST',
                                dataType: 'text',
                                data:{
                                    'records':JSON.stringify(globalArray),
                                    'csrfmiddlewaretoken': $('input[name=csrfmiddlewaretoken]').val(),
                                },
                                success:function(data){
                                    $('.table-task-modal tbody').append(data);
                                },
                                error:function(){
                                    console.log('error')
                                },
                            });
                            var collection = $.grep(globalArray, function(n,i){return n.task_completion_datetime==='' && n.task_dependency_order_val!='' && n.task_dependency_order_val!='None'});
                            var values = collection.map(a => a.task_dependency_order_val);

                            //Appened Entry on the Submit Ticket Table along with the Task Manger Button
                            $.ajax({
                                url:"{% url 'getTableTaskManagerById' %}",
                                type:'POST',
                                dataType: 'text',
                                data:{
                                    'records':JSON.stringify(globalArray),
                                    'depend_value':Math.min.apply(Math, values),
                                    'csrfmiddlewaretoken': $('input[name=csrfmiddlewaretoken]').val(),
                                },
                                success:function(data){
                                    $('.table-tasks tbody').append(data);
                                },
                                error:function(){
                                    console.log('error')
                                },
                            });

                        }
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        alert(textStatus + '. ' + errorThrown);
                    }
                });
                $('#imgCancelled').hide();
                $('.t_notes').each(function(i, obj) {
                    $(this).append($('#'+$(this).attr('name')).val());
                    if($('#'+$(this).attr('data-hour')).val() != '00:00'){
                        $(this).append("<br><b>Labor Hours: <b>");
                        $(this).append($('#'+$(this).attr('data-hour')).val());
                    }
                    if($('#'+$(this).attr('data-update')).val() != ''){
                        $(this).append('<br>'+$('#'+$(this).attr('data-update')).val());
                    }
                });

            });

            function resetForm(){
                {% if data.ticket_org_id %}
                    $("#org_id").select2("val", {{ data.ticket_org_id }});
                {% else %}
                    $("#org_id").select2("val", "");
                {% endif %}
                {% if data.ticket_caller_id %}
                    $("#caller_id").select2("val", {{ data.ticket_caller_id }});
                {% else %}
                    $("#caller_id").select2("val", "");
                {% endif %}
                {% if data.ticket_client_id %}
                    $("#client_id").select2("val", {{ data.ticket_client_id }});
                {% else %}
                    $("#client_id").select2("val", "");
                {% endif %}
                {% if data.ticket_clientinformation_id %}
                    $("#clientinfo_id").select2("val", {{ data.ticket_clientinformation_id }});
                {% else %}
                    $("#clientinfo_id").select2("val", "");
                {% endif %}
                {% if data.ticket_type_id %}
                    $("#ticket_type_parent").select2("val", {{ data.ticket_type_id }});
                {% else %}
                    $("#ticket_type_parent").select2("val", "");
                {% endif %}
                {% if data.ticket_subtype1_id %}
                    $("#subtype1").select2("val", {{ data.ticket_subtype1_id }});
                {% else %}
                    $("#subtype1").select2("val", "");
                {% endif %}
                {% if data.ticket_subtype2_id %}
                    $("#subtype2").select2("val", {{ data.ticket_subtype2_id }});
                {% else %}
                    $("#subtype2").select2("val", "");
                {% endif %}
                {% if data.ticket_subtype3_id %}
                    $("#subtype3").select2("val", {{ data.ticket_subtype3_id }});
                {% else %}
                    $("#subtype3").select2("val", "");
                {% endif %}
                {% if data.ticket_subtype4_id %}
                    $("#subtype4").select2("val", {{ data.ticket_subtype4_id }});
                {% else %}
                    $("#subtype4").select2("val", "");
                {% endif %}
                {% if data.priority_id %}
                    $("#priority").select2("val", {{ data.priority_id }});
                {% else %}
                    $("#priority").select2("val", "");
                {% endif %}
                {% if data.ticket_status %}
                    $("#ticket_status").select2("val", {{ data.ticket_status }});
                {% else %}
                    $("#ticket_status").select2("val", "");
                {% endif %}
                {% if data.ticket_sub_status_id %}
                    $("#ticket_substatus").select2("val", {{ data.ticket_sub_status_id }});
                {% else %}
                    $("#ticket_substatus").select2("val", "");
                {% endif %}
                {% if data.is_traveler_vip %}
                    $("#traveler_vip").select2("val", {{ data.is_traveler_vip }});
                {% else %}
                    $("#traveler_vip").select2("val", "");
                {% endif %}
                {% if data.is_payout_required %}
                    $("#payout_required").select2("val", {{ data.is_payout_required }});
                {% else %}
                    $("#payout_required").select2("val", "");
                {% endif %}
                {% if data.agent_error_goodwill %}
                    $("#error_goodwill").select2("val", {{ data.agent_error_goodwill }});
                {% else %}
                    $("#error_goodwill").select2("val", "");
                {% endif %}
                {% if data.ticket_assign_to_id %}
                    $("#assign_to").select2("val", {{ data.ticket_assign_to_id }});
                {% else %}
                    $("#assign_to").select2("val", "");
                {% endif %}
                {% if data.ticket_next_action_id %}
                    $("#next_action").select2("val", {{ data.ticket_next_action_id }});
                {% else %}
                    $("#next_action").select2("val", "");
                {% endif %}
                
                {% if data.account_id %}
                    $("#account_id").select2("val", {{ data.account_id }});
                {% else %}
                    $("#account_id").select2("val", "");
                {% endif %}
                {% if data.ticket_currency %}
                    $("#currency").select2("val", "{{ data.ticket_currency }}");
                {% else %}
                    $("#currency").select2("val", "");
                {% endif %} 
                {% if data.agent_responsible %}
                    $("#agent_responsible").select2("val", "{{ data.agent_responsible }}");
                {% else %}
                    $("#agent_responsible").select2("val", "");
                {% endif %}


            }


            $(document).on('change','#caller_id', function(){
                  var caller_id = $(this).val();
                  if (caller_id != ''){
                      $.ajax({
                        type: 'POST',
                        url: "{% url 'getClientId' %}",
                        data: {caller_id: caller_id},
                        dataType: 'json',
                        beforeSend: function(jqXHR, settings) {
                            //Do something before send...
                        },
                        success: function(data, textStatus, jqXHR) {
                            if(data.response){
                                // Set selected
                                $('#client_id').val(data.response);
                                $('#client_id').select2().trigger('change');
                            }
                        },
                        error: function(jqXHR, textStatus, errorThrown) {
                            alert(textStatus + '. ' + errorThrown);
                        }
                      });
                  }
                });


            $(document).on('change','#org_id', function(){
              var org_id = $(this).val();
              if (org_id != ''){
                  $.ajax({
                    type: 'POST',
                    url: "{% url 'getUsersByOrgId' %}",
                    data: {org_id: org_id},
                    dataType: 'json',
                    beforeSend: function(jqXHR, settings) {
                        //Do something before send...
                    },
                    success: function(data, textStatus, jqXHR) {
                        if(data.response) {
                            result = jQuery.parseJSON(data['response'])
                            $('#assign_to').html('<option value=""> </option>');
                            $.each(result, function (index) {
                                $('#assign_to').append('<option value="' + result[index].pk + '">' + result[index].fields.display_name + '</option>')
                            });
                        }
                    },
                    error: function(jqXHR, textStatus, errorThrown) {
                        alert(textStatus + '. ' + errorThrown);
                    }
                  });
              }

            });


            $(document).on('keyup','#sub_status_text', function(){
              var task_description = $(this).val();
              if (task_description != ''){
                  $.ajax({
                    type: 'POST',
                    url: "{% url 'validateTaskUnique' %}",
                    data: {task_description: task_description},
                    dataType: 'json',
                    beforeSend: function(jqXHR, settings) {
                        //Do something before send...
                    },
                    success: function(data, textStatus, jqXHR) {
                        if(data.response){
                            $('#TaskValid').html('<strong class="text-danger">Task already exist. Try another one!</strong>');
                            $('.saveButton').prop('disabled', true);
                        }else{
                            $('#TaskValid').html('');
                            $('.saveButton').prop('disabled', false);
                        }
                    },
                    error: function(jqXHR, textStatus, errorThrown) {
                        alert(textStatus + '. ' + errorThrown);
                    }
                  });
              }
            });


            $(document).on('change','#clientinfo_id', function(){
              var clientinfo = $(this).val();
              if (clientinfo != ''){
                  $.ajax({
                    type: 'POST',
                    url:  "{% url 'getClientInformationById' %}",
                    data: {clientinfo: clientinfo},
                    dataType: 'json',
                    beforeSend: function(jqXHR, settings) {
                        //Do something before send...
                    },
                    success: function(data, textStatus, jqXHR) {
                        if(data.response){
                            result = jQuery.parseJSON(data['response'])
                            $.each(result, function(index) {
                                $('#record_locator').val(result[index].fields.record_locator)
                                $('#caller_name').val(result[index].fields.caller_name)
                                $('#caller_phone').val(result[index].fields.caller_phone)
                                $('#caller_email').val(result[index].fields.caller_email)
                                $('#passenger_name').val(result[index].fields.passenger_name)
                            });
                        }else{
                            {#$('#TaskValid').html('');#}
                        }
                    },
                    error: function(jqXHR, textStatus, errorThrown) {
                        alert(textStatus + '. ' + errorThrown);
                    }
                  });
              }

            });


            $(document).on('change','.ticket_type', function(){
              var tid = $(this).val();
              var ttype = $(this).attr('id');
              if (tid != ''){
                  $.ajax({
                    type: 'POST',
                    url: "{% url 'getTicketTypeChildById' %}",
                    data: {ttype_id: tid},
                    dataType: 'json',
                    beforeSend: function(jqXHR, settings) {
                        //Do something before send...
                    },
                    success: function(data, textStatus, jqXHR) {
                        if(data.response) {
                            result = jQuery.parseJSON(data['response'])
                            if(ttype == 'ticket_type_parent') {
                                $('#subtype1').html('<option value="" > </option>')
                                $('#subtype2').html('<option value="" > </option>')
                                $('#subtype3').html('<option value="" > </option>')
                                $('#subtype4').html('<option value="" > </option>')
                                $.each(result, function (index) {
                                    $('#subtype1').append('<option value="' + result[index].pk + '">' + result[index].fields.ttype_name + '</option>')
                                });
                            }else if(ttype == 'subtype1'){
                                $('#subtype2').html('<option value="" > </option>')
                                $('#subtype3').html('<option value="" > </option>')
                                $('#subtype4').html('<option value="" > </option>')
                                $.each(result, function (index) {
                                    $('#subtype2').append('<option value="' + result[index].pk + '">' + result[index].fields.ttype_name + '</option>')
                                });
                            }else if(ttype == 'subtype2'){
                                $('#subtype3').html('<option value="" > </option>')
                                $('#subtype4').html('<option value="" > </option>')
                                $.each(result, function (index) {
                                    $('#subtype3').append('<option value="' + result[index].pk + '">' + result[index].fields.ttype_name + '</option>')
                                });
                            }else if(ttype == 'subtype3'){
                                $('#subtype4').html('<option value="" > </option>')
                                $.each(result, function (index) {
                                    $('#subtype4').append('<option value="'+result[index].pk+'">'+result[index].fields.ttype_name+'</option>')
                                });
                            }
                        }
                    },
                    error: function(jqXHR, textStatus, errorThrown) {
                        alert(textStatus + '. ' + errorThrown);
                    }
                  });
              }

            });


            $('#modal_due_date').datepicker({
                format: 'dd/mm/yyyy',
                endDate :null
             });


            $("#BtnNewTask").click(function () {
                $('#accept-btn').val('Accept')
                $('.incomplete_ticket_type').hide();
                $('#taskEditDiv').hide();
                $('tr').removeClass( "show-detail" );
                $('#modal_is_cancel').attr('data-mode', 'task-add')
                $('#modal_is_complete').attr('data-mode', 'task-add')
                $('#modal_dependency_order').prop('readonly', true)
                $(this).parent('.modal-buton').addClass('custom-model-btn');
                if(task_order_end == 1){
                    $('#modal_task_order').prop('readonly', true)
                }else{
                    $('#modal_task_order').prop('readonly', false)
                }
                $('#modal_task_order').val(task_order_end);
                $(".addNewTask").toggle('slow');
            });


            $("#btnAddTaskGroup").click(function () {
                $('#accept-btn').val('Add Task Group')
                $('tr').removeClass( "show-detail" );
                $(this).parent('.modal-buton').addClass('custom-model-btn');
                if(task_order_end == 1){
                    $('#modal_task_order').prop('readonly', true)
                }else{
                    $('#modal_task_order').prop('readonly', false)
                }
                if(task_order_end == 1){
                    $('#modal_task_group_order').prop('readonly', true)
                }else{
                    $('#modal_task_group_order').prop('readonly', false)
                }
                $('#modal_task_group_order').val(task_order_end)
                $(".addTaskGrpup").toggle('slow');
            });


            $(document).on('click','#cancelbtn', function(e) {
                $(this).parent('.modal-buton').removeClass('custom-model-btn');
                $(".addNewTask").hide('slow');
                $(".addTaskGrpup").hide('slow');
                clearNewTaskForm();
                //close select2 dropdown if open
                $('#modal_task_assign_to').select2("close");
            });


            $(document).on('change', '#modal_task_id', function(){
                task_id = $('#modal_task_id').val();

                //Get Task Type of Selected Task.IF if is YES/NO/N/A then show the IComplete Task Type Block
                $.ajax({
                    url:"{% url 'getTaskTypeById' %}",
                    type:'POST',
                    dataType: 'json',
                    data:{
                        'task_id': task_id,
                        'csrfmiddlewaretoken': $('input[name=csrfmiddlewaretoken]').val(),
                    },
                    success:function(data){
                        if(data.task_type == 0){
                            $('.incomplete_ticket_type').hide();
                            $('#modal_task_type1').prop('checked',true);
                        }else{
                            $('.incomplete_ticket_type').show();
                            $('#modal_task_type2').prop('checked',true);
                        }
                    },
                    error:function(){
                        console.log('error')
                    },
                });
            })


            $(document).on('change', '.modal_task_type', function(){
                task_type_val = $('input[name=modal_task_type]:checked').val();
                if(task_type_val == 0){
                    $('.incomplete_ticket_type').hide()
                }else{
                    $('.incomplete_ticket_type').show()
                }
            })


            $(document).on('change', '.modal_dependency', function(){
                task_dependency_val = $('input[name=modal_dependency]:checked').val();
                if(task_dependency_val == 0){
                    $('#modal_dependency_order').prop('readonly', true)
                    $('#modal_dependency_order').val('');
                }else{
                    $('#modal_dependency_order').prop('readonly', false)
                }
            })


            $(document).on('change', '.modal_task_type_close_ticket', function(){
                r_id = ($(this).attr('data-id'));
                if(this.checked) {
                    $('#modal_task_type_group_id'+r_id).prop('disabled', true);
                    $('#modal_task_type_group_id'+r_id).val('');
                }else{
                    $('#modal_task_type_group_id'+r_id).prop('disabled', false);
                }
            })


            $(document).on('change', '#modal_is_cancel', function(){
               if(this.checked) {
                  $('#imgCancelled').show();
                  if($('#modal_is_cancel').attr('data-mode') == 'task-edit'){
                      $('#taskCompleteDiv').hide();
                      $('#taskCompleteResponseDiv').hide()
                    }
               }else{
                  $('#imgCancelled').hide();
                  if($('#modal_is_cancel').attr('data-mode') == 'task-edit'){
                        $('#taskCompleteDiv').show();
                        if($('#modal_is_complete').is(":checked") && $('input[name=modal_task_type]:checked').val() == 1){
                            $('#taskCompleteResponseDiv').show();
                        }
                    }

               }
            });


            $(document).on('change', '#modal_is_complete', function(){
               if(this.checked) {
                   date = dateFormat(new Date().toLocaleString("en-US", {timeZone: '{{ uTimeZone }}' }), "mm/dd/yyyy h:MM TT");
                   username = "{{ request.user.display_name }}";
                    $('#spnCompletedDateEdit').html('on ' + date + ' by ' + username);
                    if($('input[name=modal_task_type]:checked').val() == 1){
                        $('#taskCompleteResponseDiv').show()
                    }else{
                        $('#taskCompleteResponseDiv').hide()
                    }

               }else{
                    $('#spnCompletedDateEdit').html('');
                    $('#taskCompleteResponseDiv').hide()
                }
            });


            $(document).on('click','tr .detail_record',function () {
	    	$('tr').not($(this).parents('table tr')).removeClass( "show-detail" );
                $(this).parents('table tr').toggleClass( "show-detail" );
            });


            function directCompleteTask(e, task_id){
                var tskcomp_index = task_id - 1;
                globalArray[tskcomp_index].task_is_complete = 1;
                globalArray[tskcomp_index].task_completion_datetime =  dateFormat(new Date().toLocaleString("en-US", {timeZone: '{{ uTimeZone }}' }), "mm/dd/yyyy h:MM TT");
                globalArray[tskcomp_index].task_completion_userId = {{ request.user.id }};
                globalArray[tskcomp_index].task_completion_userName =  "{{ request.user.display_name }}";
                intializeTaskManager(globalArray)
                $('#btnDone').trigger('click');

            }


            function closeAllOpenedTask(task_id) {
                $.each(globalArray, function (tsk_index, tsk_value) {
                    if(globalArray[tsk_index].task_completion_datetime == "" && globalArray[tsk_index].task_order_val != task_id){
                        globalArray[tsk_index].task_is_cancel = 1;
                        globalArray[tsk_index].task_completion_datetime = dateFormat(new Date().toLocaleString("en-US", {timeZone: '{{ uTimeZone }}' }), "mm/dd/yyyy h:MM TT");
                        globalArray[tsk_index].task_completion_userId = {{ request.user.id }};
                        globalArray[tsk_index].task_completion_userName = "{{ request.user.display_name }}";
                    }
                });
            }


            function closeTicketByTaskResponse(task_id) {

                var incomp_tasks=$(globalArray).filter(function (i,n){return n.task_completion_datetime===''});
                if(incomp_tasks.length == 1){
                    ticket_id = {{ data.ticket_id }};
                    $.ajax({
                        url:"{% url 'updateTicketStatusById' %}",
                        type:'POST',
                        dataType: 'text',
                        data:{
                            'ticket_id': ticket_id,
                            'csrfmiddlewaretoken': $('input[name=csrfmiddlewaretoken]').val(),
                        },
                        success:function(data){
                            console.log('success');
                        },
                        error:function(){
                            console.log('error')
                        },
                    });
                    $('#ticket_status').val(1);
                }
            }


            function addTasksByTaskGroupId(taskgroup_id){
                $.ajax({
                    type: 'POST',
                    url: "{% url 'getModalGroupTasksById' %}",
                    data: {group_id: taskgroup_id, 'csrfmiddlewaretoken': $('input[name=csrfmiddlewaretoken]').val()},
                    dataType: 'json',
                    beforeSend: function (jqXHR, settings) {
                        //Do something before send...
                    },
                    success: function (data, textStatus, jqXHR) {
                        tskGroupArray = [];
                        if (data.response) {
                            result = jQuery.parseJSON(data['response']);
                            settimer += 500*result.length;
                            var task_order_val = task_order_end + 1;
                            $.each(result, function (index) {
                                task_order_val = task_order_val
                                task_id_val = result[index].fields.tmgrgp_task;
                                task_id_text_val = $("#modal_task_id option[value='" + result[index].fields.tmgrgp_task + "']").text();
                                task_type_val = result[index].fields.tg_task_type;
                                task_mgr_id = result[index].pk;
                                // console.log("2");
                                // debugger;
                                if (task_type_val == 0) {
                                    task_type_text_val = 'Complete';
                                    modal_ttype_group_yes_val = ''
                                    modal_ttype_group_yes_text_val = '';
                                    modal_ttype_copen_yes_val = 0;
                                    modal_ttype_cticket_yes_val = 0;
                                    modal_ttype_substatus_yes_val = '';
                                    modal_ttype_substatus_yes_text_val = '';
                                    modal_ttype_group_no_val = '';
                                    modal_ttype_group_no_text_val = '';
                                    modal_ttype_copen_no_val = 0;
                                    modal_ttype_cticket_no_val = 0;
                                    modal_ttype_substatus_no_val = '';
                                    modal_ttype_substatus_no_text_val = '';
                                    modal_ttype_group_na_val = '';
                                    modal_ttype_group_na_text_val = '';
                                    modal_ttype_copen_na_val = 0;
                                    modal_ttype_cticket_na_val = 0;
                                    modal_ttype_substatus_na_val = '';
                                    modal_ttype_substatus_na_text_val = '';
                                }
                                else {
                                    task_type_text_val = 'Yes/No/NA';

                                    /*Cases For Yes/No/NA Task Types Start*/
                                    modal_ttype_group_yes_val = result[index].fields.tg_ttype_group_yes;
                                    modal_ttype_group_yes_text_val = $("#modal_task_type_group_id1 option[value='" + result[index].fields.tg_ttype_group_yes + "']").text();
                                    modal_ttype_copen_yes_val = result[index].fields.tg_ttype_copen_yes;
                                    modal_ttype_cticket_yes_val = result[index].fields.tg_ttype_cticket_yes;
                                    modal_ttype_substatus_yes_val = result[index].fields.tg_ttype_substatus_yes;
                                    modal_ttype_substatus_yes_text_val = $("#modal_task_type_substatus_id1 option[value='" + result[index].fields.tg_ttype_substatus_yes + "']").text();
                                    modal_ttype_group_no_val = result[index].fields.tg_ttype_group_no;
                                    modal_ttype_group_no_text_val = $("#modal_task_type_group_id2 option[value='" + result[index].fields.tg_ttype_group_no + "']").text();
                                    modal_ttype_copen_no_val = result[index].fields.tg_ttype_copen_no;
                                    modal_ttype_cticket_no_val = result[index].fields.tg_ttype_cticket_no;
                                    modal_ttype_substatus_no_val = result[index].fields.tg_ttype_substatus_no;
                                    modal_ttype_substatus_no_text_val = $("#modal_task_type_substatus_id2 option[value='" + result[index].fields.tg_ttype_substatus_no + "']").text();
                                    modal_ttype_group_na_val = result[index].fields.tg_ttype_group_na;
                                    modal_ttype_group_na_text_val = $("#modal_task_type_group_id3 option[value='" + result[index].fields.tg_ttype_group_na + "']").text();
                                    modal_ttype_copen_na_val = result[index].fields.tg_ttype_copen_na;
                                    modal_ttype_cticket_na_val = result[index].fields.tg_ttype_cticket_na;
                                    modal_ttype_substatus_na_val = result[index].fields.tg_ttype_substatus_na;
                                    modal_ttype_substatus_na_text_val = $("#modal_task_type_substatus_id3 option[value='" + result[index].fields.tg_ttype_substatus_na + "']").text();

                                    /*Cases For Yes/No/NA Task Types End*/
                                }

                                task_note_val = result[index].fields.tg_task_note;
                                task_due_date_val = result[index].fields.tg_task_due_date;
                                if(task_due_date_val != null){
                                    var dateAr = task_due_date_val.split('-');
                                    task_due_date_val = dateAr[2] + '/' + dateAr[1] + '/' + dateAr[0];
                                }
                                else{
                                    task_due_date_val = '';
                                }
                                task_dependency_val = result[index].fields.tg_task_dependency;
                                if (task_dependency_val == false) {
                                    task_dependency_text_val = 'None'
                                    task_dependency_val = 0
                                }
                                else {
                                    task_dependency_text_val = 'Order'
                                    task_dependency_val = 1
                                }
                                task_dependency_order_val = result[index].fields.tg_task_depend_order;
                                task_assign_to_val = result[index].fields.task_assigned_to ? result[index].fields.task_assigned_to : "";
                                task_assign_to_text_val = $("#modal_task_assign_to option[value='" + result[index].fields.tg_task_assigned_to + "']").text()
                                task_is_cancel = 0
                                task_is_complete = 0
                                task_completion_datetime = '';
                                task_completion_userId = '';
                                task_completion_userName = '';
                                task_response_status = '';
                                task_laborhour_hours = 0;
                                task_laborhour_minutes = 0;
                                task_labor_note = '';
                                task_labor_ticketnoteId = '';


                                //Appened Row on the Panel as well on the Table
                                tskGroupArray.push({
                                    task_order_val: task_order_val,
                                    task_id_val: task_id_val,
                                    task_id_text_val: task_id_text_val,
                                    task_assign_to_val: task_assign_to_val,
                                    task_assign_to_text_val: task_assign_to_text_val,
                                    task_due_date_val: task_due_date_val,
                                    task_dependency_text_val: task_dependency_text_val,
                                    task_type_val: task_type_val,
                                    task_type_text_val: task_type_text_val,
                                    modal_ttype_group_yes_val           : modal_ttype_group_yes_val,
                                    modal_ttype_group_yes_text_val      : modal_ttype_group_yes_text_val,
                                    modal_ttype_copen_yes_val           : modal_ttype_copen_yes_val,
                                    modal_ttype_cticket_yes_val         : modal_ttype_cticket_yes_val,
                                    modal_ttype_substatus_yes_val       : modal_ttype_substatus_yes_val,
                                    modal_ttype_substatus_yes_text_val  : modal_ttype_substatus_yes_text_val,
                                    modal_ttype_group_no_val            : modal_ttype_group_no_val,
                                    modal_ttype_group_no_text_val       : modal_ttype_group_no_text_val,
                                    modal_ttype_copen_no_val            : modal_ttype_copen_no_val,
                                    modal_ttype_cticket_no_val          : modal_ttype_cticket_no_val,
                                    modal_ttype_substatus_no_val        : modal_ttype_substatus_no_val,
                                    modal_ttype_substatus_no_text_val   : modal_ttype_substatus_no_text_val,
                                    modal_ttype_group_na_val            : modal_ttype_group_na_val,
                                    modal_ttype_group_na_text_val       : modal_ttype_group_na_text_val,
                                    modal_ttype_copen_na_val            : modal_ttype_copen_na_val,
                                    modal_ttype_cticket_na_val          : modal_ttype_cticket_na_val,
                                    modal_ttype_substatus_na_val        : modal_ttype_substatus_na_val,
                                    modal_ttype_substatus_na_text_val   : modal_ttype_substatus_na_text_val,
                                    task_note_val: task_note_val,
                                    task_dependency_val: task_dependency_val,
                                    task_dependency_order_val: task_dependency_order_val,
                                    task_is_cancel                      : task_is_cancel,
                                    task_is_complete                    : task_is_complete,
                                    task_completion_datetime            : task_completion_datetime,
                                    task_completion_userId              : task_completion_userId,
                                    task_completion_userName            : task_completion_userName,
                                    task_laborhour_hours                : task_laborhour_hours,
                                    task_laborhour_minutes              : task_laborhour_minutes,
                                    task_labor_note                     : task_labor_note,
                                    task_labor_ticketnoteId             : task_labor_ticketnoteId,
                                    task_response_status                : task_response_status
                                });
                                globalArray.push({
                                    task_order_val: task_order_val,
                                    task_id_val: task_id_val,
                                    task_id_text_val: task_id_text_val,
                                    task_assign_to_val: task_assign_to_val,
                                    task_assign_to_text_val: task_assign_to_text_val,
                                    task_due_date_val: task_due_date_val,
                                    task_dependency_text_val: task_dependency_text_val,
                                    task_type_val: task_type_val,
                                    task_type_text_val: task_type_text_val,
                                    modal_ttype_group_yes_val           : modal_ttype_group_yes_val,
                                    modal_ttype_group_yes_text_val      : modal_ttype_group_yes_text_val,
                                    modal_ttype_copen_yes_val           : modal_ttype_copen_yes_val,
                                    modal_ttype_cticket_yes_val         : modal_ttype_cticket_yes_val,
                                    modal_ttype_substatus_yes_val       : modal_ttype_substatus_yes_val,
                                    modal_ttype_substatus_yes_text_val  : modal_ttype_substatus_yes_text_val,
                                    modal_ttype_group_no_val            : modal_ttype_group_no_val,
                                    modal_ttype_group_no_text_val       : modal_ttype_group_no_text_val,
                                    modal_ttype_copen_no_val            : modal_ttype_copen_no_val,
                                    modal_ttype_cticket_no_val          : modal_ttype_cticket_no_val,
                                    modal_ttype_substatus_no_val        : modal_ttype_substatus_no_val,
                                    modal_ttype_substatus_no_text_val   : modal_ttype_substatus_no_text_val,
                                    modal_ttype_group_na_val            : modal_ttype_group_na_val,
                                    modal_ttype_group_na_text_val       : modal_ttype_group_na_text_val,
                                    modal_ttype_copen_na_val            : modal_ttype_copen_na_val,
                                    modal_ttype_cticket_na_val          : modal_ttype_cticket_na_val,
                                    modal_ttype_substatus_na_val        : modal_ttype_substatus_na_val,
                                    modal_ttype_substatus_na_text_val   : modal_ttype_substatus_na_text_val,
                                    task_note_val: task_note_val,
                                    task_dependency_val: task_dependency_val,
                                    task_dependency_order_val: task_dependency_order_val,
                                    task_is_cancel                      : task_is_cancel,
                                    task_is_complete                    : task_is_complete,
                                    task_completion_datetime            : task_completion_datetime,
                                    task_completion_userId              : task_completion_userId,
                                    task_completion_userName            : task_completion_userName,
                                    task_laborhour_hours                : task_laborhour_hours,
                                    task_laborhour_minutes              : task_laborhour_minutes,
                                    task_labor_note                     : task_labor_note,
                                    task_labor_ticketnoteId             : task_labor_ticketnoteId,
                                    task_response_status                : task_response_status,
                                    task_mgr_id                         : task_mgr_id
                                });
                                row_counter++;
                                task_order_end++;
                                task_order_val++;
                                {#intializeTaskManager(globalArray);#}
                            });
                            //Appened Entry on the Task Manager Table
                            $.ajax({
                                url:"{% url 'getModalTaskManagerById' %}",
                                type:'POST',
                                dataType: 'text',
                                data:{
                                    'records':JSON.stringify(tskGroupArray),
                                    'csrfmiddlewaretoken': $('input[name=csrfmiddlewaretoken]').val(),
                                },
                                success:function(data){
                                    $('.table-task-modal tbody').append(data);
                                },
                                error:function(){
                                    console.log('error')
                                },
                            });

                            var collection = $.grep(globalArray, function(n,i){return n.task_completion_datetime==='' && n.task_dependency_order_val!='' && n.task_dependency_order_val!='None'});
                            var values = collection.map(a => a.task_dependency_order_val);

                            //Appened Entry on the Submit Ticket Table along with the Task Manger Button
                            $.ajax({
                                url:"{% url 'getTableTaskManagerById' %}",
                                type:'POST',
                                dataType: 'text',
                                data:{
                                    'records':JSON.stringify(tskGroupArray),
                                    'depend_value':Math.min.apply(Math, values),
                                    'csrfmiddlewaretoken': $('input[name=csrfmiddlewaretoken]').val(),
                                },
                                success:function(data){
                                    $('.table-tasks tbody').append(data);
                                },
                                error:function(){
                                    console.log('error')
                                },
                            });

                        }
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        alert(textStatus + '. ' + errorThrown);
                    }
                });
            }


            function updateIndirectTicketSubStatus(ticket_substatus,tsksubstatus_text){
                ticket_id = {{ data.ticket_id }};
                $.ajax({
                    url:"{% url 'updateTicketSubstatusById' %}",
                    type:'POST',
                    dataType: 'text',
                    data:{
                        'substatus': ticket_substatus,
                        'ticket_id': ticket_id,
                        'csrfmiddlewaretoken': $('input[name=csrfmiddlewaretoken]').val(),
                    },
                    success:function(data){
                        console.log('success');
                    },
                    error:function(){
                        console.log('error')
                    },
                });
                $('#ticketSubStatusText').html(tsksubstatus_text);
            }


            function directTaskResponseAction(e, task_id, tskgroup,tskcopen,tskcticket,tsksubstatus,tsksubstatus_text,tsk_resp_status){
                var tskcomp_index = task_id - 1;
                if(tskcopen == 1 || tskcopen == 'True'){
                    closeAllOpenedTask(task_id);
                }
                if(tskcticket == 1 || tskcticket == 'True'){
                    closeTicketByTaskResponse();
                }
                if(tsksubstatus != "" && tsksubstatus != 'None'){
                    updateIndirectTicketSubStatus(tsksubstatus,tsksubstatus_text);
                }
                if(tskgroup != "" && tskgroup != 'None'){
                    addTasksByTaskGroupId(tskgroup);
                }

                globalArray[tskcomp_index].task_is_complete = 1;
                globalArray[tskcomp_index].task_completion_datetime =  dateFormat(new Date().toLocaleString("en-US", {timeZone: '{{ uTimeZone }}' }), "mm/dd/yyyy h:MM TT");
                globalArray[tskcomp_index].task_completion_userId = {{ request.user.id }};
                globalArray[tskcomp_index].task_completion_userName =  "{{ request.user.display_name }}";
                globalArray[tskcomp_index].task_response_status =  tsk_resp_status;

                setTimeout(function(){
                        intializeTaskManager(globalArray);
                        $('#btnDone').trigger('click');
                    }, settimer);

            }


            function indirectTaskResponseAction(e, task_id, tskgroup,tskcopen,tskcticket,tsksubstatus,tsksubstatus_text,tsk_resp_status){
                var tskcomp_index = task_id - 1;
                if(tskcopen == 1 || tskcopen == 'True'){
                    closeAllOpenedTask(task_id);
                }
                if(tskcticket == 1 || tskcticket == 'True'){
                    closeTicketByTaskResponse();
                }
                if(tsksubstatus != "" && tsksubstatus != 'None'){
                    updateIndirectTicketSubStatus(tsksubstatus,tsksubstatus_text);
                }
                if(tskgroup != "" && tskgroup != 'None'){
                    addTasksByTaskGroupId(tskgroup);
                }

                globalArray[tskcomp_index].task_is_complete = 1;
                globalArray[tskcomp_index].task_completion_datetime =  dateFormat(new Date().toLocaleString("en-US", {timeZone: '{{ uTimeZone }}' }), "mm/dd/yyyy h:MM TT");
                globalArray[tskcomp_index].task_completion_userId = {{ request.user.id }};
                globalArray[tskcomp_index].task_completion_userName =  "{{ request.user.display_name }}";
                globalArray[tskcomp_index].task_response_status =  tsk_resp_status;

                $('#accept-btn').parent('.modal-buton').removeClass('custom-model-btn');
                $(".addNewTask").hide('slow');
                $(".addTaskGrpup").hide('slow');

                clearNewTaskForm();
                intializeTaskManager(globalArray);

                //setTimeout(function(){
                //  intializeTaskManager(globalArray);
                //  $('#btnDone').trigger('click');
                //  }, settimer);

            }


            function clearNewTaskForm(){
                $('#modal_task_id').val('');
                $('#modal_task_type1').prop('checked',true);
                /* Clear Task Type YES/No/N/A div Start*/
                $('#modal_task_type_group_id1').val('');
                $('#modal_task_type_group_id1').prop('disabled', false);
                $('#modal_cancel_open_task1').prop('checked',false);
                $('#modal_task_type_close_ticket1').prop('checked',false);
                $('#modal_task_type_substatus_id1').val('');
                $('#modal_task_type_group_id2').val('');
                $('#modal_task_type_group_id2').prop('disabled', false);
                $('#modal_cancel_open_task2').prop('checked',false);
                $('#modal_task_type_close_ticket2').prop('checked',false);
                $('#modal_task_type_substatus_id2').val('');
                $('#modal_task_type_group_id3').val('');
                $('#modal_task_type_group_id3').prop('disabled', false);
                $('#modal_cancel_open_task3').prop('checked',false);
                $('#modal_task_type_close_ticket3').prop('checked',false);
                $('#modal_task_type_substatus_id3').val('');
                /* Clear Task Type YES/No/N/A div End*/
                $('#modal_task_note').val('')
                $('#modal_due_date').val('')
                $('#modal_dependency1').prop('checked',true)
                $('#modal_dependency_order').val('')
                $('#modal_task_assign_to').select2("val", "");
                $('#modal_is_cancel').prop('checked',false);
                $('#modal_is_complete').prop('checked',false);
                $('#imgCancelled').hide();
                $('#modal_labour_hours_hours').val(0);
                $('#modal_labour_hours_minutes').val(0);
                $('#modal_labor_note').val('');

            }


            function sortDownByKeyAsc(array, key) {
                return array.sort(function (a, b) {
                    var x = a[key]; var y = b[key];
                    return ((x < y) ? -1 : ((x == y) ? -1 : ((x > y) ? 1 : 0)));
                });
            }


            function sortByKeyAsc(array, key) {
                return array.sort(function (a, b) {
                    var x = a[key]; var y = b[key];
                    return ((x < y) ? -1 : ((x == y) ? -1 : ((x > y) ? 1 : 0)));
                });
            }


            function iterByKeyAsc(array, key) {
                order = 1;
                $.each(array, function (k, v) {
                    array[k][key] = order
                    order++;
                })
            }


            function intializeTaskManager(myArray){
                sortByKeyAsc(myArray, 'task_order_val') //Global Array will be sorted as per the task order Val
                iterByKeyAsc(myArray, 'task_order_val') //Global Array will be iterated start from 1 and go futher with 1 increment

                //Appened Entry on the Task Manager Table
                $.ajax({
                    url:"{% url 'getModalTaskManagerById' %}",
                    type:'POST',
                    dataType: 'text',
                    data:{
                        'records':JSON.stringify(myArray),
                        'csrfmiddlewaretoken': $('input[name=csrfmiddlewaretoken]').val(),
                    },
                    success:function(data){
                        $('.table-task-modal tbody').html(data);
                        $(this).parent('.modal-buton').removeClass('custom-model-btn');
                        $(".addNewTask").hide('slow');
                        $(".addTaskGrpup").hide('slow');
                    },
                    error:function(){
                        console.log('error')
                    },
                });

                var collection = $.grep(globalArray, function(n,i){return n.task_completion_datetime==='' && n.task_dependency_order_val!='' && n.task_dependency_order_val!='None'});
                var values = collection.map(a => a.task_dependency_order_val);


                //Appened Entry on the Submit Ticket Table along with the Task Manger Button
                $.ajax({
                    url:"{% url 'getTableTaskManagerById' %}",
                    type:'POST',
                    dataType: 'text',
                    data:{
                        'records':JSON.stringify(myArray),
                        'depend_value':Math.min.apply(Math, values),
                        'csrfmiddlewaretoken': $('input[name=csrfmiddlewaretoken]').val(),
                    },
                    success:function(data){
                        $('.table-tasks tbody').html(data);
                    },
                    error:function(){
                        console.log('error')
                    },
                });

            }


            $(document).on('click','#accept-btn', function(e) {
                $(this).parent('.table-bordered').addClass('append-data');
                if($(this).val() == 'Add Task Group'){
                    task_order_val = $('#modal_task_group_order').val();
                    taskgroup_id_val = $('#modal_taskgroup_id').val();
                    if(taskgroup_id_val == ''){
                        alert('Task Group Name cannot be Empty!');
                    }
                    else if(task_order_val == '' || task_order_val > task_order_end){
                        alert('Task Order must be a valid whole number between '+task_order_start+' and '+task_order_end+'!');
                    }
                    else {
                        $(this).parent('.modal-buton').removeClass('custom-model-btn');
                        $.ajax({
                            type: 'POST',
                            url: "{% url 'getModalGroupTasksById' %}",
                            data: {group_id: taskgroup_id_val, 'csrfmiddlewaretoken': $('input[name=csrfmiddlewaretoken]').val()},
                            dataType: 'json',
                            beforeSend: function (jqXHR, settings) {
                                //Do something before send...
                            },
                            success: function (data, textStatus, jqXHR) {
                                if (data.response) {
                                    result = jQuery.parseJSON(data['response'])
                                    $.each(result, function (index) {
                                        task_order_val = task_order_val
                                        task_id_val = result[index].fields.tmgrgp_task;
                                        task_id_text_val = $("#modal_task_id option[value='" + result[index].fields.tmgrgp_task + "']").text();
                                        task_type_val = result[index].fields.tg_task_type;
                                        // task_mgr_id = result[index].pk;
                                        task_mgr_id = '';
                                        // console.log("3");
                                        // debugger;
                                        if (task_type_val == 0) {
                                            task_type_text_val = 'Complete';
                                            modal_ttype_group_yes_val = ''
                                            modal_ttype_group_yes_text_val = '';
                                            modal_ttype_copen_yes_val = 0;
                                            modal_ttype_cticket_yes_val = 0;
                                            modal_ttype_substatus_yes_val = '';
                                            modal_ttype_substatus_yes_text_val = '';
                                            modal_ttype_group_no_val = '';
                                            modal_ttype_group_no_text_val = '';
                                            modal_ttype_copen_no_val = 0;
                                            modal_ttype_cticket_no_val = 0;
                                            modal_ttype_substatus_no_val = '';
                                            modal_ttype_substatus_no_text_val = '';
                                            modal_ttype_group_na_val = '';
                                            modal_ttype_group_na_text_val = '';
                                            modal_ttype_copen_na_val = 0;
                                            modal_ttype_cticket_na_val = 0;
                                            modal_ttype_substatus_na_val = '';
                                            modal_ttype_substatus_na_text_val = '';
                                        }
                                        else {
                                            task_type_text_val = 'Yes/No/NA';

                                            /*Cases For Yes/No/NA Task Types Start*/
                                            modal_ttype_group_yes_val = result[index].fields.tg_ttype_group_yes;
                                            modal_ttype_group_yes_text_val = $("#modal_task_type_group_id1 option[value='" + result[index].fields.tg_ttype_group_yes + "']").text();
                                            modal_ttype_copen_yes_val = result[index].fields.tg_ttype_copen_yes;
                                            modal_ttype_cticket_yes_val = result[index].fields.tg_ttype_cticket_yes;
                                            modal_ttype_substatus_yes_val = result[index].fields.tg_ttype_substatus_yes;
                                            modal_ttype_substatus_yes_text_val = $("#modal_task_type_substatus_id1 option[value='" + result[index].fields.tg_ttype_substatus_yes + "']").text();
                                            modal_ttype_group_no_val = result[index].fields.tg_ttype_group_no;
                                            modal_ttype_group_no_text_val = $("#modal_task_type_group_id2 option[value='" + result[index].fields.tg_ttype_group_no + "']").text();
                                            modal_ttype_copen_no_val = result[index].fields.tg_ttype_copen_no;
                                            modal_ttype_cticket_no_val = result[index].fields.tg_ttype_cticket_no;
                                            modal_ttype_substatus_no_val = result[index].fields.tg_ttype_substatus_no;
                                            modal_ttype_substatus_no_text_val = $("#modal_task_type_substatus_id2 option[value='" + result[index].fields.tg_ttype_substatus_no + "']").text();
                                            modal_ttype_group_na_val = result[index].fields.tg_ttype_group_na;
                                            modal_ttype_group_na_text_val = $("#modal_task_type_group_id3 option[value='" + result[index].fields.tg_ttype_group_na + "']").text();
                                            modal_ttype_copen_na_val = result[index].fields.tg_ttype_copen_na;
                                            modal_ttype_cticket_na_val = result[index].fields.tg_ttype_cticket_na;
                                            modal_ttype_substatus_na_val = result[index].fields.tg_ttype_substatus_na;
                                            modal_ttype_substatus_na_text_val = $("#modal_task_type_substatus_id3 option[value='" + result[index].fields.tg_ttype_substatus_na + "']").text();

                                            /*Cases For Yes/No/NA Task Types End*/
                                        }

                                        task_note_val = result[index].fields.tg_task_note;
                                        task_due_date_val = result[index].fields.tg_task_due_date;
                                        if(task_due_date_val != null){
                                            var dateAr = task_due_date_val.split('-');
                                            task_due_date_val = dateAr[2] + '/' + dateAr[1] + '/' + dateAr[0];
                                        }
                                        else{
                                            task_due_date_val = '';
                                        }
                                        task_dependency_val = result[index].fields.tg_task_dependency;
                                        if (task_dependency_val == false) {
                                            task_dependency_text_val = 'None'
                                            task_dependency_val = 0
                                        }
                                        else {
                                            task_dependency_text_val = 'Order'
                                            task_dependency_val = 1
                                        }
                                        task_dependency_order_val = result[index].fields.tg_task_depend_order;
                                        task_assign_to_val = result[index].fields.tg_task_assigned_to ? result[index].fields.tg_task_assigned_to : "";
                                        task_assign_to_text_val = $("#modal_task_assign_to option[value='" + result[index].fields.tg_task_assigned_to + "']").text()
                                        task_is_cancel = 0
                                        task_is_complete = 0
                                        task_completion_datetime = '';
                                        task_completion_userId = '';
                                        task_completion_userName = '';
                                        task_response_status = '';
                                        task_laborhour_hours = 0;
                                        task_laborhour_minutes = 0;
                                        task_labor_note = '';
                                        task_labor_ticketnoteId = '';


                                        //Appened Row on the Panel as well on the Table
                                        globalArray.push({
                                            task_order_val: task_order_val,
                                            task_id_val: task_id_val,
                                            task_id_text_val: task_id_text_val,
                                            task_assign_to_val: task_assign_to_val,
                                            task_assign_to_text_val: task_assign_to_text_val,
                                            task_due_date_val: task_due_date_val,
                                            task_dependency_text_val: task_dependency_text_val,
                                            task_type_val: task_type_val,
                                            task_type_text_val: task_type_text_val,
                                            modal_ttype_group_yes_val           : modal_ttype_group_yes_val,
                                            modal_ttype_group_yes_text_val      : modal_ttype_group_yes_text_val,
                                            modal_ttype_copen_yes_val           : modal_ttype_copen_yes_val,
                                            modal_ttype_cticket_yes_val         : modal_ttype_cticket_yes_val,
                                            modal_ttype_substatus_yes_val       : modal_ttype_substatus_yes_val,
                                            modal_ttype_substatus_yes_text_val  : modal_ttype_substatus_yes_text_val,
                                            modal_ttype_group_no_val            : modal_ttype_group_no_val,
                                            modal_ttype_group_no_text_val       : modal_ttype_group_no_text_val,
                                            modal_ttype_copen_no_val            : modal_ttype_copen_no_val,
                                            modal_ttype_cticket_no_val          : modal_ttype_cticket_no_val,
                                            modal_ttype_substatus_no_val        : modal_ttype_substatus_no_val,
                                            modal_ttype_substatus_no_text_val   : modal_ttype_substatus_no_text_val,
                                            modal_ttype_group_na_val            : modal_ttype_group_na_val,
                                            modal_ttype_group_na_text_val       : modal_ttype_group_na_text_val,
                                            modal_ttype_copen_na_val            : modal_ttype_copen_na_val,
                                            modal_ttype_cticket_na_val          : modal_ttype_cticket_na_val,
                                            modal_ttype_substatus_na_val        : modal_ttype_substatus_na_val,
                                            modal_ttype_substatus_na_text_val   : modal_ttype_substatus_na_text_val,
                                            task_note_val: task_note_val,
                                            task_dependency_val: task_dependency_val,
                                            task_dependency_order_val: task_dependency_order_val,
                                            task_is_cancel                      : task_is_cancel,
                                            task_is_complete                    : task_is_complete,
                                            task_completion_datetime            : task_completion_datetime,
                                            task_completion_userId              : task_completion_userId,
                                            task_completion_userName            : task_completion_userName,
                                            task_laborhour_hours                : task_laborhour_hours,
                                            task_laborhour_minutes              : task_laborhour_minutes,
                                            task_labor_note                     : task_labor_note,
                                            task_labor_ticketnoteId             : task_labor_ticketnoteId,
                                            task_response_status                : task_response_status,
                                            task_mgr_id                         : task_mgr_id
                                        });
                                        row_counter++;
                                        task_order_val++;
                                        task_order_end++;
                                        intializeTaskManager(globalArray)


                                    })
                                }
                                $(this).parent('.modal-buton').removeClass('custom-model-btn');
                                $(".addNewTask").hide('slow');
                                $(".addTaskGrpup").hide('slow');
                                $('#modal_taskgroup_id').val('');
                            },
                            error: function (jqXHR, textStatus, errorThrown) {
                                alert(textStatus + '. ' + errorThrown);
                            }
                        });
                    }
                }
                else{
                    task_order_val = $('#modal_task_order').val();
                    task_id_val = $('#modal_task_id').val();
                    task_id_text_val = $('#modal_task_id option:selected').text();
                    task_type_val = $('input[name=modal_task_type]:checked').val();
                    if(task_type_val == 0){
                        task_type_text_val = 'Complete';
                        modal_ttype_group_yes_val = ''
                        modal_ttype_group_yes_text_val = ''
                        modal_ttype_copen_yes_val = 0
                        modal_ttype_cticket_yes_val = 0
                        modal_ttype_substatus_yes_val = ''
                        modal_ttype_substatus_yes_text_val = ''
                        modal_ttype_group_no_val = ''
                        modal_ttype_group_no_text_val = ''
                        modal_ttype_copen_no_val = 0
                        modal_ttype_cticket_no_val = 0
                        modal_ttype_substatus_no_val = ''
                        modal_ttype_substatus_no_text_val = ''
                        modal_ttype_group_na_val = ''
                        modal_ttype_group_na_text_val = ''
                        modal_ttype_copen_na_val = 0
                        modal_ttype_cticket_na_val = 0
                        modal_ttype_substatus_na_val = ''
                        modal_ttype_substatus_na_text_val = ''
                    }
                    else{
                        task_type_text_val = 'Yes/No/NA';

                        //Case Yes on Response
                        /* Get Task Group on Yes Reponse */
                        if($('#modal_task_type_group_id1').val() != ''){
                            modal_ttype_group_yes_val = $('#modal_task_type_group_id1').val();
                            modal_ttype_group_yes_text_val = $('#modal_task_type_group_id1 option:selected').text();
                        }else{
                            modal_ttype_group_yes_val = '';
                            modal_ttype_group_yes_text_val = '';
                        }
                        /* Validate the Cancel All Open Task is Checked or Not*/
                        if ($('#modal_cancel_open_task1').is(":checked"))
                        {
                          modal_ttype_copen_yes_val = 1
                        }else{
                          modal_ttype_copen_yes_val = 0
                        }
                        /* Validate Close Ticket is Checked or Not*/
                        if ($('#modal_task_type_close_ticket1').is(":checked"))
                        {
                          modal_ttype_cticket_yes_val = 1
                        }else{
                          modal_ttype_cticket_yes_val = 0
                        }
                        /* Get Ticket Status Update from Substatus*/
                        if($('#modal_task_type_substatus_id1').val() != ''){
                            modal_ttype_substatus_yes_val = $('#modal_task_type_substatus_id1').val();
                            modal_ttype_substatus_yes_text_val = $('#modal_task_type_substatus_id1 option:selected').text();
                        }
                        else{
                            modal_ttype_substatus_yes_val = '';
                            modal_ttype_substatus_yes_text_val = '';
                        }

                        //Case No on Response
                        /* Get Task Group on No Reponse */
                        if($('#modal_task_type_group_id2').val() != ''){
                            modal_ttype_group_no_val = $('#modal_task_type_group_id2').val();
                            modal_ttype_group_no_text_val = $('#modal_task_type_group_id2 option:selected').text();
                        }else{
                            modal_ttype_group_no_val = '';
                            modal_ttype_group_no_text_val = '';
                        }
                        /* Validate the Cancel All Open Task is Checked or Not*/
                        if ($('#modal_cancel_open_task2').is(":checked"))
                        {
                          modal_ttype_copen_no_val = 1
                        }else{
                          modal_ttype_copen_no_val = 0
                        }
                        /* Validate Close Ticket is Checked or Not*/
                        if ($('#modal_task_type_close_ticket2').is(":checked"))
                        {
                          modal_ttype_cticket_no_val = 1
                        }else{
                          modal_ttype_cticket_no_val = 0
                        }
                        /* Get Ticket Status Update from Substatus*/
                        if($('#modal_task_type_substatus_id2').val() != ''){
                            modal_ttype_substatus_no_val = $('#modal_task_type_substatus_id2').val();
                            modal_ttype_substatus_no_text_val = $('#modal_task_type_substatus_id2 option:selected').text();
                        }
                        else{
                            modal_ttype_substatus_no_val = '';
                            modal_ttype_substatus_no_text_val = '';
                        }

                        // Case N/A on Reponse
                        /* Get Task Group on N/A Reponse */
                        if($('#modal_task_type_group_id3').val() != ''){
                            modal_ttype_group_na_val = $('#modal_task_type_group_id3').val();
                            modal_ttype_group_na_text_val = $('#modal_task_type_group_id3 option:selected').text();
                        }else{
                            modal_ttype_group_na_val = '';
                            modal_ttype_group_na_text_val = '';
                        }
                        /* Validate the Cancel All Open Task is Checked or Not*/
                        if ($('#modal_cancel_open_task3').is(":checked"))
                        {
                          modal_ttype_copen_na_val = 1
                        }else{
                          modal_ttype_copen_na_val = 0
                        }
                        /* Validate Close Ticket is Checked or Not*/
                        if ($('#modal_task_type_close_ticket3').is(":checked"))
                        {
                          modal_ttype_cticket_na_val = 1
                        }else{
                          modal_ttype_cticket_na_val = 0
                        }
                        /* Get Ticket Status Update from Substatus*/
                        if($('#modal_task_type_substatus_id3').val() != ''){
                            modal_ttype_substatus_na_val = $('#modal_task_type_substatus_id3').val();
                            modal_ttype_substatus_na_text_val = $('#modal_task_type_substatus_id3 option:selected').text();
                        }
                        else{
                            modal_ttype_substatus_na_val = '';
                            modal_ttype_substatus_na_text_val = '';
                        }

                    }
                    task_note_val = $('#modal_task_note').val();
                    tt_task_mgr_id = $('#modal_task_mgr_id').val();
                    // console.log("4");
                    // debugger;
                    dateObject = $('#modal_due_date').val();
                    task_due_date_val = dateObject;

                    task_dependency_val = $('input[name=modal_dependency]:checked').val();
                    task_dependency_text_val = $('#modal_dependency_order').val();
                    if(task_dependency_val == 1 && $.isNumeric(task_dependency_text_val)){
                        task_dependency_order_val = task_dependency_text_val
                        task_dependency_val = 1
                    }else{
                        task_dependency_order_val = 'None'
                        task_dependency_val = 0
                    }
                    task_assign_to_val = $('#modal_task_assign_to').val();
                    if (task_assign_to_val == '' || task_assign_to_val == undefined)
                    {
                        task_assign_to_val = ""
                    }
                    task_assign_to_text_val = $('#modal_task_assign_to option:selected').text();    
                    console.log(task_assign_to_val);

                    if(task_id_val == ''){
                        alert('Task Name cannot be Empty!');
                    }
                    else if(task_order_val == '' || task_order_val > task_order_end){
                        alert('Task Order must be a valid whole number between '+task_order_start+' and '+task_order_end+'!');
                    }
                    else if($(this).val() == 'Update' && task_order_val > (task_order_end-1)){
                        alert('Task Order must be a valid whole number between '+task_order_start+' and '+(task_order_end-1)+'!');
                    }
                    else {
                        $(this).parent('.modal-buton').removeClass('custom-model-btn');
                        if($(this).val() == 'Accept'){
                            if ($('#modal_is_cancel').is(":checked")){
                                task_is_cancel = 1
                                task_completion_datetime =  dateFormat(new Date().toLocaleString("en-US", {timeZone: '{{ uTimeZone }}' }), "mm/dd/yyyy h:MM TT");
                            }
                            else{
                                task_is_cancel = 0
                                task_completion_datetime = ''
                            }
                            task_is_complete = 0;
                            task_completion_userId = '';
                            task_completion_userName = '';
                            task_laborhour_hours = 0;
                            task_laborhour_minutes = 0;
                            task_labor_note = '';
                            task_labor_ticketnoteId = '';
                            task_response_status = '';

                            globalArray.push({
                                task_order_val                      : task_order_val,
                                task_id_val                         : task_id_val,
                                task_id_text_val                    : task_id_text_val,
                                task_assign_to_val                  : task_assign_to_val,
                                task_assign_to_text_val             : task_assign_to_text_val,
                                task_due_date_val                   : task_due_date_val,
                                task_dependency_text_val            : task_dependency_text_val,
                                task_type_val                       : task_type_val,
                                task_type_text_val                  : task_type_text_val,
                                modal_ttype_group_yes_val           : modal_ttype_group_yes_val,
                                modal_ttype_group_yes_text_val      : modal_ttype_group_yes_text_val,
                                modal_ttype_copen_yes_val           : modal_ttype_copen_yes_val,
                                modal_ttype_cticket_yes_val         : modal_ttype_cticket_yes_val,
                                modal_ttype_substatus_yes_val       : modal_ttype_substatus_yes_val,
                                modal_ttype_substatus_yes_text_val  : modal_ttype_substatus_yes_text_val,
                                modal_ttype_group_no_val            : modal_ttype_group_no_val,
                                modal_ttype_group_no_text_val       : modal_ttype_group_no_text_val,
                                modal_ttype_copen_no_val            : modal_ttype_copen_no_val,
                                modal_ttype_cticket_no_val          : modal_ttype_cticket_no_val,
                                modal_ttype_substatus_no_val        : modal_ttype_substatus_no_val,
                                modal_ttype_substatus_no_text_val   : modal_ttype_substatus_no_text_val,
                                modal_ttype_group_na_val            : modal_ttype_group_na_val,
                                modal_ttype_group_na_text_val       : modal_ttype_group_na_text_val,
                                modal_ttype_copen_na_val            : modal_ttype_copen_na_val,
                                modal_ttype_cticket_na_val          : modal_ttype_cticket_na_val,
                                modal_ttype_substatus_na_val        : modal_ttype_substatus_na_val,
                                modal_ttype_substatus_na_text_val   : modal_ttype_substatus_na_text_val,
                                task_note_val                       : task_note_val,
                                task_dependency_val                 : task_dependency_val,
                                task_dependency_order_val           : task_dependency_order_val,
                                task_is_cancel                      : task_is_cancel,
                                task_is_complete                    : task_is_complete,
                                task_completion_datetime            : task_completion_datetime,
                                task_completion_userId              : task_completion_userId,
                                task_completion_userName            : task_completion_userName,
                                task_laborhour_hours                : task_laborhour_hours,
                                task_laborhour_minutes              : task_laborhour_minutes,
                                task_labor_note                     : task_labor_note,
                                task_labor_ticketnoteId             : task_labor_ticketnoteId,
                                task_response_status                : task_response_status,
                                task_mgr_id                         : tt_task_mgr_id
                            });
                            row_counter++;
                            task_order_end++;
                            intializeTaskManager(globalArray)

                            clearNewTaskForm()

                        }
                        else if($(this).val() == 'Update') {
                            $(this).parent('.modal-buton').addClass('custom-model-btn');
                            task_laborhour_hours = parseInt($('#modal_labour_hours_hours').val());
                            task_laborhour_minutes = parseInt($('#modal_labour_hours_minutes').val());
                            task_labor_note = $('#modal_labor_note').val();

                            if (task_labor_note != '' && (task_laborhour_hours == 0) && (task_laborhour_minutes == 0)) {
                                alert('If you enter a Time Note you must enter some time.')
                            }
                            else if (task_laborhour_minutes > 59) {
                                alert('Minutes cannot be greater than 59!')
                            }
                            else {
                                $("#task-order" + row_edit + "").closest('tr').remove();
                                $("#tbl_row" + row_edit + "").remove();
                                task_labor_ticketnoteId = globalArray[row_index].task_labor_ticketnoteId
                                //Remove the Entry that is Updating
                                var tempCompletion = globalArray[row_index].task_completion_datetime
                                var tempIsCancel = globalArray[row_index].task_is_cancel
                                var tempIsComplete = globalArray[row_index].task_is_complete
                                var tempCompletionByUserId = globalArray[row_index].task_completion_userId
                                var tempCompletionByUserName = globalArray[row_index].task_completion_userName
                                var task_mgr_id = globalArray[row_index].task_mgr_id
                                // console.log("5");
                                // debugger;
                                var tempArray = $.grep(globalArray, function (e) {
                                    return e.task_order_val != row_edit;
                                });
                                globalArray = tempArray
                                var isCallRespone = 0


                                if($('#modal_is_cancel').is(":checked") || $('#modal_is_complete').is(":checked")){
                                    if ($('#modal_is_cancel').is(":checked")){
                                        $('#modal_is_complete').prop('checked', false);
                                        task_is_cancel = 1
                                        task_is_complete = 0
                                        if(tempCompletion == '' || tempIsCancel){
                                            task_completion_datetime =  dateFormat(new Date().toLocaleString("en-US", {timeZone: '{{ uTimeZone }}' }), "mm/dd/yyyy h:MM TT");
                                            task_completion_userId = {{ request.user.id }};
                                            task_completion_userName = "{{ request.user.display_name }}";
                                        } else {
                                            task_completion_datetime = tempCompletion;
                                            task_completion_userId = tempCompletionByUserId;
                                            task_completion_userName = tempCompletionByUserName;
                                        }
                                    }
                                    if ($('#modal_is_complete').is(":checked")){
                                        $('#modal_is_cancel').prop('checked', false);
                                        task_is_complete = 1
                                        task_is_cancel = 0
                                        if(tempCompletion == '' || tempIsComplete == 0){
                                            task_completion_datetime =  dateFormat(new Date().toLocaleString("en-US", {timeZone: '{{ uTimeZone }}' }), "mm/dd/yyyy h:MM TT");
                                            task_completion_userId = {{ request.user.id }};
                                            task_completion_userName =  "{{ request.user.display_name }}";
                                            if(task_type_val == 1){
                                                isCallRespone = parseInt($('input[name=modal_complete_response]:checked').val());
                                            }

                                        }else{
                                            task_completion_datetime =  tempCompletion;
                                            task_completion_userId =  tempCompletionByUserId;
                                            task_completion_userName =  tempCompletionByUserName;
                                            task_response_status = parseInt($('input[name=modal_complete_response]:checked').val());
                                        }

                                    }
                                }
                                else{
                                    task_is_cancel = 0
                                    task_is_complete = 0;
                                    task_completion_datetime = ''
                                    task_completion_userId = ''
                                    task_completion_userName = ''
                                    task_response_status = ''

                                }

                                {#Add Entry of Updating Task with New Values#}
                                globalArray.push({
                                    task_order_val                      : task_order_val,
                                    task_id_val                         : task_id_val,
                                    task_id_text_val                    : task_id_text_val,
                                    task_assign_to_val                  : task_assign_to_val,
                                    task_assign_to_text_val             : task_assign_to_text_val,
                                    task_due_date_val                   : task_due_date_val,
                                    task_dependency_text_val            : task_dependency_text_val,
                                    task_type_val                       : task_type_val,
                                    task_type_text_val                  : task_type_text_val,
                                    modal_ttype_group_yes_val           : modal_ttype_group_yes_val,
                                    modal_ttype_group_yes_text_val      : modal_ttype_group_yes_text_val,
                                    modal_ttype_copen_yes_val           : modal_ttype_copen_yes_val,
                                    modal_ttype_cticket_yes_val         : modal_ttype_cticket_yes_val,
                                    modal_ttype_substatus_yes_val       : modal_ttype_substatus_yes_val,
                                    modal_ttype_substatus_yes_text_val  : modal_ttype_substatus_yes_text_val,
                                    modal_ttype_group_no_val            : modal_ttype_group_no_val,
                                    modal_ttype_group_no_text_val       : modal_ttype_group_no_text_val,
                                    modal_ttype_copen_no_val            : modal_ttype_copen_no_val,
                                    modal_ttype_cticket_no_val          : modal_ttype_cticket_no_val,
                                    modal_ttype_substatus_no_val        : modal_ttype_substatus_no_val,
                                    modal_ttype_substatus_no_text_val   : modal_ttype_substatus_no_text_val,
                                    modal_ttype_group_na_val            : modal_ttype_group_na_val,
                                    modal_ttype_group_na_text_val       : modal_ttype_group_na_text_val,
                                    modal_ttype_copen_na_val            : modal_ttype_copen_na_val,
                                    modal_ttype_cticket_na_val          : modal_ttype_cticket_na_val,
                                    modal_ttype_substatus_na_val        : modal_ttype_substatus_na_val,
                                    modal_ttype_substatus_na_text_val   : modal_ttype_substatus_na_text_val,
                                    task_note_val                       : task_note_val,
                                    task_dependency_val                 : task_dependency_val,
                                    task_dependency_order_val           : task_dependency_order_val,
                                    task_is_cancel                      : task_is_cancel,
                                    task_is_complete                    : task_is_complete,
                                    task_completion_datetime            : task_completion_datetime,
                                    task_completion_userId              : task_completion_userId,
                                    task_completion_userName            : task_completion_userName,
                                    task_laborhour_hours                : task_laborhour_hours,
                                    task_laborhour_minutes              : task_laborhour_minutes,
                                    task_labor_note                     : task_labor_note,
                                    task_labor_ticketnoteId             : task_labor_ticketnoteId,
                                    task_response_status                : task_response_status,
                                    task_mgr_id                         : task_mgr_id
                                });
                                if(parseInt(task_order_val) > parseInt(row_edit)){
                                    sortByKeyAsc(globalArray, 'task_order_val')
                                }

                                intializeTaskManager(globalArray)

                                if(isCallRespone != 0){
                                    if(isCallRespone == 1){
                                        indirectTaskResponseAction(event,task_order_val,modal_ttype_group_yes_val,modal_ttype_copen_yes_val,modal_ttype_cticket_yes_val,modal_ttype_substatus_yes_val,modal_ttype_substatus_yes_text_val,1);
                                    }
                                    else if(isCallRespone == 2){
                                        indirectTaskResponseAction(event,task_order_val,modal_ttype_group_no_val,modal_ttype_copen_no_val,modal_ttype_cticket_no_val,modal_ttype_substatus_no_val,modal_ttype_substatus_no_text_val,2);
                                    }
                                    else if(isCallRespone == 3){
                                        indirectTaskResponseAction(event,task_order_val,modal_ttype_group_na_val,modal_ttype_copen_na_val,modal_ttype_cticket_na_val,modal_ttype_substatus_na_val,modal_ttype_substatus_na_text_val,3);
                                    }
                                }

                                $(this).parent('.modal-buton').removeClass('custom-model-btn');
                                $(".addNewTask").hide('slow');
                                $(".addTaskGrpup").hide('slow');
                                clearNewTaskForm()
                            }
                        }
                    }
                }

            });


            //Delete the Task Manager Task
            function deleteTMTask(tsk_id) {
               $('#confirm-tsk-delete').modal('toggle');
               $('#accept-btn').parent('.modal-buton').removeClass('custom-model-btn');
                r_id = ($("[data-id="+tsk_id+"]").attr('data-id'));
                $($("[data-id="+tsk_id+"]")).closest('tr').remove();
                $("#tbl_row"+ r_id + "").remove();
                row_index = r_id - 1;
                labor_ticketnoteId = globalArray[row_index].task_labor_ticketnoteId;

                var tempArray = $.grep(globalArray, function(e){
                     return e.task_order_val != r_id;
                });
                globalArray = tempArray

                if(labor_ticketnoteId == ""){
                    intializeTaskManager(globalArray)
                    row_counter--;
                    task_order_end--;
                }
                else{
                    $.ajax({
                        url:"{% url 'deleteLaborTicketNoteById' %}",
                        type:'POST',
                        dataType: 'text',
                        data:{
                            'noteId': labor_ticketnoteId,
                            'csrfmiddlewaretoken': $('input[name=csrfmiddlewaretoken]').val(),
                        },
                        success:function(data){
                            result = $.parseJSON(data);
                            if(result.response == 'Success'){
                                intializeTaskManager(globalArray)
                                row_counter--;
                                task_order_end--;
                            }
                        },
                        error:function(){
                            console.log('error')
                        },
                    });

                }
            }


            $('#confirm-tsk-delete').on('show.bs.modal', function(e) {
                $(this).find('.btn-ok').attr('href', $(e.relatedTarget).data('href'));
            });


            $(document).on('click', '#btnReset', function(e) {
                e.preventDefault();
                row_counter = 0;
                task_order_start = 1;
                task_order_end = 1;
                globalArray = []
                $('.table-task-modal tbody').html('')
                $('.table-tasks tbody').html('')
                var ticket_id = {{ data.ticket_id }};
                $.ajax({
                    type: 'POST',
                    url: "{% url 'getTaskManagerByTicketId' %}",
                    data: {ticket_id: ticket_id},
                    dataType: 'json',
                    beforeSend: function (jqXHR, settings) {
                        //Do something before send...
                    },
                    success: function (data, textStatus, jqXHR) {
                        if (data.response) {
                            result = jQuery.parseJSON(data['response'])
                            $.each(result, function (index) {
                                task_order_val = result[index].fields.tmgr_display_order
                                task_id_val = result[index].fields.tmgr_task;
                                task_id_text_val = $("#modal_task_id option[value='" + result[index].fields.tmgr_task + "']").text();
                                task_type_val = result[index].fields.task_type;
                                task_mgr_id = result[index].pk;
                                if (task_type_val == 0) {
                                    task_type_text_val = 'Complete';
                                    modal_ttype_group_yes_val = ''
                                    modal_ttype_group_yes_text_val = '';
                                    modal_ttype_copen_yes_val = 0;
                                    modal_ttype_cticket_yes_val = 0;
                                    modal_ttype_substatus_yes_val = '';
                                    modal_ttype_substatus_yes_text_val = '';
                                    modal_ttype_group_no_val = '';
                                    modal_ttype_group_no_text_val = '';
                                    modal_ttype_copen_no_val = 0;
                                    modal_ttype_cticket_no_val = 0;
                                    modal_ttype_substatus_no_val = '';
                                    modal_ttype_substatus_no_text_val = '';
                                    modal_ttype_group_na_val = '';
                                    modal_ttype_group_na_text_val = '';
                                    modal_ttype_copen_na_val = 0;
                                    modal_ttype_cticket_na_val = 0;
                                    modal_ttype_substatus_na_val = '';
                                    modal_ttype_substatus_na_text_val = '';
                                }
                                else {
                                    task_type_text_val = 'Yes/No/NA';

                                    /*Cases For Yes/No/NA Task Types Start*/
                                    modal_ttype_group_yes_val = result[index].fields.ttype_group_yes;
                                    modal_ttype_group_yes_text_val = $("#modal_task_type_group_id1 option[value='" + result[index].fields.ttype_group_yes + "']").text();
                                    modal_ttype_copen_yes_val = result[index].fields.ttype_copen_yes;
                                    modal_ttype_cticket_yes_val = result[index].fields.ttype_cticket_yes;
                                    modal_ttype_substatus_yes_val = result[index].fields.ttype_substatus_yes;
                                    modal_ttype_substatus_yes_text_val = $("#modal_task_type_substatus_id1 option[value='" + result[index].fields.ttype_substatus_yes + "']").text();
                                    modal_ttype_group_no_val = result[index].fields.ttype_group_no;
                                    modal_ttype_group_no_text_val = $("#modal_task_type_group_id2 option[value='" + result[index].fields.ttype_group_no + "']").text();
                                    modal_ttype_copen_no_val = result[index].fields.ttype_copen_no;
                                    modal_ttype_cticket_no_val = result[index].fields.ttype_cticket_no;
                                    modal_ttype_substatus_no_val = result[index].fields.ttype_substatus_no;
                                    modal_ttype_substatus_no_text_val = $("#modal_task_type_substatus_id2 option[value='" + result[index].fields.ttype_substatus_no + "']").text();
                                    modal_ttype_group_na_val = result[index].fields.ttype_group_na;
                                    modal_ttype_group_na_text_val = $("#modal_task_type_group_id3 option[value='" + result[index].fields.ttype_group_na + "']").text();
                                    modal_ttype_copen_na_val = result[index].fields.ttype_copen_na;
                                    modal_ttype_cticket_na_val = result[index].fields.ttype_cticket_na;
                                    modal_ttype_substatus_na_val = result[index].fields.ttype_substatus_na;
                                    modal_ttype_substatus_na_text_val = $("#modal_task_type_substatus_id3 option[value='" + result[index].fields.ttype_substatus_na + "']").text();

                                    /*Cases For Yes/No/NA Task Types End*/
                                }

                                task_note_val = result[index].fields.task_note;
                                task_due_date_val = result[index].fields.task_due_date;
                                if(task_due_date_val != null){
                                    var dateAr = task_due_date_val.split('-');
                                    task_due_date_val = dateAr[2] + '/' + dateAr[1] + '/' + dateAr[0];
                                }
                                else{
                                    task_due_date_val = '';
                                }
                                task_dependency_val = result[index].fields.task_dependency;
                                if (task_dependency_val == false) {
                                    task_dependency_text_val = 'None'
                                    task_dependency_val = 0
                                }
                                else {
                                    task_dependency_text_val = 'Order'
                                    task_dependency_val = 1
                                }
                                task_dependency_order_val = result[index].fields.task_depend_order;
                                task_assign_to_val = result[index].fields.task_assigned_to ? result[index].fields.task_assigned_to : "";
                                task_assign_to_text_val = $("#modal_task_assign_to option[value='" + result[index].fields.task_assigned_to + "']").text()
                                task_is_cancel = result[index].fields.tmgr_is_cancel;
                                task_is_complete = result[index].fields.tmgr_is_complete;
                                if(task_is_cancel == 1 || task_is_complete == 1){
                                   var date = new Date(result[index].fields.tmgr_completion_at).toUTCString();
                                   var uTimeZone = '{{ uTimeZone }}'
                                   task_completion_datetime = dateFormat(new Date(date).toLocaleString("en-US", {timeZone: uTimeZone }), "mm/dd/yyyy h:MM TT");
                                }
                                else{
                                    task_completion_datetime = ''
                                }
                                task_completion_userId = result[index].fields.tmgr_completion_userId ? result[index].fields.tmgr_completion_userId : "";
                                task_completion_userName = result[index].fields.tmgr_completion_userName ? result[index].fields.tmgr_completion_userName : "";
                                task_laborhour_hours = parseInt(result[index].fields.tmgr_laborhour_hours);
                                task_laborhour_minutes = parseInt(result[index].fields.tmgr_laborhour_minutes);
                                task_labor_note = result[index].fields.tmgr_labor_note;
                                task_labor_ticketnoteId = result[index].fields.tmgr_labor_ticketnote ? result[index].fields.tmgr_labor_ticketnote : "";
                                task_response_status = result[index].fields.tmgr_response_status;

                                //Appened Row on the Panel as well on the Table
                                globalArray.push({
                                    task_order_val: task_order_val,
                                    task_id_val: task_id_val,
                                    task_id_text_val: task_id_text_val,
                                    task_assign_to_val: task_assign_to_val,
                                    task_assign_to_text_val: task_assign_to_text_val,
                                    task_due_date_val: task_due_date_val,
                                    task_dependency_text_val: task_dependency_text_val,
                                    task_type_val: task_type_val,
                                    task_type_text_val: task_type_text_val,
                                    modal_ttype_group_yes_val           : modal_ttype_group_yes_val,
                                    modal_ttype_group_yes_text_val      : modal_ttype_group_yes_text_val,
                                    modal_ttype_copen_yes_val           : modal_ttype_copen_yes_val,
                                    modal_ttype_cticket_yes_val         : modal_ttype_cticket_yes_val,
                                    modal_ttype_substatus_yes_val       : modal_ttype_substatus_yes_val,
                                    modal_ttype_substatus_yes_text_val  : modal_ttype_substatus_yes_text_val,
                                    modal_ttype_group_no_val            : modal_ttype_group_no_val,
                                    modal_ttype_group_no_text_val       : modal_ttype_group_no_text_val,
                                    modal_ttype_copen_no_val            : modal_ttype_copen_no_val,
                                    modal_ttype_cticket_no_val          : modal_ttype_cticket_no_val,
                                    modal_ttype_substatus_no_val        : modal_ttype_substatus_no_val,
                                    modal_ttype_substatus_no_text_val   : modal_ttype_substatus_no_text_val,
                                    modal_ttype_group_na_val            : modal_ttype_group_na_val,
                                    modal_ttype_group_na_text_val       : modal_ttype_group_na_text_val,
                                    modal_ttype_copen_na_val            : modal_ttype_copen_na_val,
                                    modal_ttype_cticket_na_val          : modal_ttype_cticket_na_val,
                                    modal_ttype_substatus_na_val        : modal_ttype_substatus_na_val,
                                    modal_ttype_substatus_na_text_val   : modal_ttype_substatus_na_text_val,
                                    task_note_val                       : task_note_val,
                                    task_dependency_val                 : task_dependency_val,
                                    task_dependency_order_val           : task_dependency_order_val,
                                    task_is_cancel                      : task_is_cancel,
                                    task_is_complete                    : task_is_complete,
                                    task_completion_datetime            : task_completion_datetime,
                                    task_completion_userId              : task_completion_userId,
                                    task_completion_userName            : task_completion_userName,
                                    task_laborhour_hours                : task_laborhour_hours,
                                    task_laborhour_minutes              : task_laborhour_minutes,
                                    task_labor_note                     : task_labor_note,
                                    task_labor_ticketnoteId             : task_labor_ticketnoteId,
                                    task_response_status                : task_response_status,
                                    task_mgr_id                         : task_mgr_id
                                });

                                {#intializeTaskManager(globalArray)#}
                                row_counter++;
                                task_order_end++;
                            });

                            //Appened Entry on the Task Manager Table
                            $.ajax({
                                url:"{% url 'getModalTaskManagerById' %}",
                                type:'POST',
                                dataType: 'text',
                                data:{
                                    'records':JSON.stringify(globalArray),
                                    'csrfmiddlewaretoken': $('input[name=csrfmiddlewaretoken]').val(),
                                },
                                success:function(data){
                                    $('.table-task-modal tbody').append(data);
                                },
                                error:function(){
                                    console.log('error')
                                },
                            });

                            var collection = $.grep(globalArray, function(n,i){return n.task_completion_datetime==='' && n.task_dependency_order_val!='' && n.task_dependency_order_val!='None'});
                            var values = collection.map(a => a.task_dependency_order_val);

                            //Appened Entry on the Submit Ticket Table along with the Task Manger Button
                            $.ajax({
                                url:"{% url 'getTableTaskManagerById' %}",
                                type:'POST',
                                dataType: 'text',
                                data:{
                                    'records':JSON.stringify(globalArray),
                                    'depend_value':Math.min.apply(Math, values),
                                    'csrfmiddlewaretoken': $('input[name=csrfmiddlewaretoken]').val(),
                                },
                                success:function(data){
                                    $('.table-tasks tbody').append(data);
                                },
                                error:function(){
                                    console.log('error')
                                },
                            });

                        }
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        alert(textStatus + '. ' + errorThrown);
                    }
                });
                $('#imgCancelled').hide();


            })


            $(document).on('click','.edit_record',function () {
                $('#BtnNewTask').parent('.modal-buton').removeClass('custom-model-btn');
                $(".addNewTask").hide('slow');
                $(".addTaskGrpup").hide('slow');
                $('#BtnNewTask').parent('.modal-buton').addClass('custom-model-btn');
                $('#accept-btn').val('Update')
                $('#taskEditDiv').show();
                $('tr').removeClass( "show-detail" );
                $('#modal_is_cancel').attr('data-mode', 'task-edit')
                $('#modal_is_complete').attr('data-mode', 'task-edit')
                if(task_order_end <= 2){
                    $('#modal_task_order').prop('readonly', true)
                }else{
                    $('#modal_task_order').prop('readonly', false)
                }

                $(".addNewTask").toggle('slow');
                row_edit = r_id = $(this).attr('data-id');
                row_index = row_edit - 1;
                t_order = globalArray[row_index].task_order_val;
                t_id = globalArray[row_index].task_id_val;
                t_type = globalArray[row_index].task_type_val;
                t_note = globalArray[row_index].task_note_val;
                t_task_mgr_id = globalArray[row_index].task_mgr_id;
                t_due_date = globalArray[row_index].task_due_date_val;
                t_dependency = globalArray[row_index].task_dependency_val;
                t_dependency_order = globalArray[row_index].task_dependency_order_val;
                t_assign_to = globalArray[row_index].task_assign_to_val ? globalArray[row_index].task_assign_to_val : "";

                /* Get Values for the Ticket Type YES/NO/NA Start*/
                modal_ttype_group_yes_val = globalArray[row_index].modal_ttype_group_yes_val
                modal_ttype_copen_yes_val = globalArray[row_index].modal_ttype_copen_yes_val
                modal_ttype_cticket_yes_val = globalArray[row_index].modal_ttype_cticket_yes_val
                modal_ttype_substatus_yes_val = globalArray[row_index].modal_ttype_substatus_yes_val
                modal_ttype_group_no_val = globalArray[row_index].modal_ttype_group_no_val
                modal_ttype_copen_no_val = globalArray[row_index].modal_ttype_copen_no_val
                modal_ttype_cticket_no_val = globalArray[row_index].modal_ttype_cticket_no_val
                modal_ttype_substatus_no_val = globalArray[row_index].modal_ttype_substatus_no_val
                modal_ttype_group_na_val = globalArray[row_index].modal_ttype_group_na_val
                modal_ttype_copen_na_val = globalArray[row_index].modal_ttype_copen_na_val
                modal_ttype_cticket_na_val = globalArray[row_index].modal_ttype_cticket_na_val
                modal_ttype_substatus_na_val = globalArray[row_index].modal_ttype_substatus_na_val
                /* Get Values for the Ticket Type YES/NO/NA Start*/

                t_is_cancel = globalArray[row_index].task_is_cancel
                t_is_complete = globalArray[row_index].task_is_complete
                t_is_completion_datetime = globalArray[row_index].task_completion_datetime
                t_is_completion_userName = globalArray[row_index].task_completion_userName
                t_laborhour_hours = globalArray[row_index].task_laborhour_hours
                t_laborhour_minutes = globalArray[row_index].task_laborhour_minutes
                t_labor_note = globalArray[row_index].task_labor_note
                t_response_status = globalArray[row_index].task_response_status


                $('#modal_task_order').val(t_order)
                $('#modal_task_order').val(t_order)
                $('#modal_task_id').val(t_id)
                if(t_type == '0'){
                    $('#modal_task_type1').prop('checked',true);
                    $('.incomplete_ticket_type').hide();

                    /* Get Task Group on Yes Reponse */
                    $('#modal_task_type_group_id1').val('')

                    /* Validate the Cancel All Open Task is Checked or Not*/
                   $('#modal_cancel_open_task1').prop('checked',false);

                    /* Validate Close Ticket is Checked or Not*/
                   $('#modal_task_type_close_ticket1').prop('checked',false);

                    /* Get Ticket Status Update from Substatus*/
                    $('#modal_task_type_substatus_id1').val('')

                    //Case Yes on Response End


                    //Case No on Response Start
                    /* Get Task Group on No Reponse */
                    $('#modal_task_type_group_id2').val('')

                    /* Validate the Cancel All Open Task is Checked or Not*/
                    $('#modal_cancel_open_task2').prop('checked',false);

                    /* Validate Close Ticket is Checked or Not*/
                    $('#modal_task_type_close_ticket2').prop('checked',false);

                    /* Get Ticket Status Update from Substatus*/
                    $('#modal_task_type_substatus_id2').val('')

                    //Case No on Response End


                    //Case N/A on Response Start
                    /* Get Task Group on Yes Reponse */
                    $('#modal_task_type_group_id3').val('')

                    /* Validate the Cancel All Open Task is Checked or Not*/
                    $('#modal_cancel_open_task3').prop('checked',false);

                    /* Validate Close Ticket is Checked or Not*/
                    $('#modal_task_type_close_ticket3').prop('checked',false);

                    /* Get Ticket Status Update from Substatus*/
                    $('#modal_task_type_substatus_id3').val('')

                    //Case N/A on Response End
                }
                else{
                    $('#modal_task_type2').prop('checked',true);
                    $('.incomplete_ticket_type').show();
                    //Case Yes on Response Start

                    /* Get Task Group on Yes Reponse */
                    $('#modal_task_type_group_id1').val(modal_ttype_group_yes_val)

                    /* Validate the Cancel All Open Task is Checked or Not*/
                    if(modal_ttype_copen_yes_val == '1'){
                       $('#modal_cancel_open_task1').prop('checked',true);
                    }
                    else{
                       $('#modal_cancel_open_task1').prop('checked',false);
                    }

                    /* Validate Close Ticket is Checked or Not*/
                    if(modal_ttype_cticket_yes_val == '1'){
                       $('#modal_task_type_close_ticket1').prop('checked',true);
                       $('#modal_task_type_group_id1').prop('disabled', true);
                       $('#modal_task_type_group_id1').val('');
                    }
                    else{
                       $('#modal_task_type_close_ticket1').prop('checked',false);
                       $('#modal_task_type_group_id1').prop('disabled', false);
                    }

                    /* Get Ticket Status Update from Substatus*/
                    $('#modal_task_type_substatus_id1').val(modal_ttype_substatus_yes_val)

                    //Case Yes on Response End


                    //Case No on Response Start
                    /* Get Task Group on No Reponse */
                    $('#modal_task_type_group_id2').val(modal_ttype_group_no_val)

                    /* Validate the Cancel All Open Task is Checked or Not*/
                    if(modal_ttype_copen_no_val == '1'){
                       $('#modal_cancel_open_task2').prop('checked',true);
                    }
                    else{
                       $('#modal_cancel_open_task2').prop('checked',false);
                    }

                    /* Validate Close Ticket is Checked or Not*/
                    if(modal_ttype_cticket_no_val == '1'){
                       $('#modal_task_type_close_ticket2').prop('checked',true);
                       $('#modal_task_type_group_id2').prop('disabled', true);
                       $('#modal_task_type_group_id2').val('');
                    }
                    else{
                       $('#modal_task_type_close_ticket2').prop('checked',false);
                       $('#modal_task_type_group_id2').prop('disabled', false);
                    }

                    /* Get Ticket Status Update from Substatus*/
                    $('#modal_task_type_substatus_id2').val(modal_ttype_substatus_no_val)

                    //Case No on Response End


                    //Case N/A on Response Start
                    /* Get Task Group on Yes Reponse */
                    $('#modal_task_type_group_id3').val(modal_ttype_group_na_val)

                    /* Validate the Cancel All Open Task is Checked or Not*/
                    if(modal_ttype_copen_na_val == '1'){
                       $('#modal_cancel_open_task3').prop('checked',true);
                    }
                    else{
                       $('#modal_cancel_open_task3').prop('checked',false);
                    }

                    /* Validate Close Ticket is Checked or Not*/
                    if(modal_ttype_cticket_na_val == '1'){
                       $('#modal_task_type_close_ticket3').prop('checked',true);
                       $('#modal_task_type_group_id3').prop('disabled', true);
                       $('#modal_task_type_group_id3').val('');
                    }
                    else{
                       $('#modal_task_type_close_ticket3').prop('checked',false);
                       $('#modal_task_type_group_id3').prop('disabled', false);
                    }

                    /* Get Ticket Status Update from Substatus*/
                    $('#modal_task_type_substatus_id3').val(modal_ttype_substatus_na_val)

                    //Case N/A on Response End

                }
                $('#modal_task_note').val(t_note)
                $('#modal_task_mgr_id').val(t_task_mgr_id)
                $('#modal_due_date').val(t_due_date)
                if(t_dependency == '0'){$('#modal_dependency1').prop('checked',true);}else{$('#modal_dependency2').prop('checked',true)}
                if(t_dependency == '1'){$('#modal_dependency_order').val(t_dependency_order);$('#modal_dependency_order').prop('readonly', false)}else{$('#modal_dependency_order').val('');$('#modal_dependency_order').prop('readonly', true)}
                $('#modal_task_assign_to').select2("val", t_assign_to);
                if(t_is_cancel == 1) {
                    $('#modal_is_cancel').prop('checked', true);
                    $('#imgCancelled').show();
                    $('#taskCompleteDiv').hide();
                    $('#taskCompleteResponseDiv').hide();

                }
                else{
                    $('#modal_is_cancel').prop('checked', false);
                    $('#imgCancelled').hide();
                    $('#taskCompleteDiv').show();
                }
                if(t_is_complete == 1) {
                    $('#modal_is_complete').prop('checked', true);
                    $('#spnCompletedDateEdit').html('on ' + t_is_completion_datetime + ' by ' + t_is_completion_userName);
                    if(t_type == 1){
                        if(t_response_status == 2){
                            $('#modal_complete_response_no').prop('checked',true);
                        }else if(t_response_status == 3){
                            $('#modal_complete_response_na').prop('checked',true);
                        }else{
                            $('#modal_complete_response_yes').prop('checked',true);
                        }
                        $('#taskCompleteResponseDiv').show();
                    }

                }
                else{
                    $('#modal_is_complete').prop('checked', false);
                    $('#spnCompletedDateEdit').html('');
                    $('#taskCompleteResponseDiv').hide()
                }
                $('#modal_labour_hours_hours').val(t_laborhour_hours);
                $('#modal_labour_hours_minutes').val(t_laborhour_minutes);
                $('#modal_labor_note').val(t_labor_note);

            });


            $(document).on('click','#btnDone',function (e) {
                console.log(JSON.stringify(globalArray));
                e.preventDefault();
                $('#preloader').show();
                $.ajax({
                    url:"{% url 'saveModalTaskManagerByTicketId' %}",
                    type:'POST',
                    dataType: 'text',
                    data:{
                        'records':JSON.stringify(globalArray),
                        'ticketId': {{ data.ticket_id }},
                        'csrfmiddlewaretoken': $('input[name=csrfmiddlewaretoken]').val(),
                    },
                    success:function(data){
                        result = $.parseJSON(data);
                        $('#preloader').hide();
                        if(result.response == 'Success'){
                         location.reload();
                        }
                    },
                    error:function(){
                        console.log('error')
                        $('#preloader').hide();
                    },
                });
            });


            function checkIsNumeric(value) {
                /^\d*$/.test(value);
            }


        </script>
        <script>
        $('#confirm-delete').on('show.bs.modal', function(e) {
            $(this).find('.btn-ok').attr('href', $(e.relatedTarget).data('href'));
        });

        </script>

        <script>
            $(document).on('click','#modalLG',function(e){if($('.select2-drop-active').is(':visible')){$('.select2-drop-active').hide();$('.select2-container-active').removeClass('select2-dropdown-open')}});
        </script>
        <script type="text/javascript">
        	$(document).ready(function(){
	        	$(".show-link").click(function(){
	        		$(".panel-body").toggleClass("show-data");
	        	});
        	});
        </script>
        <!-- DropZone Modal for Attachments Start-->
        <script>
            Dropzone.autoDiscover = false;
            if ($("#my-awesome-dropzone").length > 0){
                var myyDropzone = new Dropzone("#my-awesome-dropzone", {
                    url: "{% url 'saveDropAttachment' %}",
                    paramName: "file", //the parameter name containing the uploaded file
                    clickable: true,
                    autoProcessQueue: true,
                    method: "post",
                    createImageThumbnails: true,
                    addRemoveLinks: true,
                    maxFilesize: 256 * 4 * 10,
                    maxFiles: 1000,
                    dictDefaultMessage: "Drag & drop PDF file the file size must <br> be less then 25 MB", //override the default text
                    uploadMultiple: true,
                    parallelUploads: 10,

                    init: function () {
                        var myDropzone = this;
                        var counter = 0;
                        this.on("addedfile", function (file) {
                            counter = 0;
                            /* Display Default file icon */
                            var ext = file.name.split('.').pop();
                            ext = ext.toLowerCase();

                            if (ext == "pdf") {
                                $(file.previewElement).find(".dz-image img").attr("src", "{% static "itrak/images/icons/dummypdf.jpg" %}");
                            } else if (ext.indexOf("doc") != -1) {
                                $(file.previewElement).find(".dz-image img").attr("src", "{% static "itrak/images/icons/dummyword.jpg" %}");
                            } else if (ext.indexOf("xls") != -1 || ext.indexOf("xlsx") != -1) {
                                $(file.previewElement).find(".dz-image img").attr("src", "{% static "itrak/images/icons/dummyxls.jpg" %}");
                            } else if (ext.indexOf("txt") != -1) {
                                $(file.previewElement).find(".dz-image img").attr("src", "{% static "itrak/images/icons/dummytext1.jpg" %}");
                            } else if (ext.indexOf("pptx") != -1) {
                                $(file.previewElement).find(".dz-image img").attr("src", "{% static "itrak/images/icons/dummyppt.jpg" %}");
                            }else{
                                $(file.previewElement).find(".dz-image img").attr("src", "{% static "itrak/images/icons/dummydefault.png" %}");
                            }
                            /* Remove file */
                            while (this.files.length > this.options.maxFiles) {
                                this.removeFile(this.files[0]);
                                //alertify.error("You can not upload more than 6 files");
                            }
                        });
                        this.on("processing", function (file) {
                            //alert('ABC')
                        });
                        this.on("uploadprogress", function (file, progress, bytesSent) {
                            //debugger;
                            var form_id = $(this.element).closest('form').attr('id');
                            progress = Math.floor(progress);
                            $(file.previewElement).find(".dz-upload").text(progress + "%");

                        });

                        this.on("success", function (file, responseText) {
                            result = responseText;
                            console.log(counter)
                            if(result){
                                $(file.previewElement).find(".dz-download a").attr("href", "{{ MEDIA_URL }}"+result[counter].path);
                                $(file.previewElement).find(".dz-remove").attr("id", result[counter].id);
                                $('.attach-badge').html(++attach_badge);
                                counter++;
                            }

                            /*
                            $.ajax({
                                url:'/getLatesAttachementByTicketId/',
                                type:'POST',
                                dataType: 'text',
                                data:{
                                    'ticketId': {{ data.ticket_id }},
                                    'csrfmiddlewaretoken': $('input[name=csrfmiddlewaretoken]').val(),
                                },
                                success:function(data){
                                    result = $.parseJSON(data);
                                    if(result.response != ''){
                                        $(file.previewElement).find(".dz-download a").attr("href", "{{ MEDIA_URL }}"+result.path);
                                        $(file.previewElement).find(".dz-remove").attr("id", result.response);
                                        $('.attach-badge').html(++attach_badge);
                                    }
                                },
                                error:function(){
                                    console.log('error')
                                },
                            });
                            */
                        });
                        this.on("removedfile", function(file){
                            aid = file._removeLink.id
                            $.ajax({
                                url:"{% url 'deleteAttachementByAttachId' %}",
                                type:'POST',
                                dataType: 'text',
                                data:{
                                    'attachId': aid,
                                    'csrfmiddlewaretoken': $('input[name=csrfmiddlewaretoken]').val(),
                                },
                                success:function(data){
                                    result = $.parseJSON(data);
                                    $('.attach-badge').html(--attach_badge);
                                },
                                error:function(){
                                    console.log('error')
                                },
                            });
                        });

                        this.on("error", function (file, errorMessage) {
                            //debugger;
                            //this.removeFile(this.files);
                            $(file.previewElement).remove();
                            alertify.error(errorMessage);

                        });

                        this.on("successmultiple", function (files, response) {
                        });
                    },
                    sending: function (file, xhr, formData) {
                        formData.append('csrfmiddlewaretoken', getCookie('csrftoken'));
                        formData.append('ticket_id', $('#ticket_id').val());
                        formData.append("file", file);
                    }
                });

            }
            function deleteTicketAttachment(element, attach_id) {
                if(attach_id){
                    alertify.confirm("Are you sure you want to delete this attachment?", function (e) {
                    if (e) {
                        $.ajax({
                            url:"{% url 'deleteAttachementByAttachId' %}",
                            type:'POST',
                            dataType: 'text',
                            data:{
                                'attachId': attach_id,
                                'csrfmiddlewaretoken': $('input[name=csrfmiddlewaretoken]').val(),
                            },
                            success:function(data){
                                result = $.parseJSON(data);
                                $('.attach-badge').html(--attach_badge);
                                $(element).parents('.dz-preview').remove();
                            },
                            error:function(){
                                console.log('error')
                            },
                        });
                    }
                    else{
                          alertify.log("Your attachment is safe!");
                        }
                    });

                }
            }

            function getCookie(name) {
                var cookieValue = null;
                if (document.cookie && document.cookie != '') {
                    var cookies = document.cookie.split(';');
                    for (var i = 0; i < cookies.length; i++) {
                        var cookie = jQuery.trim(cookies[i]);
                        // Does this cookie string begin with the name we want?
                        if (cookie.substring(0, name.length + 1) == (name + '=')) {
                            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                            break;
                        }
                    }
                }
                return cookieValue;
            }
        </script>
        <!-- DropZone Modal for Attachments End-->

        <!-- Validation Check on Page Start -->
        <script>
            function checkNumericRequired(element) {
                if(isEmpty(element.value) ) {
                    element.value= 0;
                }
            }
            function isEmpty(str){
                return !str.replace(/\s|[0]/g, '').length;
            }
        </script>
        <script type="text/javascript">
        	$( "#showhide_notes" ).click(function() {
        	  $( ".all-notes" ).slideToggle( "slow", function() {
        	    // Animation complete.
        	  });
            });
            function closePopUp(){
                $('#modal_task_assign_to').select2("close");
            }
        </script>
        <!-- Validation Check on Page End -->

    {% endblock %}

