
    {% extends 'itrak/base.html' %}

    {% block body_block %}
        {% load static %}
        {% load tz %} {# it will Load the Django TimeZone Library#}
{#        {% get_current_timezone as TIME_ZONE %} {# it will Load the Current Time Zone List#}

				<section role="main" class="content-body">
					<header class="page-header">
                       <h2><i class="fa fa-ticket" aria-hidden="true"></i> Ticket</h2>

						<div class="right-wrapper pull-right">
							<ol class="breadcrumbs">
								<li>
									<a href="{% url 'home' %}">
										<i class="fa fa-home"></i>
									</a>
								</li>
								<li><span>Tickets</span></li>
								<li><span>Submit Ticket</span></li>
							</ol>

							<a class="sidebar-right-toggle" data-open="sidebar-right"><i class="fa fa-chevron-left"></i></a>
						</div>
					</header>

					<!-- start: page -->
                         <div class="row">
                            <div class="col-md-12">
                                {% for message in messages %}
                                    <div class="alert {% if 'success' in message.tags %} alert-success {% else %} alert-danger{% endif %} alert-dismissible" role="alert">
                                          <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                        {{ message }}
                                    </div>
                                {% endfor %}
                                <form id="summary-form" class="ticketForm form-horizontal" action="{% url 'saveTicket' %}" method="post">
                                    {% csrf_token %}
                                    <section class="panel">
                                        <header class="panel-heading">
{#                                            <div class="panel-actions">#}
{#                                                <a href="#" class="fa fa-caret-down"></a>#}
{#                                                <a href="#" class="fa fa-times"></a>#}
{#                                            </div>#}

                                            <h2 class="panel-title">Submit Ticket</h2>
                                        </header>
                                        <footer class="panel-footer">
                                            <div class="row">
                                                <div class="col-sm-9">
                                                    <button class="btn btn-primary saveButton">Submit Ticket</button>
                                                    <button type="reset" class="btn btn-default">Reset</button>
                                                </div>
                                            </div>
                                        </footer>
                                        <div class="panel-body">
                                            <div class="validation-message">
                                                <ul></ul>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-md-3 col-sm-3 control-label">Submit Date:</label>
                                                <div class="col-sm-3 col-md-3">
                                                    <div class="input-group date" id="datePicker">
                                                        <input type="text" name="submit_date" id="submit_date" data-plugin-datepicker class="form-control data-datepicker" />
                                                        <span class="input-group-addon">
                                                            <i class="fa fa-calendar"></i>
                                                        </span>
                                                    </div>
                                                    <small class="text-info text-bold">mm-dd-yyyy</small>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-md-3 control-label">Time:</label>
                                                <div class="col-sm-3 col-md-3">
                                                    <div class="input-group">
                                                        <span class="input-group-addon">
                                                            <i class="fa fa-clock-o"></i>
                                                        </span>
                                                        <input type="text" data-plugin-timepicker name="submit_time" id="submit_time" class="form-control">
                                                    </div>
                                                </div>
                                            </div>
                                            {% if user.user_type == '0' %}
                                            <span class="col-md-offset-3" id="orgValidate"></span>
                                            <div class="form-group">
                                                <label class="col-md-3 col-sm-3 control-label"><span class="required">*</span>Organization: </label>
                                                <div class="col-md-4 col-sm-4">
                                                    <select name="org_id" id="org_id" required="required" title="Please Select Organization" data-plugin-selectTwo class="form-control populate placeholder" data-plugin-options='{ "placeholder": "Select an Client", "allowClear": true }'>
                                                        <option value="" readonly="readonly" >Select Organization </option>
                                                        {% if organizations %}
                                                            {% for org in organizations %}
                                                                <option value="{{ org.org_id }}">{{ org.org_name }}</option>
                                                            {% endfor %}
                                                        {% endif %}
                                                    </select>
                                                </div>
                                                <div class="col-md-4 col-sm-4">
                                                    <span><a class="text-primary" href="#modalOrgDetail" onclick="ValidateOrgDetailID(event)">details</a> | <a class="text-primary" href="#modalOrgHistory" onclick="ValidateOrgHistory(event)">history</a></span>
                                                </div>
                                            </div>
                                            {% else %}
                                                <input type="hidden" id="org_id" name="org_id" value="{{ user.user_org_id }}">
                                            {% endif %}
                                            <div id="popup-modal-content"></div>
                                            <span class="col-md-offset-3" id="callerValidate"></span>
                                            <div class="form-group">
                                                <label class="col-md-3 col-sm-3 control-label">Caller:</label>
                                                <div class="col-md-4 col-sm-4">
                                                    <select name="caller_id" id="caller_id" data-plugin-selectTwo class="form-control populate placeholder" data-plugin-options='{ "placeholder": "Select Caller", "allowClear": true }'>
                                                        <option value=""> </option>
                                                        {% if users %}
                                                            {% for user in users %}
                                                                <option value="{{ user.id }}">{{ user.first_name }}{{ user.last_name }}</option>
                                                            {% endfor %}
                                                        {% endif %}
                                                    </select>
                                                </div>
                                                <div class="col-md-4 col-sm-4">
                                                    <span><a class="text-primary" href="#modalCallerDetail" onclick="ValidateCallerDetailID(event)">details</a> | <a class="text-primary" href="#modalCallerHistory" onclick="ValidateCallerHistory(event)">history</a></span>
                                                </div>
                                            </div>
                                            <span class="col-md-offset-3" id="clientValidate"></span>
                                            <div class="form-group">
                                                <label class="col-md-3 col-sm-3 control-label"><span class="required">*</span>Client: </label>
                                                <div class="col-md-4 col-sm-4">
                                                    <select name="client_id" id="client_id" required="required" title="Please Select Client" data-plugin-selectTwo class="form-control populate placeholder client_id" data-plugin-options='{ "placeholder": "Select an Client", "allowClear": true }'>
                                                        <option value="" readonly="readonly" >Select Client </option>
                                                        {% if clients %}
                                                            {% for client in clients %}
                                                                <option value="{{ client.client_id }}">{{ client.client_name }}</option>
                                                            {% endfor %}
                                                        {% endif %}
                                                    </select>
                                                </div>
                                                <div class="col-md-4 col-sm-4">
                                                    <span><a class="text-primary" href="#modalClientDetail" onclick="ValidateClientDetailID(event)">details</a> | <a class="text-primary" href="#modalClientHistory" onclick="ValidateClientHistory(event)">history</a></span>
                                                </div>
                                            </div>
                                            <div id="results"></div>
                                            <div class="form-group">
                                                <label class="col-md-3 col-sm-3 control-label">Client Information:</label>
                                                <div class="col-md-4 col-sm-4">
                                                    <select name="clientinfo_id" id="clientinfo_id" data-plugin-selectTwo class="form-control populate placeholder" data-plugin-options='{ "placeholder": "Select an Client Information", "allowClear": true }'>
                                                        <option value=""> </option>
                                                        {% if clientinformations %}
                                                            {% for clientinfo in clientinformations %}
                                                                <option value="{{ clientinfo.clientinfo_id }}">{{ clientinfo.record_locator }}</option>
                                                            {% endfor %}
                                                        {% endif %}
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-md-3 col-sm-3 control-label"></label>
                                                <div class="col-md-8 col-sm-8">
                                                	<div class="bg-info" style="padding: 20px 20px">
	                                                    <div class="form-group">
	                                                        <label class="col-sm-2">Record Locator: </label>
	                                                        <div class="col-sm-4">
	                                                            <input type="text" name="record_locator" id="record_locator" class="form-control" title="Please Enter Record Locator." placeholder="eg.: ABC" />
	                                                        </div>
	                                                        <label class="col-sm-2">Caller Name: </label>
	                                                        <div class="col-sm-4">
	                                                            <input type="text" name="caller_name" id="caller_name" class="form-control" title="Please Enter Caller Name." placeholder="eg.: XYZ" />
	                                                        </div>
	                                                    </div>
	                                                    <div class="form-group">
	                                                        <label class="col-sm-2">Caller Phone: </label>
	                                                        <div class="col-sm-4">
	                                                            <input name="caller_phone" id="caller_phone" data-plugin-masked-input data-input-mask="(999) 999-9999" placeholder="(123) 123-1234" class="form-control">
	                                                        </div>
	                                                        <label class="col-sm-2">Caller Email: </label>
	                                                        <div class="col-sm-4">
	                                                            <input type="email" name="caller_email" id="caller_email" class="form-control" title="Please Enter a valid email address." placeholder="eg.: example@xyz.com" />
	                                                        </div>
	                                                    </div>
	                                                    <div class="form-group">
	                                                        <label class="col-sm-2">Passenger Name: </label>
	                                                        <div class="col-sm-4">
	                                                            <input type="text" name="passenger_name" id="passenger_name" class="form-control" title="Please Enter Passenger Name." placeholder="eg.: ABC" />
	                                                        </div>
	                                                    </div>
	                                                </div>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-sm-3 control-label"><span class="required">*</span>Subject: </label>
                                                <div class="col-sm-6">
                                                    <input type="text" name="subject" id="subject" class="form-control" title="Please Enter Subject." placeholder="eg.: ABC" required/>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-md-3 control-label"><span class="required">*</span>Full Description</label>
                                                <div class="col-md-9">
                                                    <textarea class="summernote" id="description" name="description" required="required" data-plugin-summernote data-plugin-options='{ "height": 180, "codemirror": { "theme": "ambiance" } }'></textarea>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-md-3 col-sm-3 control-label"><span class="required">*</span>Ticket Type: </label>
                                                <div class="col-md-4 col-sm-4">
                                                    <select name="ticket_type" id="ticket_type_parent" title="Please Select Ticket Type" required="required" data-plugin-selectTwo class="form-control populate ticket_type placeholder" data-plugin-options='{ "placeholder": "Select Ticket Type", "allowClear": true }'>
                                                        <option value="" readonly="readonly" >Select Ticket Type </option>
                                                        {% if ticketTypes %}
                                                            {% for ttype in ticketTypes %}
                                                                <option value="{{ ttype.ttype_id }}">{{ ttype.ttype_name }}</option>
                                                            {% endfor %}
                                                        {% endif %}
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-md-3 col-sm-3 control-label">Subtype 1:</label>
                                                <div class="col-md-4 col-sm-4">
                                                    <select name="subtype1" id="subtype1" data-plugin-selectTwo class="form-control populate ticket_type ticket_type_parent placeholder" data-plugin-options='{ "placeholder": "Select an SubType1", "allowClear": true }'>
                                                        <option value=""> </option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-md-3 col-sm-3 control-label">Subtype 2:</label>
                                                <div class="col-md-4 col-sm-4">
                                                    <select name="subtype2" id="subtype2" data-plugin-selectTwo class="form-control populate ticket_type subtype1 placeholder" data-plugin-options='{ "placeholder": "Select an Subtype2", "allowClear": true }'>
                                                        <option value=""> </option>

                                                    </select>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-md-3 col-sm-3 control-label">Subtype 3:</label>
                                                <div class="col-md-4 col-sm-4">
                                                    <select name="subtype3" id="subtype3" data-plugin-selectTwo class="form-control populate ticket_type subtype2 placeholder" data-plugin-options='{ "placeholder": "Select an Subtype3", "allowClear": true }'>
                                                        <option value=""> </option>

                                                    </select>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-md-3 col-sm-3 control-label">Subtype 4:</label>
                                                <div class="col-md-4 col-sm-4">
                                                    <select name="subtype4" id="subtype4" data-plugin-selectTwo class="form-control populate ticket_type subtype3 placeholder" data-plugin-options='{ "placeholder": "Select an Subtype4", "allowClear": true }'>
                                                        <option value=""> </option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-md-3 col-sm-3 control-label"><span class="required">*</span>Priority: </label>
                                                <div class="col-md-4 col-sm-4">
                                                    <select name="priority" id="priority" required="required" title="Please Select Priority" data-plugin-selectTwo class="form-control populate placeholder" data-plugin-options='{ "placeholder": "Select an Client", "allowClear": true }'>
                                                        <option value="" readonly="readonly" >Select Priority</option>
                                                        {% if priorities %}
                                                            {% for priority in priorities %}
                                                                <option value="{{ priority.priority_id }}">{{ priority.priority_name }}</option>
                                                            {% endfor %}
                                                        {% endif %}
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-md-3 col-sm-3 control-label">Ticket Status:</label>
                                                <div class="col-md-2 col-sm-2">
                                                    <select name="ticket_status" id="ticket_status" class="form-control populate placeholder" disabled>
                                                        <option value="1" readonly="readonly" selected>Open</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-4 col-sm-4">
                                                    <select name="ticket_substatus" id="ticket_substatus" data-plugin-selectTwo class="form-control populate placeholder" data-plugin-options='{ "placeholder": "Select an Client", "allowClear": true }'>
                                                        <option value=""> </option>
                                                        {% if substatus %}
                                                            {% for sstatus in substatus %}
                                                                <option value="{{ sstatus.sub_status_id }}">{{ sstatus.sub_status_text }}</option>
                                                            {% endfor %}
                                                        {% endif %}
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-md-3 col-sm-3 control-label">Is Traveler a VIP?: </label>
                                                <div class="col-md-4 col-sm-4">
                                                    <select class="form-control" name="traveler_vip" id="traveler_vip">
                                                        <option value=""></option>
                                                        <option value="0">Yes</option>
                                                        <option value="1">No</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-md-3 col-sm-3 control-label">Payout Required?: </label>
                                                <div class="col-md-4 col-sm-4">
                                                    <select class="form-control" name="payout_required" id="payout_required">
                                                        <option value=""></option>
                                                        <option value="0">Yes</option>
                                                        <option value="1">No</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-md-3 col-sm-3 control-label">Agent Error or Goodwill: </label>
                                                <div class="col-md-4 col-sm-4">
                                                    <select class="form-control" name="error_goodwill" id="error_goodwill">
                                                        <option value=""></option>
                                                        <option value="0">Agent Error</option>
                                                        <option value="1">Goodwill</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-sm-3 control-label">Amount Saved: </label>
                                                <div class="col-sm-4">
                                                    <input type="text" name="amount_saved" id="amount_saved" class="form-control" title="Please Enter Amount." placeholder="eg.: 123" />
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-sm-3 control-label">Airline Ticket #: </label>
                                                <div class="col-sm-4">
                                                    <input type="text" name="airline_ticket" id="airline_ticket" class="form-control" title="Please Enter Airline #." placeholder="eg.: A111" />
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-sm-3 control-label">Agent Responsible (if applic): </label>
                                                <div class="col-sm-4">
                                                    <input type="text" name="agent_responsible" id="agent_responsible" class="form-control" title="Please Enter Agent Responsible." placeholder="eg.: ABC" />
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-sm-3 control-label">Vendor Name Resp (if applic): </label>
                                                <div class="col-sm-4">
                                                    <input type="text" name="vendor_responsible" id="vendor_responsible" class="form-control" title="Please Enter Vendor Resp." placeholder="eg.: XYZ" />
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-sm-3 control-label">Resp Vendor's City (if applic): </label>
                                                <div class="col-sm-4">
                                                    <input type="text" name="vresponsible_city" id="vresponsible_city" class="form-control" title="Please Enter Vendor City." placeholder="" />
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-sm-3 control-label">Amount of Payout: </label>
                                                <div class="col-sm-4">
                                                    <input type="text" name="ticket_payout_amount" id="ticket_payout_amount" class="form-control" title="Please Enter Payout Amount." placeholder="" />
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-sm-3 control-label">Pay to the order of: </label>
                                                <div class="col-sm-4">
                                                    <input type="text" name="ticket_order_of_pay" id="ticket_order_of_pay" class="form-control" title="Please Enter Pay of Order." placeholder="" />
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-sm-3 control-label">Attention: </label>
                                                <div class="col-sm-4">
                                                    <input type="text" name="ticket_attention" id="ticket_attention" class="form-control" title="Please Enter Attention." placeholder="" />
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-sm-3 control-label">Company: </label>
                                                <div class="col-sm-4">
                                                    <input type="text" name="ticket_company" id="ticket_company" class="form-control" title="Please Enter Company." placeholder="" />
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-sm-3 control-label">Address: </label>
                                                <div class="col-sm-4">
                                                    <input type="text" name="ticket_address" id="ticket_address" class="form-control" title="Please Enter Address." placeholder="" />
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-sm-3 control-label">Notes to print on check: </label>
                                                <div class="col-sm-4">
                                                    <input type="text" name="notes_on_check" id="notes_on_check" class="form-control" title="Please Enter Notes to print on check." placeholder="" />
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-sm-3 control-label">Check Number: </label>
                                                <div class="col-sm-4">
                                                    <input type="text" name="check_number" id="check_number" class="form-control" title="Please Enter Check #." placeholder="" />
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-sm-3 control-label">Who Approved?: </label>
                                                <div class="col-sm-4">
                                                    <input type="text" name="check_approved_by" id="check_approved_by" class="form-control" title="Please Enter Who Approved?" placeholder="" />
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-sm-3 control-label"><span class="required">*</span>Correction / Containment Actions: </label>
                                                <div class="col-sm-4">
                                                    <input type="text" name="corr_cont_actions" id="corr_cont_actions" class="form-control" title="Please Enter Correction/Containment Actions." placeholder="" required/>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-sm-3 control-label"><span class="required">*</span> Root Cause: </label>
                                                <div class="col-md-6">
                                                    <textarea class="form-control" rows="3" name="ticket_root_cause" id="ticket_root_cause" title="Please Enter Root Cause" required="required" data-plugin-maxlength maxlength="7800"></textarea>
                                                    <p>
                                                        <code>max-length</code> set to 7800 characters.
                                                    </p>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-sm-3 control-label"><span class="required">*</span> Corrective Action: </label>
                                                <div class="col-md-6">
                                                    <textarea class="form-control" rows="3" name="corrective_action" id="corrective_action" title="Please Corrective Actions" required="required" data-plugin-maxlength maxlength="7800"></textarea>
                                                    <p>
                                                        <code>max-length</code> set to 7800 characters.
                                                    </p>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-md-3 col-sm-3 control-label">Assigned To:</label>
                                                <div class="col-md-4 col-sm-4">
                                                    <select name="assign_to" id="assign_to" data-plugin-selectTwo class="form-control populate placeholder" data-plugin-options='{ "placeholder": "Select an Client", "allowClear": true }'>
                                                        <option value="" > </option>
                                                    </select>
                                                </div>
                                                <div class="col-md-4 col-sm-4">
                                                    <p class="text-info text-bold">(assignment based on Org)</p>
                                                </div>

                                            </div>
                                            <div class="form-group">
                                                <label class="col-md-3 col-sm-3 control-label">Next Action:</label>
                                                <div class="col-md-4 col-sm-4">
                                                    <select name="next_action" id="next_action" data-plugin-selectTwo class="form-control populate placeholder" data-plugin-options='{ "placeholder": "Select an Client", "allowClear": true }'>
                                                        <option value="" > </option>
                                                        {% if users %}
                                                            {% for user in users %}
                                                                <option value="{{ user.id }}">{{ user.first_name }}{{ user.last_name }}</option>
                                                            {% endfor %}
                                                        {% endif %}
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-md-3 control-label">New Note:</label>
                                                <div class="col-md-9">
                                                    <textarea class="summernote" id="ticket_note" name="ticket_note" required="required" data-plugin-summernote data-plugin-options='{ "height": 180, "codemirror": { "theme": "ambiance" } }'></textarea>
                                                </div>
                                                <div class="col-sm-6 col-md-offset-3">
                                                     <div class="checkbox">
                                                         <label>
                                                            <input type="checkbox" name="is_private" value="1">
                                                             <strong>Private Note </strong>
                                                         </label>
                                                     </div>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="col-md-3 control-label">Labour Hours:</label>
                                                <div class="col-md-2 col-sm-2">
                                                    <div class="input-group">
                                                        <span class="input-group-addon">
                                                            <i class="fa fa-clock-o"></i>
                                                        </span>
                                                        <input type="text" name="labour_hours" id="labour_hours" value="00" data-plugin-timepicker class="form-control" data-plugin-options='{ "showMeridian": false }'>
                                                    </div>
                                                    <small class="text-info text-bold">hrs:mins</small>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                 <label class="col-sm-3 control-label" for="inputSuccess"></label>
                                                 <div class="col-sm-6">
                                                     <div class="checkbox">
                                                         <label>
                                                            <input type="checkbox" name="is_active" {% if data.taskgroup_is_active == True %}checked{% endif %} />
                                                               <i>Active</i>
                                                         </label>
                                                     </div>
                                                </div>
                                              </div>
                                            <div class="form-group">
                                                <label class="col-sm-3 control-label">
                                                <a class="mb-xs mt-xs mr-xs modal-sizes btn btn-primary" href="#modalLG">Task Manager</a>
                                                <!-- <a class="mb-xs mt-xs mr-xs modal-sizes btn btn-primary" href="#modalLGGroup">Task Manager Group</a> -->
                                                </label>

                                                <!-- Modal Form For Task Manager Start-->
                                                <div id="modalLG" class="modal-block modal-block-lg mfp-hide">
                                                    <section class="panel">
                                                        <header class="panel-heading">
                                                            <h2 class="panel-title">Task Manager</h2>
                                                        </header>
                                                        <div class="panel-body">
                                                        	<form>&nbsp;</form>
                                                        	  <form id="modalForm" action="{% url 'updateTaskGroup' %}" method="post" class="form-horizontal">
                                                                <div class="table-responsive">
                                                                  <table class="table table-bordered table-task-modal">
                                                                    <thead>
                                                                        <tr>
                                                                            <th></th>
                                                                            <th>Task</th>
                                                                            <th>Assigned To</th>
                                                                            <th>Due Date</th>
                                                                            <th>Depend Order</th>
                                                                            <th>Type</th>
                                                                            <th>Completed Date</th>
                                                                        </tr>
                                                                    </thead>
                                                                    <tbody>

                                                                    </tbody>


                                                                </table>
                                                                </div>
                                                                <div class="modal-buton">
{#                                                                    <input type="button" class="btn btn-primary clear-btn" value="Save" name="btnDone" id="btnDone">#}
                                                                    <input type="button" class="btn btn-primary clear-btn" value="Reset" name="btnReset" id="btnReset">
                                                                    <input type="button" class="btn btn-primary clear-btn" value="New Task" name="btnAdd" id="BtnNewTask">
                                                                    <input type="button" class="btn btn-primary clear-btn" value="Add Task Group" id="btnAddTaskGroup">
                                                                    <input type="button" class="btn btn-primary show-btn" value="Cancel" id="cancelbtn">
                                                                    <input type="button" class="btn btn-primary show-btn" value="Accept" id="accept-btn">
                                                                    <input type="button" class="btn btn-primary show-btn task-group" value="Add Task Group" id="accept-btn">
                                                                </div>
                                                                <div class="addNewTask space-top-custom">
                                                			   		<div class="form-group">
                                                			   			<label class="col-sm-3 control-label">Task Order:</label>
                                                			   			<div class="col-sm-2">
                                                			   				<input type="text" class="form-control input-sm"  name="modal_task_order" id="modal_task_order">
                                                			   			</div>
                                                			   		</div>
                                                			   		<div class="form-group">
                                                                        <label class="col-sm-3 control-label"><span class="required">*</span> Task:</label>
                                                			   			<div class="col-md-4 col-sm-4">
	                                                			   			<select class="form-control" name="modal_task_id" id="modal_task_id">
	                                        			   			            <option selected=""></option>
                                                                                {% for task in tasks %}
                                                                                  <option value="{{ task.task_id }}">{{ task.task_description }}</option>
	                                        			   						  {% endfor %}
	                                                			   			</select>
	                                                			   		</div>
                                                			   		</div>
                                                			   		<div class="form-group">
                                                                        <label class="col-sm-3 control-label"><span class="required">*</span> Task Type:</label>
                                                			   			<div class="col-md-4 col-sm-4">
	                                                			   			<input type="radio" name="modal_task_type" class="modal_task_type" id="modal_task_type1" value="0" checked>
	                                                			   			<label for="complete">Complete</label>&nbsp;
	                                                			   			<input type="radio" name="modal_task_type" class="modal_task_type" id="modal_task_type2" value="1">
                                                                          <label for="Ye/NO">Yes/No/NA</label>
	                                                			   		</div>
                                                			   		</div>
                                                                    <div class="incomplete_ticket_type">
                                                                        <div class="form-group">
                                                                        <label class="col-sm-3 control-label">If Response:</label>
                                                			   			<div class="col-md-6 col-sm-6">
                                                                            <div class="row">
                                                                                <small class="col-sm-5">Add Task Group=</small>
                                                                                <small class="col-sm-2 col-xs-offset-1">Cancel All Open Tasks</small>
                                                                                <small class="col-sm-1">Close Ticket</small>
                                                                                <small class="col-sm-3">Update Substatus to =</small>
                                                                            </div>
	                                                			   		</div>
                                                			   		</div>
                                                                        <div class="form-group">
                                                                            <label class="col-sm-3 control-label">=Yes</label>
                                                                            <div class="col-md-8 col-sm-8">
                                                                                <div class="row">
                                                                                    <div class="col-sm-5">
                                                                                        <select name="modal_task_type_group_id1" id="modal_task_type_group_id1" data-plugin-selectTwo required class="form-control populate placeholder modal_task_type_group_id" data-plugin-options='{ "placeholder": "Select an Task Group", "allowClear": true }'>
                                                                                            <option selected=""> </option>
                                                                                            {% if taskGroups %}
                                                                                                {% for taskGroup in taskGroups %}
                                                                                                    <option value="{{ taskGroup.taskgroup_id }}" >{{ taskGroup.taskgroup_description }}</option>
                                                                                                {% endfor %}
                                                                                            {% endif %}
                                                                                        </select>
                                                                                    </div>
                                                                                    <label class="col-sm-1">
                                                                                        <input type="checkbox" name="modal_cancel_open_task1" id="modal_cancel_open_task1" class="modal_cancel_open_task" value="1">
                                                                                     </label>
                                                                                    <label class="col-sm-1">
                                                                                        <input type="checkbox" name="modal_task_type_close_ticket1" id="modal_task_type_close_ticket1" class="modal_task_type_close_ticket" data-id="1" value="1">
                                                                                     </label>
                                                                                    <div class="col-sm-4">
                                                                                        <select name="modal_task_type_substatus_id1" id="modal_task_type_substatus_id1" data-plugin-selectTwo class="form-control populate placeholder modal_task_type_substatus_id" data-plugin-options='{ "placeholder": "Select an Sub Status", "allowClear": true }'>
                                                                                            <option value=""> </option>
                                                                                            {% if substatus %}
                                                                                                {% for sstatus in substatus %}
                                                                                                    <option value="{{ sstatus.sub_status_id }}">{{ sstatus.sub_status_text }}</option>
                                                                                                {% endfor %}
                                                                                            {% endif %}
                                                                                        </select>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <div class="form-group">
                                                                            <label class="col-sm-3 control-label">=No</label>
                                                                            <div class="col-md-8 col-sm-8">
                                                                                <div class="row">
                                                                                    <div class="col-sm-5">
                                                                                        <select name="modal_task_type_group_id2" id="modal_task_type_group_id2" data-plugin-selectTwo required class="form-control populate placeholder modal_task_type_group_id" data-plugin-options='{ "placeholder": "Select an Task Group", "allowClear": true }'>
                                                                                            <option selected=""> </option>
                                                                                            {% if taskGroups %}
                                                                                                {% for taskGroup in taskGroups %}
                                                                                                    <option value="{{ taskGroup.taskgroup_id }}" >{{ taskGroup.taskgroup_description }}</option>
                                                                                                {% endfor %}
                                                                                            {% endif %}
                                                                                        </select>
                                                                                    </div>
                                                                                    <label class="col-sm-1">
                                                                                        <input type="checkbox" name="modal_cancel_open_task2" id="modal_cancel_open_task1" class="modal_cancel_open_task" value="1">
                                                                                     </label>
                                                                                    <label class="col-sm-1">
                                                                                        <input type="checkbox" name="modal_task_type_close_ticket2" id="modal_task_type_close_ticket2" class="modal_task_type_close_ticket"  data-id="2" value="1">
                                                                                     </label>
                                                                                    <div class="col-sm-4">
                                                                                        <select name="modal_task_type_substatus_id2" id="modal_task_type_substatus_id2" data-plugin-selectTwo class="form-control populate placeholder modal_task_type_substatus_id" data-plugin-options='{ "placeholder": "Select an Sub Status", "allowClear": true }'>
                                                                                            <option value=""> </option>
                                                                                            {% if substatus %}
                                                                                                {% for sstatus in substatus %}
                                                                                                    <option value="{{ sstatus.sub_status_id }}">{{ sstatus.sub_status_text }}</option>
                                                                                                {% endfor %}
                                                                                            {% endif %}
                                                                                        </select>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <div class="form-group">
                                                                            <label class="col-sm-3 control-label">=N/A</label>
                                                                            <div class="col-md-8 col-sm-8">
                                                                                <div class="row">
                                                                                    <div class="col-sm-5">
                                                                                        <select name="modal_task_type_group_id3" id="modal_task_type_group_id3" data-plugin-selectTwo required class="form-control populate placeholder modal_task_type_group_id" data-plugin-options='{ "placeholder": "Select an Task Group", "allowClear": true }'>
                                                                                            <option selected=""> </option>
                                                                                            {% if taskGroups %}
                                                                                                {% for taskGroup in taskGroups %}
                                                                                                    <option value="{{ taskGroup.taskgroup_id }}" >{{ taskGroup.taskgroup_description }}</option>
                                                                                                {% endfor %}
                                                                                            {% endif %}
                                                                                        </select>
                                                                                    </div>
                                                                                    <label class="col-sm-1">
                                                                                        <input type="checkbox" name="modal_cancel_open_task3" id="modal_cancel_open_task3" class="modal_cancel_open_task" value="1">
                                                                                     </label>
                                                                                    <label class="col-sm-1">
                                                                                        <input type="checkbox" name="modal_task_type_close_ticket3" id="modal_task_type_close_ticket3" class="modal_task_type_close_ticket"  data-id="3" value="1">
                                                                                     </label>
                                                                                    <div class="col-sm-4">
                                                                                        <select name="modal_task_type_substatus_id3" id="modal_task_type_substatus_id3" data-plugin-selectTwo class="form-control populate placeholder modal_task_type_substatus_id" data-plugin-options='{ "placeholder": "Select an Sub Status", "allowClear": true }'>
                                                                                            <option value=""> </option>
                                                                                            {% if substatus %}
                                                                                                {% for sstatus in substatus %}
                                                                                                    <option value="{{ sstatus.sub_status_id }}">{{ sstatus.sub_status_text }}</option>
                                                                                                {% endfor %}
                                                                                            {% endif %}
                                                                                        </select>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    <br>
                                                                    <div class="form-group">
                                                			   			<label class="col-sm-3 control-label">Note:</label>
                                                			   			<div class="col-sm-9">
                                                			   				<textarea class="form-control" name="modal_task_note" id="modal_task_note" rows="9" cols="68"></textarea>
                                                			   			</div>
                                                			   		</div>
                                                			   		<div class="form-group">
                                                			   			<label class="col-sm-3 control-label">Due Date:</label>
                                                			   			<div class="col-md-4 col-sm-4">
	                                                			   			<div class="input-group">
	                                                                            <span class="input-group-addon">
	                                                                                <i class="fa fa-calendar"></i>
	                                                                            </span>
	                                                                            <input type="text" id="modal_due_date" name="modal_due_date" data-plugin-datepicker class="form-control datepicker" />
	                                                                        </div>
	                                                                    </div>
                                                			   		</div>
                                                			   		<div class="form-group">
                                                			   		    <label class="col-sm-3 control-label">Dependency: </label>
                                                			   		    <div class="col-md-4 col-sm-4">
                                                			   		        <div class="radio-primary form-check col-sm-4">
                                                			   		            <label for="task_type" class="form-check-label">
                                                			   		                <input class="form-check-input radio-inline modal_dependency" type="radio" id="modal_dependency1" name="modal_dependency" value="0" checked>
                                                			   		                None</label>
                                                			   		            <label for="task_type" class="form-check-label">
                                                			   		                <input class="form-check-input radio-inline modal_dependency" type="radio" id="modal_dependency2" name="modal_dependency" value="1">
                                                			   		                Order</label>
                                                			   		        </div>
                                                                            <div class="col-sm-4">
                                                                                <input type="text" name="modal_dependency_order" id="modal_dependency_order" class="form-control input-inline" title="Please Enter Dependency Order." placeholder="eg.: 1" />
                                                                            </div>
                                                			   		    </div>
                                                			   		</div>
                                                			   		<div class="form-group">
                                                			   		    <label class="col-md-3 col-sm-3 control-label">Assigned To </label>
                                                			   		    <div class="col-md-4 col-sm-4">
                                                			   		        <select name="modal_task_assign_to" id="modal_task_assign_to" data-plugin-selectTwo required class="form-control populate placeholder" data-plugin-options='{ "placeholder": "Select an Task", "allowClear": true }'>
                                                			   		            <option value="">-Unassigned-</option>
                                                			   		            {% if users %}
                                                			   		                {% for user in users %}
                                                			   		                    <option value="{{ user.id }}" >{{ user.first_name }}{{ user.last_name }}</option>
                                                			   		                {% endfor %}
                                                			   		            {% endif %}
                                                			   		        </select>
                                                			   		    </div>
                                                			   		</div>
                                                                    <div class="form-group">
                                                			   		    <label class="col-md-3 col-sm-3 control-label">Is Cancelled? </label>
                                                			   		    <div class="col-md-4 col-sm-4">
                                                                             <label>
                                                                                <input type="checkbox" name="modal_is_cancel" value="1">
                                                                             </label>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div class="addTaskGrpup space-top-custom">
	                                                                <div class="form-group">
	                                                                    <label class="col-md-3 col-sm-3 control-label"><span class="required">*</span>Task Group</label>
	                                                                    <div class="col-md-4 col-sm-4">
	                                                                        <select name="modal_taskgroup_id" id="modal_taskgroup_id" data-plugin-selectTwo required class="form-control populate placeholder" data-plugin-options='{ "placeholder": "Select an Task", "allowClear": true }'>
	                                                                            <option selected=""> </option>
	                                                                            {% if taskGroups %}
	                                                                                {% for taskGroup in taskGroups %}
	                                                                                    <option value="{{ taskGroup.taskgroup_id }}" >{{ taskGroup.taskgroup_description }}</option>
	                                                                                {% endfor %}
	                                                                            {% endif %}
	                                                                        </select>
	                                                                    </div>
	                                                                </div>
                                                                    <div class="form-group">
                                                			   			<label class="col-sm-3 control-label">Insert a Task Order:</label>
                                                			   			<div class="col-sm-2">
                                                			   				<input type="text" class="form-control input-sm"  name="modal_task_group_order" id="modal_task_group_order">
                                                			   			</div>
                                                			   		</div>
	                                                            </div>
                                                            </form>
                                                        </div>
                                                        <footer class="panel-footer">
                                                            <div class="row">
                                                                <div class="col-md-12 text-right">
                                                                    <button class="btn btn-primary modal-confirm">Save</button>
                                                                    <button class="btn btn-default modal-dismiss">Cancel</button>
                                                                </div>
                                                            </div>
                                                        </footer>
                                                    </section>
                                                </div>
{#                                                <!-- Modal Form For Task Manager End-->#}


                                                <div class="col-md-9">
                                                    <section class="panel">
                                                        <div class="panel-body">
{#                                                            <span class="required">Note: Task's Updation will be visible on Ticket Submission.</span>#}
                                                            <div class="table-responsive">
                                                                <table class="table table-condensed mb-none table-tasks">
                                                                    <thead>
                                                                        <tr>
                                                                            <th>#</th>
                                                                            <th>Task</th>
                                                                            <th>Assgined To</th>
                                                                            <th>Completed</th>
                                                                            <th>Time</th>
                                                                        </tr>
                                                                    </thead>
                                                                    <tbody>

                                                                    </tbody>
                                                                </table>
                                                            </div>
                                                        </div>
                                                    </section>
                                                </div>

                                            </div>
                                            <div class="form-group">
                                                <div class="col-sm-9 col-md-offset-3">
                                                     <div class="checkbox">
                                                         <label>
                                                            <input type="checkbox" name="include_attachs" value="1">
                                                             <strong>Include Attachment(s)? (upload screen will display on submit)</strong>
                                                         </label>
                                                     </div>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <div class="col-sm-9 col-md-offset-3">
                                                     <div class="checkbox">
                                                         <label>
                                                            <input type="checkbox" name="suppress_email_notify" value="1">
                                                             <strong>Suppress Email Notifications for this Ticket</strong>
                                                         </label>
                                                     </div>
                                                </div>
                                            </div>

                                        </div>
                                        <footer class="panel-footer">
                                            <div class="row">
                                                <div class="col-sm-9">
                                                    <button class="btn btn-primary saveButton">Submit Ticket</button>
                                                    <button type="reset" class="btn btn-default">Reset</button>
                                                </div>
                                            </div>
                                        </footer>
                                    </section>
                                </form>
                            </div>
                        </div>
					<!-- end: page -->
				</section>
			</div>

    {% endblock %}

    {% block script %}
        <script>

            var date = new Date();
            var today = new Date(date.getFullYear(), date.getMonth(), date.getDate());

            var optComponent = {
              format: 'mm-dd-yyyy',
              container: '#datePicker',
              orientation: 'auto top',
              todayHighlight: true,
              autoclose: true
            };

            $(function(){
                // COMPONENT
                $( '#datePicker' ).datepicker( optComponent );
                $( '#datePicker' ).datepicker( 'setDate', today );
                $('#ticket_note').code('');
                $('#description').code('');
              });

            function ValidateOrgDetailID(event){
                event.preventDefault()
                var org_id = $('#org_id').val();
                if(org_id == ''){
                    $('#orgValidate').html('<strong class="text-danger">No Organization Selected. Please Select One!</strong>');
                }else{
                    $('#orgValidate').html('');
                    $.ajax({
                        url:'/getModalOrgDetailById/',
                        type:'POST',
                        data:{
                            'org_id':org_id,
                            'csrfmiddlewaretoken': $('input[name=csrfmiddlewaretoken]').val(),
                        },
                        success:function(data){
                            $('#popup-modal-content').html(data);
                            $('#modalOrgDetail').modal("show");
                            {#cwindow.location = $(this).attr('href');#}
                        },
                        error:function(){
                            console.log('error')
                        },
                    });
                }
            }


            function ValidateOrgHistory(event){
                event.preventDefault()
                var org_id = $('#org_id').val();
                if(org_id == ''){
                    $('#orgValidate').html('<strong class="text-danger">No Organization Selected. Please Select One!</strong>');
                }else{
                    $('#orgValidate').html('');
                    $.ajax({
                        url:'/getModalOrgHistoryById/',
                        type:'POST',
                        data:{
                            'org_id':org_id,
                            'csrfmiddlewaretoken': $('input[name=csrfmiddlewaretoken]').val(),
                        },
                        success:function(data){
                            $('#popup-modal-content').html(data);
                            $('#modalOrgHistory').modal('show');
                            {#cwindow.location = $(this).attr('href');#}
                        },
                        error:function(){
                            console.log('error')
                        },
                    });
                }
            }


            function ValidateCallerDetailID(event){
                event.preventDefault()
                var caller_id = $('#caller_id').val();
                if(caller_id == ''){
                    $('#callerValidate').html('<strong class="text-danger">No Caller Selected. Please Select One!</strong>');
                }else{
                    $('#callerValidate').html('');
                    $.ajax({
                        url:'/getModalCallerDetailById/',
                        type:'POST',
                        data:{
                            'caller_id':caller_id,
                            'csrfmiddlewaretoken': $('input[name=csrfmiddlewaretoken]').val(),
                        },
                        success:function(data){
                            $('#popup-modal-content').html(data);
                            $('#modalCallerDetail').modal("show");
                            {#cwindow.location = $(this).attr('href');#}
                        },
                        error:function(){
                            console.log('error')
                        },
                    });
                }
            }


            function ValidateCallerHistory(event){
                event.preventDefault()
                var caller_id = $('#caller_id').val();
                if(caller_id == ''){
                    $('#callerValidate').html('<strong class="text-danger">No Caller Selected. Please Select One!</strong>');
                }else{
                    $('#callerValidate').html('');
                    $.ajax({
                        url:'/getModalCallerHistoryById/',
                        type:'POST',
                        data:{
                            'caller_id':caller_id,
                            'csrfmiddlewaretoken': $('input[name=csrfmiddlewaretoken]').val(),
                        },
                        success:function(data){
                            $('#popup-modal-content').html(data);
                            $('#modalCallerHistory').modal('show');
                            {#cwindow.location = $(this).attr('href');#}
                        },
                        error:function(){
                            console.log('error')
                        },
                    });
                }
            }


            function ValidateClientDetailID(event){
                event.preventDefault()
                var client_id = $('#client_id').val();
                if(client_id == ''){
                    $('#clientValidate').html('<strong class="text-danger">No Client Selected. Please Select One!</strong>');
                }else{
                    $('#clientValidate').html('');
                    $.ajax({
                        url:'/getModalClientDetailById/',
                        type:'POST',
                        data:{
                            'client_id':client_id,
                            'csrfmiddlewaretoken': $('input[name=csrfmiddlewaretoken]').val(),
                        },
                        success:function(data){
                            $('#popup-modal-content').html(data);
                            $('#modalClientDetail').modal("show");
                            {#cwindow.location = $(this).attr('href');#}
                        },
                        error:function(){
                            console.log('error')
                        },
                    });
                }
            }


            function ValidateClientHistory(event){
                event.preventDefault()
                var client_id = $('#client_id').val();
                if(client_id == ''){
                    $('#clientValidate').html('<strong class="text-danger">No Client Selected. Please Select One!</strong>');
                }else{
                    $('#clientValidate').html('');
                    $.ajax({
                        url:'/getModalClientHistoryById/',
                        type:'POST',
                        data:{
                            'client_id':client_id,
                            'csrfmiddlewaretoken': $('input[name=csrfmiddlewaretoken]').val(),
                        },
                        success:function(data){
                            $('#popup-modal-content').html(data);
                            $('#modalClientHistory').modal('show');
                            {#cwindow.location = $(this).attr('href');#}
                        },
                        error:function(){
                            console.log('error')
                        },
                    });
                }
            }

            $(document).on('change','#caller_id', function(){
              var caller_id = $(this).val();
              if (caller_id != ''){
                  $.ajax({
                    type: 'POST',
                    url: '/getClientId/',
                    data: {caller_id: caller_id},
                    dataType: 'json',
                    beforeSend: function(jqXHR, settings) {
                        //Do something before send...
                    },
                    success: function(data, textStatus, jqXHR) {
                        if(data.response){
                            // Set selected
                            $('#client_id').val(data.response);
                            $('#client_id').select2().trigger('change');
                        }
                    },
                    error: function(jqXHR, textStatus, errorThrown) {
                        alert(textStatus + '. ' + errorThrown);
                    }
                  });
              }
            });

            $(document).on('keyup','#sub_status_text', function(){
              var task_description = $(this).val();
              if (task_description != ''){
                  $.ajax({
                    type: 'POST',
                    url: '/validateTaskUnique/',
                    data: {task_description: task_description},
                    dataType: 'json',
                    beforeSend: function(jqXHR, settings) {
                        //Do something before send...
                    },
                    success: function(data, textStatus, jqXHR) {
                        if(data.response){
                            $('#TaskValid').html('<strong class="text-danger">Task already exist. Try another one!</strong>');
                            $('.saveButton').prop('disabled', true);
                        }else{
                            $('#TaskValid').html('');
                            $('.saveButton').prop('disabled', false);
                        }
                    },
                    error: function(jqXHR, textStatus, errorThrown) {
                        alert(textStatus + '. ' + errorThrown);
                    }
                  });
              }
            });

            $(document).on('change','#clientinfo_id', function(){
              var clientinfo = $(this).val();
              if (clientinfo != ''){
                  $.ajax({
                    type: 'POST',
                    url: '/getClientInformationById/',
                    data: {clientinfo: clientinfo},
                    dataType: 'json',
                    beforeSend: function(jqXHR, settings) {
                        //Do something before send...
                    },
                    success: function(data, textStatus, jqXHR) {
                        if(data.response){
                            result = jQuery.parseJSON(data['response'])
                            $.each(result, function(index) {
                                $('#record_locator').val(result[index].fields.record_locator)
                                $('#caller_name').val(result[index].fields.caller_name)
                                $('#caller_phone').val(result[index].fields.caller_phone)
                                $('#caller_email').val(result[index].fields.caller_email)
                                $('#passenger_name').val(result[index].fields.passenger_name)
                            });
                        }else{
                            {#$('#TaskValid').html('');#}
                        }
                    },
                    error: function(jqXHR, textStatus, errorThrown) {
                        alert(textStatus + '. ' + errorThrown);
                    }
                  });
              }

            });

            $(document).on('change','.ticket_type', function(){
              var tid = $(this).val();
              var ttype = $(this).attr('id');
              if (tid != ''){
                  $.ajax({
                    type: 'POST',
                    url: '/getTicketTypeChildById/',
                    data: {ttype_id: tid},
                    dataType: 'json',
                    beforeSend: function(jqXHR, settings) {
                        //Do something before send...
                    },
                    success: function(data, textStatus, jqXHR) {
                        if(data.response) {
                            result = jQuery.parseJSON(data['response'])
                            if(ttype == 'ticket_type_parent') {
                                $('#subtype1').html('<option value="" > </option>')
                                $('#subtype2').html('<option value="" > </option>')
                                $('#subtype3').html('<option value="" > </option>')
                                $('#subtype4').html('<option value="" > </option>')
                                $.each(result, function (index) {
                                    $('#subtype1').append('<option value="' + result[index].pk + '">' + result[index].fields.ttype_name + '</option>')
                                });
                            }else if(ttype == 'subtype1'){
                                $('#subtype2').html('<option value="" > </option>')
                                $('#subtype3').html('<option value="" > </option>')
                                $('#subtype4').html('<option value="" > </option>')
                                $.each(result, function (index) {
                                    $('#subtype2').append('<option value="' + result[index].pk + '">' + result[index].fields.ttype_name + '</option>')
                                });
                            }else if(ttype == 'subtype2'){
                                $('#subtype3').html('<option value="" > </option>')
                                $('#subtype4').html('<option value="" > </option>')
                                $.each(result, function (index) {
                                    $('#subtype3').append('<option value="' + result[index].pk + '">' + result[index].fields.ttype_name + '</option>')
                                });
                            }else if(ttype == 'subtype3'){
                                $('#subtype4').html('<option value="" > </option>')
                                $.each(result, function (index) {
                                    $('#subtype4').append('<option value="'+result[index].pk+'">'+result[index].fields.ttype_name+'</option>')
                                });
                            }
                        }
                    },
                    error: function(jqXHR, textStatus, errorThrown) {
                        alert(textStatus + '. ' + errorThrown);
                    }
                  });
              }

            });

            $(document).on('change','#org_id', function(){
              var org_id = $(this).val();
              if (org_id != ''){
                  $.ajax({
                    type: 'POST',
                    url: '/getUsersByOrgId/',
                    data: {org_id: org_id},
                    dataType: 'json',
                    beforeSend: function(jqXHR, settings) {
                        //Do something before send...
                    },
                    success: function(data, textStatus, jqXHR) {
                        if(data.response) {
                            result = jQuery.parseJSON(data['response'])
                            $('#assign_to').html('<option value=""> </option>');
                            $.each(result, function (index) {
                                $('#assign_to').append('<option value="' + result[index].pk + '">' + result[index].fields.first_name+' '+result[index].fields.last_name  + '</option>')
                            });
                        }
                    },
                    error: function(jqXHR, textStatus, errorThrown) {
                        alert(textStatus + '. ' + errorThrown);
                    }
                  });
              }

            });

            $('.ticketForm').on('submit', function(e) {
              if($('#description').summernote().code() == '') {
                alert('Description is empty, Please add some description!');
                // cancel submit
                e.preventDefault();
              }
             })

            $('#modal_due_date').datepicker({
                format: 'dd/mm/yyyy'
             });

            var row_counter=0;
            var row_edit=0;
            var task_order_start=1;var task_order_end=1;

            $("#BtnNewTask").click(function () {
                $('#accept-btn').val('Accept')
                $('.incomplete_ticket_type').hide()
                $('#modal_dependency_order').prop('readonly', true)
                $(this).parent('.modal-buton').addClass('custom-model-btn');
                if(task_order_end == 1){
                    $('#modal_task_order').prop('readonly', true)
                }else{
                    $('#modal_task_order').prop('readonly', false)
                }
                $('#modal_task_order').val(task_order_end)
                $('#modal_task_id').val('')
                $('#modal_task_type1').prop('checked',true)
                $('#modal_task_note').val('')
                $('#modal_due_date').val('')
                $('#modal_dependency1').prop('checked',true)
                $('#modal_dependency_order').val('')
                $('#modal_task_assign_to').select2("val", "");
                $(".addNewTask").toggle('slow');
            });
            $("#btnAddTaskGroup").click(function () {
                $('#accept-btn').val('Add Task Group')
                $(this).parent('.modal-buton').addClass('custom-model-btn');
                if(task_order_end == 1){
                    $('#modal_task_group_order').prop('readonly', true)
                }else{
                    $('#modal_task_group_order').prop('readonly', false)
                }
                $('#modal_task_group_order').val(task_order_end)
                $(".addTaskGrpup").toggle('slow');
            });
            $(document).on('click','#cancelbtn', function(e) {
                $(this).parent('.modal-buton').removeClass('custom-model-btn');
                $(".addNewTask").hide('slow');
                $(".addTaskGrpup").hide('slow');
            });

            $(document).on('change', '.modal_task_type', function(){
                task_type_val = $('input[name=modal_task_type]:checked').val();
                if(task_type_val == 0){
                    $('.incomplete_ticket_type').hide()
                }else{
                    $('.incomplete_ticket_type').show()
                }
            })

            $(document).on('change', '.modal_dependency', function(){
                task_dependency_val = $('input[name=modal_dependency]:checked').val();
                if(task_dependency_val == 0){
                    $('#modal_dependency_order').prop('readonly', true)
                    $('#modal_dependency_order').val('');
                }else{
                    $('#modal_dependency_order').prop('readonly', false)
                }
            })

            $(document).on('change', '.modal_task_type_close_ticket', function(){
                r_id = ($(this).attr('data-id'));
                if(this.checked) {
                    $('#modal_task_type_group_id'+r_id).prop('disabled', true);
                    $('#modal_task_type_group_id'+r_id).select2("val", "");
                }else{
                    $('#modal_task_type_group_id'+r_id).prop('disabled', false);
                }
            })

            $(document).on('click','#accept-btn', function(e) {
                $(this).parent('.table-bordered').addClass('append-data');
                if($(this).val() == 'Add Task Group'){
                    task_order_val = $('#modal_task_group_order').val();
                    taskgroup_id_val = $('#modal_taskgroup_id').val();
                    if(taskgroup_id_val == ''){
                        alert('Task Group Name cannot be Empty!');
                    }
                    else if(task_order_val > task_order_end){
                        alert('Task Order must be a valid whole number between '+task_order_start+' and '+task_order_end+'!');
                    }
                    else {
                        $(this).parent('.modal-buton').removeClass('custom-model-btn');
                        $.ajax({
                            type: 'POST',
                            url: '/getModalGroupTasksById/',
                            data: {group_id: taskgroup_id_val, 'csrfmiddlewaretoken': $('input[name=csrfmiddlewaretoken]').val()},
                            dataType: 'json',
                            beforeSend: function (jqXHR, settings) {
                                //Do something before send...
                            },
                            success: function (data, textStatus, jqXHR) {
                                if (data.response) {
                                    result = jQuery.parseJSON(data['response'])
                                    $.each(result, function (index) {
                                        {#task_order_val = result[index].fields.tmgrgp_display_order#}
                                        task_id_val = result[index].fields.tmgrgp_task;
                                        task_id_text_val = $("#modal_task_id option[value='"+result[index].fields.tmgrgp_task+"']").text();
                                        task_type_val = result[index].fields.tg_task_type;
                                        if(task_type_val == 0){
                                            task_type_text_val = 'Complete'
                                        }else{
                                            task_type_text_val = 'Yes/No/NA'
                                        }
                                        task_note_val = result[index].fields.tg_task_note;
                                        task_due_date_val = result[index].fields.tg_task_due_date;
                                        var dateAr = task_due_date_val.split('-');
                                        task_due_date_val = dateAr[2] + '/' + dateAr[1] + '/' + dateAr[0];
                                        task_dependency_val = result[index].fields.tg_task_dependency;
                                        if(task_dependency_val == false){
                                            task_dependency_text_val = 'None'
                                            task_dependency_val = 0
                                        }else{
                                            task_dependency_text_val = 'Order'
                                            task_dependency_val = 1
                                        }
                                        task_dependency_order_val = result[index].fields.tg_task_depend_order;
                                        task_assign_to_val = result[index].fields.tg_task_assigned_to;
                                        task_assign_to_text_val = $("#modal_task_assign_to option[value='"+result[index].fields.tg_task_assigned_to+"']").text()


                                        //Appened Row on the Panel as well on the Table
                                        row = '<tr>\n'
                                        row += '<td><a href="javascript:void(0);" class="edit_record" data-id="'+row_counter+'" >edit</a> | <a href="" class="delete_record" data-id="'+row_counter+'" >del</a></td>\n'
                                        row += '<input type="hidden" id="task-order'+row_counter+'" name="tmanager_task_order[]" value="'+task_order_val+'">'
                                        row += '<input type="hidden" id="task-id'+row_counter+'" name="tmanager_task_id[]" value="'+task_id_val+'">'
                                        row += '<td><input type="text" id="table-modal-task-id'+row_counter+'" name="table-modal-task-id[]" value="'+task_id_text_val+'" readonly class="form-control"></td>\n'
                                        row += '<input type="hidden" id="task-assign'+row_counter+'" name="tmanager_assign_to[]" value="'+task_assign_to_val+'">'
                                        row += '<td><input type="text" id="table-modal-task-assign-to'+row_counter+'" name="table-modal-task-assign-to[]" value="'+task_assign_to_text_val+'" readonly class="form-control"></td>\n'
                                        row += '<td><input type="text" id="task-due-date'+row_counter+'" name="tmanager_due_date[]" value="'+task_due_date_val+'" readonly class="form-control"></td>\n'
                                        row += '<td><input type="text" id="table-modal-task-dependency'+row_counter+'" name="table-modal-task-dependency[]" value="'+task_dependency_text_val+'" readonly class="form-control"></td>\n'
                                        row += '<input type="hidden" id="task-dependency'+row_counter+'" name="tmanager_task_dependency[]" value="'+task_dependency_val+'">'
                                        row += '<td><input type="text" id="table-modal-task-type'+row_counter+'" name="table-modal-task-type[]" value="'+task_type_text_val+'" readonly class="form-control"></td>\n'
                                        row += '<input type="hidden" id="task-type'+row_counter+'" name="tmanager_task_type[]" value="'+task_type_val+'">'
                                        row += '<td><input type="text" value="" readonly class="form-control"></td>\n'
                                        row += '<input type="hidden" id="task-note'+row_counter+'" name="tmanager_note[]" value="'+task_note_val+'">'
                                        row += '<input type="hidden" id="task-dependency-order'+row_counter+'" name="tmanager_dependency_order[]" value="'+task_dependency_order_val+'">'
                                        row += '</tr>'
                                        $('.table-task-modal tbody').append(row)


                                        //Appened Entry on the Submit Ticket Table along with the Task Manger Button

                                        row = '<tr id="tbl_row'+row_counter+'">\n'
                                        row += '<td>'+(row_counter+1)+'</td>\n'
                                        row += '<td><input type="text" id="table-task-id'+row_counter+'" value="'+task_id_text_val+'" readonly class="form-control"></td>\n'
                                        row += '<td><input type="text" id="table-task-assign-to'+row_counter+'" value="'+task_assign_to_text_val+'" readonly class="form-control"></td>\n'
                                        row += '<td><input type="text" id="table-task-type'+row_counter+'" value="'+task_type_text_val+'" readonly class="form-control"></td>\n'
                                        row += '<td><input type="text" value="00:00" readonly class="form-control"></td>\n'
                                        row += '</tr>'

                                        row_counter++;
                                        task_order_end++;
                                        $('.table-tasks tbody').append(row)

                                    });
                                    $(this).parent('.modal-buton').removeClass('custom-model-btn');
                                    $(".addNewTask").hide('slow');
                                    $(".addTaskGrpup").hide('slow');
                                } else {
                                    {#$('#TaskValid').html('');#}
                                }
                            },
                            error: function (jqXHR, textStatus, errorThrown) {
                                alert(textStatus + '. ' + errorThrown);
                            }
                        });
                    }
                }
                else{
                    task_order_val = $('#modal_task_order').val();
                    task_id_val = $('#modal_task_id').val();
                    task_id_text_val = $('#modal_task_id option:selected').text();
                    task_type_val = $('input[name=modal_task_type]:checked').val();
                    if(task_type_val == 0){
                        task_type_text_val = 'Complete'
                    }else{
                        task_type_text_val = 'Yes/No/NA'
                    }
                    task_note_val = $('#modal_task_note').val();
                    dateObject = $('#modal_due_date').val();
                    task_due_date_val = dateObject;

                    task_dependency_val = $('input[name=modal_dependency]:checked').val();
                    task_dependency_text_val = $('#modal_dependency_order').val();
                    if(task_dependency_val == true && $.isNumeric(task_dependency_text_val)){
                        task_dependency_order_val = task_dependency_text_val
                        task_dependency_val = 1
                    }else{
                        alert('Else')
                        task_dependency_order_val = 'None'
                        task_dependency_val = 0
                    }
                    task_assign_to_val = $('#modal_task_assign_to').val();
                    task_assign_to_text_val = $('#modal_task_assign_to option:selected').text();

                    if(task_id_val == ''){
                        alert('Task Name cannot be Empty!');
                    }
                    else if(task_order_val > task_order_end){
                        alert('Task Order must be a valid whole number between '+task_order_start+' and '+task_order_end+'!');
                    }
                    else {
                        $(this).parent('.modal-buton').removeClass('custom-model-btn');
                        if($(this).val() == 'Accept'){
                            row = '<tr>\n'
                            row += '<td><a href="javascript:void(0);" class="edit_record" data-id="'+row_counter+'" >edit</a> | <a href="" class="delete_record" data-id="'+row_counter+'" >del</a></td>\n'
                            row += '<input type="hidden" id="task-order'+row_counter+'" name="tmanager_task_order[]" value="'+task_order_val+'">'
                            row += '<input type="hidden" id="task-id'+row_counter+'" name="tmanager_task_id[]" value="'+task_id_val+'">'
                            row += '<td><input type="text" id="table-modal-task-id'+row_counter+'" name="table-modal-task-id[]" value="'+task_id_text_val+'" readonly class="form-control"></td>\n'
                            row += '<input type="hidden" id="task-assign'+row_counter+'" name="tmanager_assign_to[]" value="'+task_assign_to_val+'">'
                            row += '<td><input type="text" id="table-modal-task-assign-to'+row_counter+'" name="table-modal-task-assign-to[]" value="'+task_assign_to_text_val+'" readonly class="form-control"></td>\n'
                            row += '<td><input type="text" id="task-due-date'+row_counter+'" name="tmanager_due_date[]" value="'+task_due_date_val+'" readonly class="form-control"></td>\n'
                            row += '<td><input type="text" id="table-modal-task-dependency'+row_counter+'" name="table-modal-task-dependency[]" value="'+task_dependency_text_val+'" readonly class="form-control"></td>\n'
                            row += '<input type="hidden" id="task-dependency'+row_counter+'" name="tmanager_task_dependency[]" value="'+task_dependency_val+'">'
                            row += '<td><input type="text" id="table-modal-task-type'+row_counter+'" name="table-modal-task-type[]" value="'+task_type_text_val+'" readonly class="form-control"></td>\n'
                            row += '<input type="hidden" id="task-type'+row_counter+'" name="tmanager_task_type[]" value="'+task_type_val+'">'
                            row += '<td><input type="text" value="" readonly class="form-control"></td>\n'
                            row += '<input type="hidden" id="task-note'+row_counter+'" name="tmanager_note[]" value="'+task_note_val+'">'
                            row += '<input type="hidden" id="task-dependency-order'+row_counter+'" name="tmanager_dependency_order[]" value="'+task_dependency_order_val+'">'
                            row += '</tr>'
                            $('.table-task-modal tbody').append(row)
                            $(this).parent('.modal-buton').removeClass('custom-model-btn');
                            $(".addNewTask").hide('slow');
                            $(".addTaskGrpup").hide('slow');


                            //Appened Entry on the Submit Ticket Table along with the Task Manger Button

                            row = '<tr id="tbl_row'+row_counter+'">\n'
                            row += '<td>'+(row_counter+1)+'</td>\n'
                            row += '<td><input type="text" id="table-task-id'+row_counter+'" value="'+task_id_text_val+'" readonly class="form-control"></td>\n'
                            row += '<td><input type="text" id="table-task-assign-to'+row_counter+'" value="'+task_assign_to_text_val+'" readonly class="form-control"></td>\n'
                            row += '<td><input type="text" id="table-task-type'+row_counter+'" value="'+task_type_text_val+'" readonly class="form-control"></td>\n'
                            row += '<td><input type="text" value="00:00" readonly class="form-control"></td>\n'
                            row += '</tr>'

                            row_counter++;
                            task_order_end++;
                            $('.table-tasks tbody').append(row)

                        }
                        else if($(this).val() == 'Update'){
                            $("#task-order"+ row_edit + "").val(task_order_val);
                            $("#task-id"+ row_edit + "").val(task_id_val);
                            $("#task-type"+ row_edit + "").val(task_type_val);
                            $("#task-note"+ row_edit + "").val(task_note_val);
                            $("#task-due-date"+ row_edit + "").val(task_due_date_val);
                            $("#task-dependency"+ row_edit + "").val(task_dependency_val);
                            $("#task-dependency-order"+ row_edit + "").val(task_dependency_order_val);
                            $("#task-assign"+ row_edit + "").val(task_assign_to_val);
                            $("#table-modal-task-id"+ row_edit + "").val(task_id_text_val);
                            $("#table-modal-task-assign-to"+ row_edit + "").val(task_assign_to_text_val);
                            $("#table-modal-task-dependency"+ row_edit + "").val(task_dependency_text_val);
                            $("#table-modal-task-type"+ row_edit + "").val(task_type_text_val);
                            $(this).parent('.modal-buton').removeClass('custom-model-btn');
                            $(".addNewTask").hide('slow');
                            $(".addTaskGrpup").hide('slow');

                            //Update Table Entry on the Submit Ticket Table along with the Task Manger Button
                            $("#table-task-id"+ row_edit + "").val(task_id_text_val);
                            $("#table-task-assign-to"+ row_edit + "").val(task_assign_to_text_val);
                            $("#table-task-type"+ row_edit + "").val(task_type_val);
                        }
                    }
                }

            });

            $(document).on('click', '.delete_record', function(e) {
                // cancel submit
                e.preventDefault();
                $(this).closest('tr').remove();
                r_id = ($(this).attr('data-id'));
                $("#tbl_row"+ r_id + "").remove();
            })

            $(document).on('click', '#btnReset', function(e) {
                e.preventDefault();
                row_counter = 0;
                task_order_start = 1;
                task_order_end = 1;
                $('.table-task-modal tbody').html('')
                $('.table-tasks tbody').html('')

            })

            $(document).on('click','.edit_record',function () {
                $('#BtnNewTask').parent('.modal-buton').addClass('custom-model-btn');
                $('#accept-btn').val('Update')
                $(".addNewTask").toggle('slow');
                row_edit = r_id = $(this).attr('data-id');
                t_order = $("#task-order"+ r_id + "").val();
                t_id = $("#task-id"+ r_id + "").val();
                t_type = $("#task-type"+ r_id + "").val();
                t_note = $("#task-note"+ r_id + "").val();
                t_due_date = $("#task-due-date"+ r_id + "").val();
                t_dependency = $("#task-dependency"+ r_id + "").val();
                t_dependency_order = $("#task-dependency-order"+ r_id + "").val();
                t_assign_to = $("#task-assign"+ r_id + "").val();
                $('#modal_task_order').val(t_order)
                $('#modal_task_id').val(t_id)
                if(t_type == '0'){$('#modal_task_type1').prop('checked',true)}else{$('#modal_task_type2').prop('checked',true)}
                $('#modal_task_note').val(t_note)
                $('#modal_due_date').val(t_due_date)
                if(t_dependency == '0'){$('#modal_dependency1').prop('checked',true)}else{$('#modal_dependency2').prop('checked',true)}
                $('#modal_dependency_order').val(t_dependency_order)
                $('#modal_task_assign_to').select2("val", t_assign_to);
            });

        </script>

        <script>
            $(document).on('click','#modalLG',function(e){if($('.select2-drop-active').is(':visible')){$('.select2-drop-active').hide();$('.select2-container-active').removeClass('select2-dropdown-open')}});
        </script>

    {% endblock %}

