    {% extends 'itrak/base.html' %}

    {% block body_block %}
        {% load static %}
        {% load templates_extras %}

				<section role="main" class="content-body">
					<header class="page-header">
                       <h2><i class="fa fa-gears" aria-hidden="true"></i> Dashboard Settings</h2>

						<div class="right-wrapper pull-right">
							<ol class="breadcrumbs">
								<li>
									<a href="{% url 'home' %}">
										<i class="fa fa-home"></i>
									</a>
								</li>
								<li><span>Dashboard</span></li>
								<li><span>Dashboard Settings</span></li>
							</ol>

							<a class="sidebar-right-toggle" data-open="sidebar-right"><i class="fa fa-chevron-left"></i></a>
						</div>
					</header>

					<!-- start: page -->
                    <div class="row">
                        <div class="col-md-12">
                            <section class="panel">
                                <header class="panel-heading">
                                    <h2 class="panel-title">Dashboard Settings</h2>
                                </header>
                                <div class="panel-body">
                                    {% for message in messages %}
                                        <div class="alert {% if 'success' in message.tags %} alert-success {% else %} alert-danger{% endif %} alert-dismissible" role="alert">
                                            <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                        {{ message }}
                                        </div>
                                    {% endfor %}
                                    {% if panelTypes %}
                                        <div class="form-group" id="panel_type_div">
                                    {% else %}
                                        <p id="assigned_para"><b>All Panels are assigned to columns.</b></p>
                                        <div class="form-group" id="panel_type_div" style="display:none;">
                                    {% endif %}
                                            <div class="row">
                                                <label class="col-lg-2 col-md-3 col-sm-4 control-label space_top_06">Select a Panel:</label>
                                                <div class="col-md-6 col-sm-8">
                                                    <select name="panel_type" id="panel_type" data-plugin-selectTwo class="form-control populate placeholder" data-plugin-options='{ "placeholder": "Select Panel Type", "allowClear": true }'>
                                                        {% for panelGraph_text, panelGraph_url in panelTypes %}
                                                            <option value="{{panelGraph_url }}" >{{ panelGraph_text }}</option>
                                                        {% endfor %}
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    <br>
                                    <center>
                                    	<div class="row">
                                    		<div class="col-lg-7 col-md-8 col-sm-12 col-lg-offset-2 col-md-offset-2">
		                                        {% if panelTypes %}
		                                            <div class="panel-body" id="chart_div" style="height: 400px;border: 1px solid darkgrey;overflow-y: scroll">
		                                        {% else %}
		                                            <div class="panel-body" id="chart_div" style="height: 400px;border: 1px solid darkgrey;overflow-y: scroll; display:none">
		                                        {% endif %}
		                                                <header class="panel-heading  header-space-bottom">
		                                                    <h2 class="panel-title" id="chart-heading"></h2>
		                                                </header>
		                                                <canvas id="myChart"></canvas>
		                                                <div id="lengend-div"></div>
		                                            </div>
                                                    <br>
                                                    {% if panelTypes %}
                                                    <div class="row space-top-bottom" id="btn_div">
                                                    {% else %}
                                                    <div class="row space-top-bottom" id="btn_div" style="display: none;">
                                                    {% endif %}
                                                        <div class="col-md-6 col-sm-6 align-left">
                                                            <button class="btn btn-primary" onclick="addToLeft()">Add to Left Column</button>
                                                        </div>
                                                        <div class="col-md-6 col-sm-6 align-right">
                                                            <button class="btn btn-primary" onclick="addToRight()">Add to Right Column</button>
                                                        </div>
                                                    <br>
		                                    </div>
		                                </div>
                                    </center>
                                    <p style="font-size: 14px;"><b class="text-danger text-align-middle">Note:</b> All panel options are draggable to move up and down.</p>
                                    <div class="row">
                                        <form action="{% url 'saveDashboardPanel' %}" method="post">
                                            {% csrf_token %}
                                            <center>
                                                <div class="col-md-6 add-data" id="left">
                                                    <div id="sortable">
                                                        {% if panel_left %}
                                                            {% for p in panel_left %}
                                                                <div id="left-div{{ forloop.counter }}" class="p-3 mb-10 bg-success text-dark">
                                                                    <input type="button" onclick="removeLeftDiv({{ forloop.counter }},'{{p.d_panel__panelGraph_url}}','{{p.d_panel__panelGraph_text}}')" style="float:right" class="btn btn-danger" value="X"><br>
                                                                    <input type="hidden" value="0" name="left-column-side{{ forloop.counter }}">
                                                                    <input type="hidden" value="{{p.d_panel__panelGraph_url}}" name="left-option-name[]">
                                                                    <h5 id="panelHeadingLeft"><b>Panel Name:</b>{{p.d_panel__panelGraph_text}}</h5>
                                                                    <b>Start Expanded?</b> <input type="checkbox" name="left-expanded[]" id="left-expanded"
                                                                    {% if p.d_expanded == 1 %}
                                                                        checked
                                                                    {% endif %}
                                                                     value="{{p.d_panel__panelGraph_url}}">
                                                                    <div class="form-group">
                                                                        <b>Data Display Preference:</b>
                                                                        {% if p.d_panel__panelGraph_url == 'monthlyPerformance' %}
                                                                            <select name="left_data_display_preference[]" id="left_data_display_preference" class="form-control" readonly>
                                                                                <option value="2" {% if p.d_data_display == 2 %}selected {% endif %}>Data Table Only</option>
                                                                            </select>
                                                                        {% elif p.d_panel__panelGraph_url == 'currentQtrPerformance' %}
                                                                            <select name="left_data_display_preference[]" id="left_data_display_preference" class="form-control" readonly>
                                                                                <option value="2" {% if p.d_data_display == 2 %}selected {% endif %}>Data Table Only</option>
                                                                            </select>
                                                                        {% else %}
                                                                            <select name="left_data_display_preference[]" id="left_data_display_preference" class="form-control">
                                                                                <option value="1" {% if p.d_data_display == 1 %}selected {% endif %}>Data Table and Chart</option>
                                                                                <option value="2" {% if p.d_data_display == 2 %}selected {% endif %}>Data Table Only</option>
                                                                                <option value="3" {% if p.d_data_display == 3 %}selected {% endif %}>Chart Only</option>
                                                                            </select>
                                                                        {% endif %}
                                                                    </div>
                                                                </div>
                                                            {% endfor %}
                                                        {% endif %}
                                                    </div>
                                                </div>
                                            </center>
                                            <center>
                                                <div class="col-md-6 add-data" id="right">
                                                    <div id="sortable1">
                                                        {% if panel_right %}
                                                            {% for p in panel_right %}
                                                                <div id="right-div{{ forloop.counter }}" class="p-3 mb-10 bg-success text-dark">
                                                                    <input type="button" onclick="removeRightDiv({{ forloop.counter }},'{{p.d_panel__panelGraph_url}}','{{p.d_panel__panelGraph_text}}')" style="float:right" class="btn btn-danger" value="X"><br>
                                                                    <input type="hidden" value="1" name="right-column-side{{ forloop.counter }}">
                                                                    <input type="hidden" value="{{p.d_panel__panelGraph_url}}" name="right-option-name[]">
                                                                    <h5 id="panelHeadingLeft"><b>Panel Name:</b>{{p.d_panel__panelGraph_text}}</h5>
                                                                    <b>Start Expanded?</b> <input type="checkbox" name="right-expanded[]"
                                                                    {% if p.d_expanded == 1 %}
                                                                        checked
                                                                    {% endif %}
                                                                     value="{{p.d_panel__panelGraph_url}}">
                                                                    <div class="form-group">
                                                                        <b>Data Display Preference:</b>
                                                                        {% if p.d_panel__panelGraph_url == 'monthlyPerformance' %}
                                                                            <select name="right_data_display_preference[]" id="right_data_display_preference" class="form-control" readonly>
                                                                                <option value="2" {% if p.d_data_display == 2 %}selected {% endif %}>Data Table Only</option>
                                                                        {% elif p.d_panel__panelGraph_url == 'currentQtrPerformance' %}
                                                                            <select name="right_data_display_preference[]" id="right_data_display_preference" class="form-control" readonly>
                                                                                <option value="2" {% if p.d_data_display == 2 %}selected {% endif %}>Data Table Only</option>
                                                                        {% else %}
                                                                            <select name="right_data_display_preference[]" id="right_data_display_preference" class="form-control">
                                                                            <option value="1" {% if p.d_data_display == 1 %}selected {% endif %}>Data Table and Chart</option>
                                                                            <option value="2" {% if p.d_data_display == 2 %}selected {% endif %}>Data Table Only</option>
                                                                            <option value="3" {% if p.d_data_display == 3 %}selected {% endif %}>Chart Only</option>
                                                                        {% endif %}
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                            {% endfor %}
                                                        {% endif %}
                                                    </div>
                                                </div>
                                            </center>
                                            <div class="clearfix bottom-button">
                                                    <input type="hidden" name="left-loop-count" id="left-loop-count" value="{{p_left}}">
                                                    <input type="hidden" name="right-loop-count" id="right-loop-count" value="{{p_right}}">
                                                    <input type="submit" name="submit" value="Save" class="btn btn-primary">
                                                    <input type="button" class="btn btn-primary" onclick="rest()" value="Reset">
                                            </div>
                                        </form>
                                        <div id="modalLG" class="modal-block modal-block-lg mfp-hide">
                                        </div>
                                    </div>
                                </div>
                            </section>
                        </div>
                    </div>
					<!-- end: page -->
				</section>
                <a class="mb-xs mt-xs mr-xs modal-sizes" href="#modalLG" id="gt_helper"></a>
			{% comment %} </div> {% endcomment %}
           <!-- Modal Warning -->
    {% endblock %}
    {% block script %}
        <script>
            {% if domain == 'atgtravel.com' %}
                var base_url = '/portal/atg-extra/';
            {% else %}
                var base_url = '';
            {% endif %}
            var option_text = '';
            $( "#sortable" ).sortable();
            $( "#sortable" ).disableSelection();
            $( "#sortable1" ).sortable();
            $( "#sortable1" ).disableSelection();
            {% if first_text %}
                {% for t in first_text %}
                {% for u in first_url %}
                    option_text = '{{u}}';
                    $(document).ready(function () {
                        $('#chart-heading').text('{{ t }}');
                        {% if u == 'monthlyPerformance' %}
                            $("#lengend-div").html('');
                            $('#myChart').css('display','none')
                            $.ajax({
                                    type: 'POST',
                                    url: '/{{ u }}/',
                                    success: function (responce) {
                                        //alert(responce);
                                        //console.log(responce);
                                        var text = '';
                                            text += '<table class="table table-striped table-bordered" style="width:100%">' +
                                                '<thead>' +
                                                '<tr>' +
                                                '<th> </th>' +
                                                '<th>Opened</th>' +
                                                '<th>Closed</th>' +
                                                '<th>Reopned</th>' +
                                                '</tr>' +
                                                '</thead><tbody>';
                                            for(i=0;i<responce[Object.keys(responce)[0]].length;i++){
                                                text += '<tr>' +
                                                    '<td>'+ responce[Object.keys(responce)[0]][i] +' '+ responce[Object.keys(responce)[1]][i] +'</td>' +
                                                    '<td>'+ responce[Object.keys(responce)[2]][i] +'</td>' +
                                                    '<td>'+ responce[Object.keys(responce)[3]][i] +'</td>' +
                                                    '<td>'+ responce[Object.keys(responce)[4]][i] +'</td>' +
                                                    '</tr>'
                                            }
                                            text += '</tbody></table>';

                                        $("#lengend-div").html(text);
                                    }
                                });
                        {% elif  u == 'currentQtrPerformance' %}
                            $("#lengend-div").html('');
                            $('#myChart').css('display','none')
                            $.ajax({
                                type: 'POST',
                                url: '/{{ u }}/',
                                success: function (responce) {
                                    //alert(responce);
                                    //console.log(responce);
                                    var text = '';
                                        text += '<table class="table table-striped table-bordered" style="width:100%">' +
                                            '<thead>' +
                                            '<tr>' +
                                            '<th> </th>' +
                                            '<th>Opened</th>' +
                                            '<th>Closed</th>' +
                                            '<th>Reopned</th>' +
                                            '<th>Avg Resolution</th>' +
                                            '</tr>' +
                                            '</thead><tbody>';
                                        for(i=0;i<responce[Object.keys(responce)[0]].length;i++){
                                            text += '<tr>' +
                                                '<td>'+ responce[Object.keys(responce)[0]][i] +' '+ responce[Object.keys(responce)[1]][i] +'</td>' +
                                                '<td>'+ responce[Object.keys(responce)[2]][i] +'</td>' +
                                                '<td>'+ responce[Object.keys(responce)[3]][i] +'</td>' +
                                                '<td>'+ responce[Object.keys(responce)[4]][i] +'</td>' +
                                                '<td>'+ responce[Object.keys(responce)[5]][i] +'</td>' +
                                                '</tr>'
                                        }
                                        text += '</tbody></table>';

                                    $("#lengend-div").html(text);
                                    }
                                });
                        {% else %}
                            $.ajax({
                                type: 'POST',
                                url: '/{{ u }}/',
                                data: {sort:'default'},
                                success: function (responce) {
                                    //alert(responce[Object.keys(responce)[0]])
                                    var ctx = document.getElementById('myChart').getContext('2d');
                                    var myChart = new Chart(ctx, {
                                    type: 'bar',
                                        data: {
                                        labels: responce[Object.keys(responce)[0]],
                                        datasets: [{
                                            data: responce[Object.keys(responce)[1]],
                                            backgroundColor: [
                                                'rgb(255, 0, 0)',
                                                'rgb(126, 251, 1)',
                                                'rgb(1, 251, 251)',
                                                'rgb(251, 0, 255)',
                                                'rgb(0, 201, 0)',
                                                'rgb(11, 0, 11)',
                                                'rgb(201, 0, 0)',
                                                'rgb(0, 255, 0)',
                                                'rgb(0, 0, 251)',
                                                'rgb(0, 0, 255)',
                                                'rgb(123, 321, 312)',
                                                'rgb(321, 123, 123)',
                                                'rgb(312, 321, 231)',
                                                'rgb(112, 1, 110)',
                                            ],
                                            borderColor: [
                                                'rgb(255, 0, 0)',
                                                'rgb(126, 251, 1, )',
                                                'rgb(1, 251, 251)'
                                            ],
                                            borderWidth: 1
                                        }]
                                        },
                                        options:{
                                            onClick: graphClickEvent,
                                            legendCallback: function(chart) {
                                                var text = '';
                                                text += '<table class="table table-striped table-bordered" style="width:100%">' +
                                                    '<thead>' +
                                                    '<tr>' +
                                                    '<th>'+ Object.keys(responce)[0] +'</th>' +
                                                    '<th>'+ Object.keys(responce)[1] +'</th>' +
                                                    '</tr>' +
                                                    '</thead><tbody>';
                                                for(i=0;i<responce[Object.keys(responce)[0]].length;i++){
                                                    text += '<tr>' +
                                                        '<td>'+ responce[Object.keys(responce)[0]][i] +'</td>' +
                                                        '<td><a onclick="getRecord(\''+option_text+'\',\''+responce[Object.keys(responce)[0]][i]+'\')">'+ responce[Object.keys(responce)[1]][i] +'</a></td>' +
                                                        '</tr>'
                                                }
                                                text += '</tbody></table>';

                                                return text
                                            },
                                            legend:{
                                                display: false,
                                                position: 'bottom'
                                            },
                                            scales: {
                                                xAxes: [{
                                                    barPercentage: 0.2
                                                }],
                                                yAxes:[{
                                                    ticks:{
                                                        beginAtZero:true
                                                    }
                                                }]
                                            }
                                        }
                                    });
                                    $("#lengend-div").html(myChart.generateLegend());
                                }
                            });
                        {% endif %}
                        $('#panel_type').on('change',function () {
                            if ($(this).val() == 'systemOverview' || $(this).val() == 'openTicketsByTicketType'
                                || $(this).val() == 'openTicketsBySubtype' || $(this).val() == 'openTicketsBySubstatus'
                                || $(this).val() == 'openTicketsByPriority' || $(this).val() == 'openTicketsByOrganization'
                                || $(this).val() == 'openTicketsByAccount' || $(this).val() == 'openTicketsByAssignee'
                                || $(this).val() == 'availableTasksByAssignee' || $(this).val() == 'openTasksByAssignee'
                                || $(this).val() == 'openTicketsByDeptAssigned' || $(this).val() == 'openTicketsByDeptSubmitting'
                                || $(this).val() == 'openTicketsByNextAction' || $(this).val() == 'openTicketsByClients' 
                                || $(this).val() == 'openTicketsByCountry' ) {
                                $('#chart-heading').text($('#panel_type option:selected').text())
                                $('#myChart').css('display','block');
                                $('#myChart').remove();
                                $('<canvas id="myChart"></canvas>').insertBefore("#lengend-div");
                                option_text = $(this).val();
                                $.ajax({
                                    type: 'POST',
                                    url: base_url + $(this).val() + '/',
                                    success: function (responce) {
                                        //alert(responce[Object.keys(responce)[0]])
                                        var ctx = document.getElementById('myChart').getContext('2d');
                                        var myChart = new Chart(ctx, {
                                        type: 'bar',
                                            data: {
                                            labels: responce[Object.keys(responce)[0]],
                                            datasets: [{
                                                data: responce[Object.keys(responce)[1]],
                                                backgroundColor: [
                                                    'rgb(255, 0, 0)',
                                                    'rgb(126, 251, 1)',
                                                    'rgb(1, 251, 251)',
                                                    'rgb(251, 0, 255)',
                                                    'rgb(0, 201, 0)',
                                                    'rgb(11, 0, 11)',
                                                    'rgb(201, 0, 0)',
                                                    'rgb(0, 255, 0)',
                                                    'rgb(0, 0, 251)',
                                                    'rgb(0, 0, 255)',
                                                    'rgb(123, 321, 312)',
                                                    'rgb(321, 123, 123)',
                                                    'rgb(312, 321, 231)',
                                                    'rgb(112, 1, 110)',
                                                ],
                                                borderColor: [
                                                    'rgb(255, 0, 0)',
                                                    'rgb(126, 251, 1, )',
                                                    'rgb(1, 251, 251)'
                                                ],
                                                borderWidth: 1
                                            }]
                                            },
                                            options:{
                                                onClick: graphClickEvent,
                                                legendCallback: function(chart) {
                                                    var text = '';
                                                    text += '<table class="table table-striped table-bordered" style="width:100%">' +
                                                        '<thead>' +
                                                        '<tr>' +
                                                        '<th>'+ Object.keys(responce)[0] +'</th>' +
                                                        '<th>'+ Object.keys(responce)[1] +'</th>' +
                                                        '</tr>' +
                                                        '</thead><tbody>';
                                                    for(i=0;i<responce[Object.keys(responce)[0]].length;i++){
                                                        text += '<tr>' +
                                                            '<td>'+ responce[Object.keys(responce)[0]][i] +'</td>' +
                                                            '<td><a class="mb-xs mt-xs mr-xs modal-sizes" href="#modalLG" onclick="getRecord(\''+option_text+'\',\''+responce[Object.keys(responce)[0]][i]+'\')">'+ responce[Object.keys(responce)[1]][i] +'</a></td>' +
                                                            '</tr>'
                                                    }
                                                    text += '</tbody></table>';

                                                    return text
                                                },
                                                legend:{
                                                    display: false,
                                                    position: 'bottom'
                                                },
                                                scales: {
                                                    xAxes: [{
                                                        barPercentage: 0.2
                                                    }],
                                                    yAxes:[{
                                                        ticks:{
                                                            beginAtZero:true
                                                        }
                                                    }]
                                                }
                                            }
                                        });
                                        $("#lengend-div").html(myChart.generateLegend())
                                    }
                                })
                            }else if ($(this).val() == 'monthlyPerformance'){
                                $('#chart-heading').text($('#panel_type option:selected').text());
                                $("#lengend-div").html('');
                                $('#myChart').css('display','none');
                                option_text = $(this).val();
                                $.ajax({
                                    type: 'POST',
                                    url: base_url + $(this).val() + '/',
                                    success: function (responce) {
                                        //alert(responce);
                                        //console.log(responce);
                                        var text = '';
                                            text += '<table class="table table-striped table-bordered" style="width:100%">' +
                                                '<thead>' +
                                                '<tr>' +
                                                '<th> </th>' +
                                                '<th>Opened</th>' +
                                                '<th>Closed</th>' +
                                                '<th>Reopned</th>' +
                                                '</tr>' +
                                                '</thead><tbody>';
                                            for(i=0;i<responce[Object.keys(responce)[0]].length;i++){
                                                text += '<tr>' +
                                                    '<td>'+ responce[Object.keys(responce)[0]][i] +' '+ responce[Object.keys(responce)[1]][i] +'</td>' +
                                                    '<td>'+ responce[Object.keys(responce)[2]][i] +'</td>' +
                                                    '<td>'+ responce[Object.keys(responce)[3]][i] +'</td>' +
                                                    '<td>'+ responce[Object.keys(responce)[4]][i] +'</td>' +
                                                    '</tr>'
                                            }
                                            text += '</tbody></table>';

                                        $("#lengend-div").html(text);
                                    }
                                })
                            } else if ($(this).val() == 'currentQtrPerformance'){
                                $('#chart-heading').text($('#panel_type option:selected').text());
                                $("#lengend-div").html('');
                                $('#myChart').css('display','none');
                                option_text = $(this).val();
                                $.ajax({
                                    type: 'POST',
                                    url: base_url + $(this).val() + '/',
                                    success: function (responce) {
                                        //alert(responce);
                                        //console.log(responce);
                                        var text = '';
                                            text += '<table class="table table-striped table-bordered" style="width:100%">' +
                                                '<thead>' +
                                                '<tr>' +
                                                '<th> </th>' +
                                                '<th>Opened</th>' +
                                                '<th>Closed</th>' +
                                                '<th>Reopned</th>' +
                                                '<th>Avg Resolution</th>' +
                                                '</tr>' +
                                                '</thead><tbody>';
                                            for(i=0;i<responce[Object.keys(responce)[0]].length;i++){
                                                text += '<tr>' +
                                                    '<td>'+ responce[Object.keys(responce)[0]][i] +' '+ responce[Object.keys(responce)[1]][i] +'</td>' +
                                                    '<td>'+ responce[Object.keys(responce)[2]][i] +'</td>' +
                                                    '<td>'+ responce[Object.keys(responce)[3]][i] +'</td>' +
                                                    '<td>'+ responce[Object.keys(responce)[4]][i] +'</td>' +
                                                    '<td>'+ responce[Object.keys(responce)[5]][i] +'</td>' +
                                                    '</tr>'
                                            }
                                            text += '</tbody></table>';

                                        $("#lengend-div").html(text);
                                    }
                                })
                            }
                        });
                    });
                {% endfor %}
                {% endfor %}
            {% else %}
                $(document).ready(function () {
                    $('#panel_type').on('change',function () {
                        if ($(this).val() == 'systemOverview' || $(this).val() == 'openTicketsByTicketType'
                            || $(this).val() == 'openTicketsBySubtype' || $(this).val() == 'openTicketsBySubstatus'
                            || $(this).val() == 'openTicketsByPriority' || $(this).val() == 'openTicketsByOrganization'
                            || $(this).val() == 'openTicketsByAccount' || $(this).val() == 'openTicketsByAssignee'
                            || $(this).val() == 'availableTasksByAssignee' || $(this).val() == 'openTasksByAssignee'
                            || $(this).val() == 'openTicketsByDeptAssigned' || $(this).val() == 'openTicketsByDeptSubmitting'
                            || $(this).val() == 'openTicketsByNextAction' || $(this).val() == 'openTicketsByClients'
                            || $(this).val() == 'openTicketsByCountry') {
                            $('#chart-heading').text($('#panel_type option:selected').text())
                            $('#myChart').css('display','block');
                            $('#myChart').remove();
                            $('<canvas id="myChart"></canvas>').insertBefore("#lengend-div");
                            option_text = $(this).val();
                            $.ajax({
                                type: 'POST',
                                url: base_url + $(this).val() + '/',
                                success: function (responce) {
                                    //alert(responce[Object.keys(responce)[0]])
                                    var ctx = document.getElementById('myChart').getContext('2d');
                                    var myChart = new Chart(ctx, {
                                    type: 'bar',
                                        data: {
                                        labels: responce[Object.keys(responce)[0]],
                                        datasets: [{
                                            data: responce[Object.keys(responce)[1]],
                                            backgroundColor: [
                                                'rgb(255, 0, 0)',
                                                'rgb(126, 251, 1)',
                                                'rgb(1, 251, 251)',
                                                'rgb(251, 0, 255)',
                                                'rgb(0, 201, 0)',
                                                'rgb(11, 0, 11)',
                                                'rgb(201, 0, 0)',
                                                'rgb(0, 255, 0)',
                                                'rgb(0, 0, 251)',
                                                'rgb(0, 0, 255)',
                                                'rgb(123, 321, 312)',
                                                'rgb(321, 123, 123)',
                                                'rgb(312, 321, 231)',
                                                'rgb(112, 1, 110)',
                                            ],
                                            borderColor: [
                                                'rgb(255, 0, 0)',
                                                'rgb(126, 251, 1, )',
                                                'rgb(1, 251, 251)'
                                            ],
                                            borderWidth: 1
                                        }]
                                        },
                                        options:{
                                            onClick: graphClickEvent,
                                            legendCallback: function(chart) {
                                                var text = '';
                                                text += '<table class="table table-striped table-bordered" style="width:100%">' +
                                                    '<thead>' +
                                                    '<tr>' +
                                                    '<th>'+ Object.keys(responce)[0] +'</th>' +
                                                    '<th>'+ Object.keys(responce)[1] +'</th>' +
                                                    '</tr>' +
                                                    '</thead><tbody>';
                                                for(i=0;i<responce[Object.keys(responce)[0]].length;i++){
                                                    text += '<tr>' +
                                                        '<td>'+ responce[Object.keys(responce)[0]][i] +'</td>' +
                                                        '<td><a class="mb-xs mt-xs mr-xs modal-sizes" href="#modalLG" onclick="getRecord(\''+option_text+'\',\''+responce[Object.keys(responce)[0]][i]+'\')">'+ responce[Object.keys(responce)[1]][i] +'</a></td>' +
                                                        '</tr>'
                                                }
                                                text += '</tbody></table>';

                                                return text
                                            },
                                            legend:{
                                                display: false,
                                                position: 'bottom'
                                            },
                                            scales: {
                                                xAxes: [{
                                                    barPercentage: 0.2
                                                }],
                                                yAxes:[{
                                                    ticks:{
                                                        beginAtZero:true
                                                    }
                                                }]
                                            }
                                        }
                                    });
                                    $("#lengend-div").html(myChart.generateLegend())
                                }
                            })
                        }else if ($(this).val() == 'monthlyPerformance'){
                            $('#chart-heading').text($('#panel_type option:selected').text());
                            $("#lengend-div").html('');
                            $('#myChart').css('display','none');
                            option_text = $(this).val();
                            $.ajax({
                                type: 'POST',
                                url: base_url + $(this).val() + '/',
                                success: function (responce) {
                                    //alert(responce);
                                    //console.log(responce);
                                    var text = '';
                                        text += '<table class="table table-striped table-bordered" style="width:100%">' +
                                            '<thead>' +
                                            '<tr>' +
                                            '<th> </th>' +
                                            '<th>Opened</th>' +
                                            '<th>Closed</th>' +
                                            '<th>Reopned</th>' +
                                            '</tr>' +
                                            '</thead><tbody>';
                                        for(i=0;i<responce[Object.keys(responce)[0]].length;i++){
                                            text += '<tr>' +
                                                '<td>'+ responce[Object.keys(responce)[0]][i] +' '+ responce[Object.keys(responce)[1]][i] +'</td>' +
                                                '<td>'+ responce[Object.keys(responce)[2]][i] +'</td>' +
                                                '<td>'+ responce[Object.keys(responce)[3]][i] +'</td>' +
                                                '<td>'+ responce[Object.keys(responce)[4]][i] +'</td>' +
                                                '</tr>'
                                        }
                                        text += '</tbody></table>';

                                    $("#lengend-div").html(text);
                                }
                            })
                        }else if ($(this).val() == 'currentQtrPerformance'){
                            $('#chart-heading').text($('#panel_type option:selected').text());
                            $("#lengend-div").html('');
                            $('#myChart').css('display','none');
                            option_text = $(this).val();
                            $.ajax({
                                type: 'POST',
                                url: base_url + $(this).val() + '/',
                                success: function (responce) {
                                    //alert(responce);
                                    //console.log(responce);
                                    var text = '';
                                        text += '<table class="table table-striped table-bordered" style="width:100%">' +
                                            '<thead>' +
                                            '<tr>' +
                                            '<th> </th>' +
                                            '<th>Opened</th>' +
                                            '<th>Closed</th>' +
                                            '<th>Reopned</th>' +
                                            '<th>Avg Resolution</th>' +
                                            '</tr>' +
                                            '</thead><tbody>';
                                        for(i=0;i<responce[Object.keys(responce)[0]].length;i++){
                                            text += '<tr>' +
                                                '<td>'+ responce[Object.keys(responce)[0]][i] +' '+ responce[Object.keys(responce)[1]][i] +'</td>' +
                                                '<td>'+ responce[Object.keys(responce)[2]][i] +'</td>' +
                                                '<td>'+ responce[Object.keys(responce)[3]][i] +'</td>' +
                                                '<td>'+ responce[Object.keys(responce)[4]][i] +'</td>' +
                                                '<td>'+ responce[Object.keys(responce)[5]][i] +'</td>' +
                                                '</tr>'
                                        }
                                        text += '</tbody></table>';

                                    $("#lengend-div").html(text);
                                }
                            })
                        }
                    });
                });
            {% endif %}
            var leftCount = $('#left-loop-count').val();
            var rightCount = $('#right-loop-count').val();

            function addToLeft(){
                if ($('#panel_type option').size() > 1){
                    leftCount++;
                    var heading = $('#chart-heading').text();
                    if(option_text == 'monthlyPerformance'){
                        $("#left").find('#sortable').append('<br><div id="left-div'+leftCount+'" class="p-3 mb-10 bg-success text-dark"><input type="button" onclick="removeLeftDiv('+leftCount+',\''+option_text+'\',\''+heading+'\')" style="float:right" class="btn btn-danger" value="X"><br><input type="hidden" value="0" name="left-column-side'+leftCount+'"><input type="hidden" value="'+option_text+'" name="left-option-name[]"><h5 id="panelHeadingLeft"><b>Panel Name:</b>'+heading+'</h5><b>Start Expanded?</b> <input type="checkbox" name="left-expanded[]" value="'+option_text+'"><div class="form-group"><b>Data Display Preference:</b><select name="left_data_display_preference[]" id="left_data_display_preference" class="form-control ext"><option value="2" >Data Table Only</option></select></div></div><br>');
                        $('#left-loop-count').val(leftCount);
                        $('#panel_type option:selected').remove();
                        $('#panel_type').trigger("change");
                        $('.ext').attr("readonly", true);
                    }else if(option_text == 'currentQtrPerformance'){
                        $("#left").find('#sortable').append('<br><div id="left-div'+leftCount+'" class="p-3 mb-10 bg-success text-dark"><input type="button" onclick="removeLeftDiv('+leftCount+',\''+option_text+'\',\''+heading+'\')" style="float:right" class="btn btn-danger" value="X"><br><input type="hidden" value="0" name="left-column-side'+leftCount+'"><input type="hidden" value="'+option_text+'" name="left-option-name[]"><h5 id="panelHeadingLeft"><b>Panel Name:</b>'+heading+'</h5><b>Start Expanded?</b> <input type="checkbox" name="left-expanded[]" value="'+option_text+'"><div class="form-group"><b>Data Display Preference:</b><select name="left_data_display_preference[]" id="left_data_display_preference" class="form-control ext1"><option value="2" >Data Table Only</option></select></div></div><br>');
                        $('#left-loop-count').val(leftCount);
                        $('#panel_type option:selected').remove();
                        $('#panel_type').trigger("change");
                        $('.ext1').attr("readonly", true);
                    }else{
                        $("#left").find('#sortable').append('<br><div id="left-div'+leftCount+'" class="p-3 mb-10 bg-success text-dark"><input type="button" onclick="removeLeftDiv('+leftCount+',\''+option_text+'\',\''+heading+'\')" style="float:right" class="btn btn-danger" value="X"><br><input type="hidden" value="0" name="left-column-side'+leftCount+'"><input type="hidden" value="'+option_text+'" name="left-option-name[]"><h5 id="panelHeadingLeft"><b>Panel Name:</b>'+heading+'</h5><b>Start Expanded?</b> <input type="checkbox" name="left-expanded[]" value="'+option_text+'"><div class="form-group"><b>Data Display Preference:</b><select name="left_data_display_preference[]" id="left_data_display_preference" class="form-control"><option value="1" >Data Table and Chart</option><option value="2" >Data Table Only</option><option value="3" >Chart Only</option></select></div></div><br>');
                        $('#left-loop-count').val(leftCount);
                        $('#panel_type option:selected').remove();
                        $('#panel_type').trigger("change");
                    }

                }else{
                    leftCount++;
                    var heading = $('#chart-heading').text();
                    if(option_text == 'monthlyPerformance'){
                        $("#left").find('#sortable').append('<br><div id="left-div'+leftCount+'" class="p-3 mb-10 bg-success text-dark"><input type="button" onclick="removeLeftDiv('+leftCount+',\''+option_text+'\',\''+heading+'\')" style="float:right" class="btn btn-danger" value="X"><br><input type="hidden" value="0" name="left-column-side'+leftCount+'"><input type="hidden" value="'+option_text+'" name="left-option-name[]"><h5 id="panelHeadingLeft"><b>Panel Name:</b>'+heading+'</h5><b>Start Expanded?</b> <input type="checkbox" name="left-expanded[]" value="'+option_text+'"><div class="form-group"><b>Data Display Preference:</b><select name="left_data_display_preference[]" id="left_data_display_preference" class="form-control ext"><option value="2" >Data Table Only</option></select></div></div><br>');
                        $('#left-loop-count').val(leftCount);
                        $('#panel_type option:selected').remove();
                        $('#panel_type_div').hide();
                        $('#chart_div').hide();
                        $('#btn_div').hide();
                        $('#assigned_para').remove();
                        $('<p id="assigned_para"><b>All Panels are assigned to columns.</b></p>').insertBefore("#panel_type_div");
                        $('.ext').attr("readonly", true);
                    }else if(option_text == 'currentQtrPerformance'){
                        $("#left").find('#sortable').append('<br><div id="left-div'+leftCount+'" class="p-3 mb-10 bg-success text-dark"><input type="button" onclick="removeLeftDiv('+leftCount+',\''+option_text+'\',\''+heading+'\')" style="float:right" class="btn btn-danger" value="X"><br><input type="hidden" value="0" name="left-column-side'+leftCount+'"><input type="hidden" value="'+option_text+'" name="left-option-name[]"><h5 id="panelHeadingLeft"><b>Panel Name:</b>'+heading+'</h5><b>Start Expanded?</b> <input type="checkbox" name="left-expanded[]" value="'+option_text+'"><div class="form-group"><b>Data Display Preference:</b><select name="left_data_display_preference[]" id="left_data_display_preference" class="form-control .ext1"><option value="2" >Data Table Only</option></select></div></div><br>');
                        $('#left-loop-count').val(leftCount);
                        $('#panel_type option:selected').remove();
                        $('#panel_type_div').hide();
                        $('#chart_div').hide();
                        $('#btn_div').hide();
                        $('#assigned_para').remove();
                        $('<p id="assigned_para"><b>All Panels are assigned to columns.</b></p>').insertBefore("#panel_type_div");
                        $('.ext1').attr("readonly", true);
                    }else{
                        $("#left").find('#sortable').append('<br><div id="left-div'+leftCount+'" class="p-3 mb-10 bg-success text-dark"><input type="button" onclick="removeLeftDiv('+leftCount+',\''+option_text+'\',\''+heading+'\')" style="float:right" class="btn btn-danger" value="X"><br><input type="hidden" value="0" name="left-column-side'+leftCount+'"><input type="hidden" value="'+option_text+'" name="left-option-name[]"><h5 id="panelHeadingLeft"><b>Panel Name:</b>'+heading+'</h5><b>Start Expanded?</b> <input type="checkbox" name="left-expanded[]" value="'+option_text+'"><div class="form-group"><b>Data Display Preference:</b><select name="left_data_display_preference[]" id="left_data_display_preference" class="form-control"><option value="1" >Data Table and Chart</option><option value="2" >Data Table Only</option><option value="3" >Chart Only</option></select></div></div><br>');
                        $('#left-loop-count').val(leftCount);
                        $('#panel_type option:selected').remove();
                        $('#panel_type_div').hide();
                        $('#chart_div').hide();
                        $('#btn_div').hide();
                        $('#assigned_para').remove();
                        $('<p id="assigned_para"><b>All Panels are assigned to columns.</b></p>').insertBefore("#panel_type_div");
                    }
                }
            }

            function addToRight(){
                if ($('#panel_type option').size() > 1){
                    rightCount++;
                    var heading = $('#chart-heading').text();
                    if(option_text == 'monthlyPerformance'){
                        $("#right").find('#sortable1').append('<br><div id="right-div'+rightCount+'" class="p-3 mb-10 bg-success text-dark"><button onclick="removeRightDiv('+rightCount+',\''+option_text+'\',\''+heading+'\')" style="float:right" class="btn btn-danger">X</button><br><input type="hidden" value="1" name="right-column-side'+rightCount+'"><input type="hidden" value="'+option_text+'" name="right-option-name[]"><h5 id="panelHeadingLeft"><b>Panel Name:</b>'+heading+'</h5><b>Start Expanded?</b> <input type="checkbox" name="right-expanded[]" value="'+option_text+'"><div class="form-group"><b>Data Display Preference:</b><select name="right_data_display_preference[]" id="right_data_display_preference" class="form-control ext"><option value="2" >Data Table Only</option></select></div></div><br>');
                        $('#right-loop-count').val(rightCount);
                        $('#panel_type option:selected').remove();
                        $('#panel_type').trigger("change");
                        $('.ext').attr("readonly", true);
                    }else if(option_text == 'currentQtrPerformance'){
                        $("#right").find('#sortable1').append('<br><div id="right-div'+rightCount+'" class="p-3 mb-10 bg-success text-dark"><button onclick="removeRightDiv('+rightCount+',\''+option_text+'\',\''+heading+'\')" style="float:right" class="btn btn-danger">X</button><br><input type="hidden" value="1" name="right-column-side'+rightCount+'"><input type="hidden" value="'+option_text+'" name="right-option-name[]"><h5 id="panelHeadingLeft"><b>Panel Name:</b>'+heading+'</h5><b>Start Expanded?</b> <input type="checkbox" name="right-expanded[]" value="'+option_text+'"><div class="form-group"><b>Data Display Preference:</b><select name="right_data_display_preference[]" id="right_data_display_preference" class="form-control ext1"><option value="2" >Data Table Only</option></select></div></div><br>');
                        $('#right-loop-count').val(rightCount);
                        $('#panel_type option:selected').remove();
                        $('#panel_type').trigger("change");
                        $('.ext1').attr("readonly", true);
                    }else {
                        $("#right").find('#sortable1').append('<br><div id="right-div'+rightCount+'" class="p-3 mb-10 bg-success text-dark"><button onclick="removeRightDiv('+rightCount+',\''+option_text+'\',\''+heading+'\')" style="float:right" class="btn btn-danger">X</button><br><input type="hidden" value="1" name="right-column-side'+rightCount+'"><input type="hidden" value="'+option_text+'" name="right-option-name[]"><h5 id="panelHeadingLeft"><b>Panel Name:</b>'+heading+'</h5><b>Start Expanded?</b> <input type="checkbox" name="right-expanded[]" value="'+option_text+'"><div class="form-group"><b>Data Display Preference:</b><select name="right_data_display_preference[]" id="right_data_display_preference" class="form-control"><option value="1" >Data Table and Chart</option><option value="2" >Data Table Only</option><option value="3" >Chart Only</option></select></div></div><br>');
                        $('#right-loop-count').val(rightCount);
                        $('#panel_type option:selected').remove();
                        $('#panel_type').trigger("change");
                    }
                }else{
                    rightCount++;
                    var heading = $('#chart-heading').text();
                    if(option_text == 'monthlyPerformance'){
                        $("#right").find('#sortable1').append('<br><div id="right-div'+rightCount+'" class="p-3 mb-10 bg-success text-dark"><button onclick="removeRightDiv('+rightCount+',\''+option_text+'\',\''+heading+'\')" style="float:right" class="btn btn-danger">X</button><br><input type="hidden" value="1" name="right-column-side'+rightCount+'"><input type="hidden" value="'+option_text+'" name="right-option-name[]"><h5 id="panelHeadingLeft"><b>Panel Name:</b>'+heading+'</h5><b>Start Expanded?</b> <input type="checkbox" name="right-expanded[]" value="'+option_text+'"><div class="form-group"><b>Data Display Preference:</b><select name="right_data_display_preference[]" id="right_data_display_preference" class="form-control ext"><option value="2" >Data Table Only</option></select></div></div><br>');
                        $('#right-loop-count').val(rightCount);
                        $('#panel_type option:selected').remove();
                        $('#panel_type_div').hide();
                        $('#chart_div').hide();
                        $('#btn_div').hide();
                        $('#assigned_para').remove();
                        $('<p id="assigned_para"><b>All Panels are assigned to columns.</b></p>').insertBefore("#panel_type_div");
                        $('.ext').attr("readonly", true);
                    }else if(option_text == 'currentQtrPerformance'){
                        $("#right").find('#sortable1').append('<br><div id="right-div'+rightCount+'" class="p-3 mb-10 bg-success text-dark"><button onclick="removeRightDiv('+rightCount+',\''+option_text+'\',\''+heading+'\')" style="float:right" class="btn btn-danger">X</button><br><input type="hidden" value="1" name="right-column-side'+rightCount+'"><input type="hidden" value="'+option_text+'" name="right-option-name[]"><h5 id="panelHeadingLeft"><b>Panel Name:</b>'+heading+'</h5><b>Start Expanded?</b> <input type="checkbox" name="right-expanded[]" value="'+option_text+'"><div class="form-group"><b>Data Display Preference:</b><select name="right_data_display_preference[]" id="right_data_display_preference" class="form-control ext1"><option value="2" >Data Table Only</option></select></div></div><br>');
                        $('#right-loop-count').val(rightCount);
                        $('#panel_type option:selected').remove();
                        $('#panel_type_div').hide();
                        $('#chart_div').hide();
                        $('#btn_div').hide();
                        $('#assigned_para').remove();
                        $('<p id="assigned_para"><b>All Panels are assigned to columns.</b></p>').insertBefore("#panel_type_div");
                        $('.ext1').attr("readonly", true);
                    }else {
                        $("#right").find('#sortable1').append('<br><div id="right-div'+rightCount+'" class="p-3 mb-10 bg-success text-dark"><button onclick="removeRightDiv('+rightCount+',\''+option_text+'\',\''+heading+'\')" style="float:right" class="btn btn-danger">X</button><br><input type="hidden" value="1" name="right-column-side'+rightCount+'"><input type="hidden" value="'+option_text+'" name="right-option-name[]"><h5 id="panelHeadingLeft"><b>Panel Name:</b>'+heading+'</h5><b>Start Expanded?</b> <input type="checkbox" name="right-expanded[]" value="'+option_text+'"><div class="form-group"><b>Data Display Preference:</b><select name="right_data_display_preference[]" id="right_data_display_preference" class="form-control"><option value="1" >Data Table and Chart</option><option value="2" >Data Table Only</option><option value="3" >Chart Only</option></select></div></div><br>');
                        $('#right-loop-count').val(rightCount);
                        $('#panel_type option:selected').remove();
                        $('#panel_type_div').hide();
                        $('#chart_div').hide();
                        $('#btn_div').hide();
                        $('#assigned_para').remove();
                        $('<p id="assigned_para"><b>All Panels are assigned to columns.</b></p>').insertBefore("#panel_type_div");
                    }
                }
            }


            function removeLeftDiv(count,url,text){
                $('#panel_type').append('<option value="'+url+'">'+text+'</option>');
                $("#panel_type").select2("destroy").select2();
                $('#panel_type').trigger('change');
                $('#panel_type_div').show();
                $('#chart_div').show();
                $('#btn_div').show();
                $('#left-loop-count').val(leftCount);
                $("#left-div"+count+" + br").remove();
                $("#left-div"+count+"").remove();
                $('#assigned_para').remove();
            }

            function removeRightDiv(count,url,text){
                $('#panel_type').append('<option value="'+url+'">'+text+'</option>');
                $("#panel_type").select2("destroy").select2();
                $('#panel_type').trigger('change');
                $('#panel_type_div').show();
                $('#chart_div').show();
                $('#btn_div').show();
                $('#right-loop-count').val(rightCount);
                $("#right-div"+count+" + br").remove();
                $("#right-div"+count+"").remove();
                $('#assigned_para').remove();
            }

            function rest(){
                location.reload();
            }

            function graphClickEvent(event,array){
                user = array[0]['_view']['label'];
                $.ajax({
                    type: 'POST',
                    url: base_url + option_text + '/',
                    data: {user: user},
                    success: function (responce) {
                        //alert(responce);
                        //console.log(responce);
                        $('#gt_helper')[0].click();
                        $('#modalLG').html('');
                        $('#modalLG').html(responce);
                    }
                })
            }

            function getRecord(url,user){
                $.ajax({
                    type: 'POST',
                    url: base_url + url + '/',
                    data: {user: user},
                    success: function (responce) {
                        //alert(responce);
                        //console.log(responce);
                        $('#gt_helper')[0].click();
                        $('#modalLG').html('');
                        $('#modalLG').html(responce);
                    }
                })
            }
        </script>
    {% endblock %}


